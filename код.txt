actions 
actions/add_record.php
<?php
session_start();
require_once '../auth.php';
requireAuth();
require_once '../config.php';
require_once '../log_action.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: " . htmlspecialchars($e->getMessage()));
}

$table = $_GET['table'] ?? '';
if (empty($table)) {
    die("–ù–µ —É–∫–∞–∑–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞.");
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
$stmt = $pdo->prepare("SHOW TABLES LIKE ?");
$stmt->execute([$table]);
if (!$stmt->fetch()) {
    die("–¢–∞–±–ª–∏—Ü–∞ '$table' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.");
}

// === –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã ===
if ($_POST && isset($_POST['action']) && $_POST['action'] === 'insert') {
    $columns_info = $pdo->query("DESCRIBE `$table`")->fetchAll(PDO::FETCH_ASSOC);
    $columns = [];
    $values = [];
    $placeholders = [];
    // –°–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∏–º—ë–Ω –ø–æ–ª—è –ø–∞—Ä–æ–ª—è
    $password_fields = ['password', 'pass', 'passwd', 'user_password', 'pwd', 'PASSWORD_HASH', 'password_hash'];
    foreach ($columns_info as $col) {
        $field = $col['Field'];
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–Ω—ã–π id
        if ($field === 'id' && strpos($col['Extra'], 'auto_increment') !== false) {
            continue;
        }
        $columns[] = "`$field`";
        $placeholders[] = "?";
        $value = $_POST[$field] ?? '';
        // –•–µ—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å, –µ—Å–ª–∏ –ø–æ–ª–µ –≤ —Å–ø–∏—Å–∫–µ –ø–∞—Ä–æ–ª–µ–π
        if (in_array($field, $password_fields) && $value !== '') {
            $value = password_hash($value, PASSWORD_DEFAULT);
        }
        $values[] = $value;
    }
    if (!empty($columns)) {
        $sql = "INSERT INTO `$table` (" . implode(', ', $columns) . ") VALUES (" . implode(', ', $placeholders) . ")";
        $stmt = $pdo->prepare($sql);
        if ($stmt->execute($values)) {
            $new_id = $pdo->lastInsertId();
            $_SESSION['message'] = "‚úÖ –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞.";
            // –õ–æ–≥–∏—Ä—É–µ–º –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'ADD_RECORD', "–¢–∞–±–ª–∏—Ü–∞: $table, ID: $new_id");
        } else {
            $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏.";
        }
    } else {
        $_SESSION['message'] = "‚ùå –ù–µ—Ç –ø–æ–ª–µ–π –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏.";
    }
    header("Location: ../pages/view_db.php?table=" . urlencode($table));
    exit;
}
?>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å ‚Äî <?= htmlspecialchars($table) ?></title>
    <link rel="stylesheet" href="../css/view_db.css">
</head>
<body>
    <div style="max-width: 800px; margin: 30px auto; background: rgba(30,25,45,0.95); padding: 20px; border-radius: 12px; border: 1px solid #5a1a8f;">
        <h2 style="text-align: center; color: #c7b8ff;">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É: <?= htmlspecialchars($table) ?></h2>
        <form method="POST">
            <input type="hidden" name="action" value="insert">
            <?php
            $columns_info = $pdo->query("DESCRIBE `$table`")->fetchAll(PDO::FETCH_ASSOC);
            foreach ($columns_info as $col):
                $field = $col['Field'];
                if ($field === 'id' && strpos($col['Extra'], 'auto_increment') !== false) {
                    continue;
                }
            ?>
                <div style="margin: 12px 0;">
                    <label style="display: block; color: #c7b8ff; margin-bottom: 4px;"><?= htmlspecialchars($field) ?>:</label>
                    <input type="text" name="<?= $field ?>" 
                           style="width: 100%; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px;">
                </div>
            <?php endforeach; ?>
            <div style="text-align: center; margin-top: 20px;">
                <button type="submit" style="background: linear-gradient(to right, #00c853, #64dd17); color: white; padding: 10px 24px; border: none; border-radius: 6px; cursor: pointer;">–î–æ–±–∞–≤–∏—Ç—å</button>
                <a href="../pages/view_db.php?table=<?= urlencode($table) ?>" style="color: #ff6b6b; text-decoration: none; margin-left: 15px;">–û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
    </div>
</body>
</html>
actions/add_to_cart.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

if ($_SESSION['role'] !== 'user') {
    $_SESSION['message'] = "‚ùå –î–æ–±–∞–≤–ª—è—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏.";
    header("Location: ../pages/services.php");
    exit;
}

require_once '../config.php';

$type = $_GET['type'] ?? 'service'; // 'service' –∏–ª–∏ 'package'
$id = (int)($_GET['id'] ?? 0);

if (!in_array($type, ['service', 'package']) || $id <= 0) {
    $_SESSION['message'] = "‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.";
    header("Location: ../pages/services.php");
    exit;
}

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
    if ($type === 'service') {
        $stmt = $pdo->prepare("SELECT id FROM services WHERE id = ? AND price > 0");
        $stmt->execute([$id]);
        if (!$stmt->fetch()) {
            $_SESSION['message'] = "‚ùå –£—Å–ª—É–≥–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.";
            header("Location: ../pages/services.php");
            exit;
        }
        $col_id = 'service_id';
    } else {
        $stmt = $pdo->prepare("SELECT id FROM tariff_plans WHERE id = ? AND price > 0");
        $stmt->execute([$id]);
        if (!$stmt->fetch()) {
            $_SESSION['message'] = "‚ùå –ü–∞–∫–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.";
            header("Location: ../pages/services.php");
            exit;
        }
        $col_id = 'package_id';
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–∞
    $stmt = $pdo->prepare("SELECT id FROM cart WHERE user_id = ? AND type = ? AND `$col_id` = ?");
    $stmt->execute([$_SESSION['user_id'], $type, $id]);
    if ($stmt->fetch()) {
        $_SESSION['message'] = "‚ÑπÔ∏è –£–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ.";
    } else {
        $stmt = $pdo->prepare("INSERT INTO cart (user_id, `$col_id`, type) VALUES (?, ?, ?)");
        $stmt->execute([$_SESSION['user_id'], $id, $type]);
        $_SESSION['message'] = "‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É!";
    }

} catch (PDOException $e) {
    $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É.";
}

header("Location: ../pages/services.php");
exit;
?>
actions/backup.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

// –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞
if ($_SESSION['role'] !== 'admin') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω. –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø.";
    header("Location: ../pages/view_db.php");
    exit;
}

require_once '../config.php';
require_once '../log_action.php';

// –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ –±—ç–∫–∞–ø–æ–≤ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞)
$backup_dir = __DIR__ . '/../backups/';
if (!is_dir($backup_dir)) {
    mkdir($backup_dir, 0777, true);
}

// –ò–º—è —Ñ–∞–π–ª–∞
$filename = 'backup_' . date('Ymd_His') . '.sql';
$filepath = $backup_dir . $filename; // –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ –¥–∏—Å–∫
$relative_path = '/backups/' . $filename; // –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î

try {
    // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –ë–î
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
    $tables = [];
    $stmt = $pdo->query("SHOW TABLES");
    while ($row = $stmt->fetch(PDO::FETCH_NUM)) {
        $tables[] = $row[0];
    }

    // –§–æ—Ä–º–∏—Ä—É–µ–º SQL-–¥–∞–º–ø
    $sql = "-- Backup of database `$dbname`\n";
    $sql .= "-- Date: " . date('Y-m-d H:i:s') . "\n";
    $sql .= "SET FOREIGN_KEY_CHECKS = 0;\n";

    foreach ($tables as $table) {
        // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã
        $create = $pdo->query("SHOW CREATE TABLE `$table`")->fetch(PDO::FETCH_NUM);
        $sql .= $create[1] . ";\n";

        // –î–∞–Ω–Ω—ã–µ
        $stmt = $pdo->query("SELECT * FROM `$table`");
        $columns = [];
        for ($i = 0; $i < $stmt->columnCount(); $i++) {
            $col = $stmt->getColumnMeta($i);
            $columns[] = "`" . $col['name'] . "`";
        }

        while ($row = $stmt->fetch(PDO::FETCH_NUM)) {
            $values = [];
            foreach ($row as $val) {
                $values[] = $val === null ? 'NULL' : "'" . addslashes($val) . "'";
            }
            $sql .= "INSERT INTO `$table` (" . implode(', ', $columns) . ") VALUES (" . implode(', ', $values) . ");\n";
        }
        $sql .= "\n";
    }

    $sql .= "SET FOREIGN_KEY_CHECKS = 1;\n";

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª –Ω–∞ –¥–∏—Å–∫
    if (file_put_contents($filepath, $sql)) {
        try {
            // –ü–æ–ª—É—á–∞–µ–º server_id (–ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ –ø–µ—Ä–≤—ã–π –Ω–∞–π–¥–µ–Ω–Ω—ã–π)
            $server_name = 'Prod-DB-01';
            $stmt = $pdo->prepare("SELECT id FROM servers WHERE name = ? LIMIT 1");
            $stmt->execute([$server_name]);
            $server = $stmt->fetch(PDO::FETCH_ASSOC);

            if (!$server) {
                $stmt = $pdo->query("SELECT id FROM servers ORDER BY id LIMIT 1");
                $server = $stmt->fetch(PDO::FETCH_ASSOC);
                if (!$server) {
                    throw new Exception("–ù–µ—Ç —Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ —Ç–∞–±–ª–∏—Ü–µ 'servers'.");
                }
            }

            $server_id = $server['id'];
            $file_size_mb = round(filesize($filepath) / (1024 * 1024), 2);

            $insert = $pdo->prepare("
                INSERT INTO backups (server_id, backup_date, file_path, size_mb, status)
                VALUES (?, NOW(), ?, ?, 'success')
            ");
            $insert->execute([$server_id, $relative_path, $file_size_mb]);

            $_SESSION['message'] = "‚úÖ –ë—ç–∫–∞–ø '$filename' —Å–æ–∑–¥–∞–Ω –∏ –∑–∞–ø–∏—Å–∞–Ω –≤ –ë–î.";
            logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'BACKUP_SUCCESS', "–§–∞–π–ª: $filename, –†–∞–∑–º–µ—Ä: $file_size_mb –ú–ë");

        } catch (Exception $inner_e) {
            $_SESSION['message'] = "‚ö†Ô∏è –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω, –Ω–æ –æ—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –ë–î: " . htmlspecialchars($inner_e->getMessage());
        }
    } else {
        $_SESSION['message'] = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª –±—ç–∫–∞–ø–∞.";
    }
} catch (Exception $e) {
    $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±—ç–∫–∞–ø–∞: " . htmlspecialchars($e->getMessage());
}

header("Location: ../pages/view_db.php");
exit;
?>
actions/create_table_form.php 
<?php
session_start();
require_once '../auth.php';
requireAuth();
?>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É</title>
    <link rel="stylesheet" href="../css/create_table.css">
</head>
<body>
    <div class="form-box">
        <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É</h2>
        <form method="POST" action="../actions/create_table.php">
            <label for="table_name">–ò–º—è —Ç–∞–±–ª–∏—Ü—ã:</label>
            <input type="text" id="table_name" name="table_name" required>

            <label for="column_count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±—Ü–æ–≤:</label>
            <input type="number" id="column_count" name="column_count" min="1" max="50" value="5" required>

            <div id="columnsContainer">
                <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ–ª—è –¥–ª—è —Å—Ç–æ–ª–±—Ü–æ–≤ -->
            </div>

            <div style="margin-top: 20px; display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="fillDataToggle" name="fill_data" style="width: auto; height: auto;">
                <label for="fillDataToggle" style="color: #c7b8ff;">–•–æ—Ç–∏—Ç–µ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ?</label>
            </div>

            <div id="dataFields" style="display: none; margin-top: 20px;">
                <label>–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ (3 —Å—Ç—Ä–æ–∫–∏):</label>
                <div id="dataRows">
                    <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö -->
                </div>
            </div>

            <div class="buttons">
                <button type="submit">–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É</button>
                <button type="button" onclick="window.location.href='../pages/view_db.php'">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>

    <script>
        // –°–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
        const dataTypes = [
            { value: 'INT', label: 'INT' },
            { value: 'VARCHAR', label: 'VARCHAR' },
            { value: 'TEXT', label: 'TEXT' },
            { value: 'DATE', label: 'DATE' },
            { value: 'DATETIME', label: 'DATETIME' },
            { value: 'DECIMAL', label: 'DECIMAL' },
            { value: 'BOOLEAN', label: 'BOOLEAN' },
            { value: 'JSON', label: 'JSON' }
        ];

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π –¥–ª—è —Å—Ç–æ–ª–±—Ü–æ–≤
        function generateColumnFields(count) {
            const container = document.getElementById('columnsContainer');
            container.innerHTML = '';
            for (let i = 1; i <= count; i++) {
                const field = document.createElement('div');
                field.className = 'column-field';
                field.innerHTML = `
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin: 5px 0; align-items: center;">
                        <input type="text" name="column_${i}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–∞" required style="flex: 1; min-width: 120px; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                        <select name="type_${i}" required style="width: auto; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                            ${dataTypes.map(opt => `<option value="${opt.value}">${opt.label}</option>`).join('')}
                        </select>
                        <input type="text" name="length_${i}" placeholder="–î–ª–∏–Ω–∞/–∑–Ω–∞—á–µ–Ω–∏–µ" style="width: 80px; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin: 5px 0; align-items: center;">
                        <select name="default_${i}" style="width: auto; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                            <option value="">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
                            <option value="NULL">NULL</option>
                            <option value="CURRENT_TIMESTAMP">CURRENT_TIMESTAMP</option>
                            <option value="0">0</option>
                            <option value="''">''</option>
                        </select>
                        <select name="collation_${i}" style="width: auto; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                            <option value="">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ</option>
                            <option value="utf8mb4_general_ci">utf8mb4_general_ci</option>
                            <option value="utf8mb4_unicode_ci">utf8mb4_unicode_ci</option>
                        </select>
                        <select name="attributes_${i}" style="width: auto; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                            <option value="">–ê—Ç—Ä–∏–±—É—Ç—ã</option>
                            <option value="UNSIGNED">UNSIGNED</option>
                            <option value="ZEROFILL">ZEROFILL</option>
                        </select>
                        <select name="null_${i}" style="width: auto; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                            <option value="NOT NULL">NOT NULL</option>
                            <option value="NULL">NULL</option>
                        </select>
                        <input type="text" name="comment_${i}" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" style="flex: 1; min-width: 150px; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                    </div>
                `;
                container.appendChild(field);
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
        function generateDataFields(count) {
            const container = document.getElementById('dataRows');
            container.innerHTML = '';
            for (let row = 1; row <= 3; row++) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'data-row';
                for (let col = 1; col <= count; col++) {
                    rowDiv.innerHTML += `
                        <input type="text" name="data_${row}_${col}" placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ ${row}.${col}" style="flex: 1; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                    `;
                }
                container.appendChild(rowDiv);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç–æ–ª–±—Ü–æ–≤
        document.getElementById('column_count').addEventListener('input', function() {
            const count = parseInt(this.value) || 5;
            generateColumnFields(count);
            if (document.getElementById('fillDataToggle').checked) {
                generateDataFields(count);
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç—É–º–±–ª–µ—Ä–∞ "–•–æ—Ç–∏—Ç–µ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ?"
        document.getElementById('fillDataToggle').addEventListener('change', function() {
            const count = parseInt(document.getElementById('column_count').value) || 5;
            const dataFields = document.getElementById('dataFields');
            if (this.checked) {
                dataFields.style.display = 'block';
                generateDataFields(count);
            } else {
                dataFields.style.display = 'none';
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', function() {
            generateColumnFields(5); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 5 —Å—Ç–æ–ª–±—Ü–æ–≤
        });
    </script>
</body>
</html>
actions/create_table.php
<?php
session_start();
require_once '../auth.php';
requireAuth();
require_once '../config.php';
require_once '../log_action.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î.";
    header("Location: ../pages/view_db.php");
    exit;
}

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $table_name = trim($_POST['table_name'] ?? '');
    $column_count = (int)($_POST['column_count'] ?? 0);
    $fill_data = isset($_POST['fill_data']);

    if (!preg_match('/^[a-zA-Z_][a-zA-Z0-9_]*$/', $table_name)) {
        $_SESSION['message'] = "‚ùå –ù–µ–¥–æ–ø—É—Å—Ç–∏–º–æ–µ –∏–º—è —Ç–∞–±–ª–∏—Ü—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ _ (–Ω–µ –Ω–∞—á–∏–Ω–∞–π—Ç–µ —Å —Ü–∏—Ñ—Ä—ã).";
        header("Location: ../pages/view_db.php");
        exit;
    }

    if ($column_count < 1) {
        $_SESSION['message'] = "‚ùå –£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±—Ü–æ–≤.";
        header("Location: ../pages/view_db.php");
        exit;
    }

    $columns = [];
    for ($i = 1; $i <= $column_count; $i++) {
        $name = trim($_POST["column_$i"] ?? '');
        $type = trim($_POST["type_$i"] ?? '');
        $length = trim($_POST["length_$i"] ?? '');
        $default = trim($_POST["default_$i"] ?? '');
        $collation = trim($_POST["collation_$i"] ?? '');
        $attributes = trim($_POST["attributes_$i"] ?? '');
        $null = trim($_POST["null_$i"] ?? '');
        $comment = trim($_POST["comment_$i"] ?? '');

        if (empty($name) || empty($type)) {
            $_SESSION['message'] = "‚ùå –í—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ —Ç–∏–ø—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.";
            header("Location: ../pages/view_db.php");
            exit;
        }

        $type_str = $type;
        if ($length !== '') {
            $type_str .= "($length)";
        }

        $extra_str = '';
        if ($attributes !== '') {
            $extra_str .= " $attributes";
        }
        if ($null !== '') {
            $extra_str .= " $null";
        }
        if ($default !== '') {
            if ($default === 'NULL') {
                $extra_str .= " DEFAULT NULL";
            } elseif ($default === "CURRENT_TIMESTAMP") {
                $extra_str .= " DEFAULT CURRENT_TIMESTAMP";
            } else {
                $extra_str .= " DEFAULT '$default'";
            }
        }
        if ($collation !== '') {
            $extra_str .= " COLLATE $collation";
        }
        if ($comment !== '') {
            $extra_str .= " COMMENT '$comment'";
        }

        $columns[] = "`$name` $type_str$extra_str";
    }

    $sql_structure = implode(', ', $columns);

    try {
        $full_sql = "CREATE TABLE `$table_name` ($sql_structure) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4";
        $pdo->exec($full_sql);

        $log_message = "–¢–∞–±–ª–∏—Ü–∞: $table_name";

        if ($fill_data) {
            $rows_to_insert = 3;
            $inserts = [];
            for ($row = 1; $row <= $rows_to_insert; $row++) {
                $values = [];
                for ($col = 1; $col <= $column_count; $col++) {
                    $val = $_POST["data_{$row}_{$col}"] ?? '';
                    $values[] = $pdo->quote($val);
                }
                $inserts[] = "(" . implode(', ', $values) . ")";
            }

            if (!empty($inserts)) {
                $insert_sql = "INSERT INTO `$table_name` VALUES " . implode(', ', $inserts);
                $pdo->exec($insert_sql);
                $log_message .= ", –≤—Å—Ç–∞–≤–ª–µ–Ω–æ 3 —Å—Ç—Ä–æ–∫–∏";
            }
        }

        $_SESSION['message'] = "‚úÖ –¢–∞–±–ª–∏—Ü–∞ `$table_name` —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞.";
        logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'CREATE_TABLE', $log_message);

    } catch (PDOException $e) {
        $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã: " . htmlspecialchars($e->getMessage());
    }
} else {
    $_SESSION['message'] = "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –º–µ—Ç–æ–¥ –∑–∞–ø—Ä–æ—Å–∞.";
}

header("Location: ../pages/view_db.php");
exit;
?>
actions/delete_record.php 
<?php
// –ù–∞—á–∞–ª–æ —Å–µ—Å—Å–∏–∏ ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
session_start();
require_once '../auth.php';
requireAuth(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
require_once '../config.php';
require_once '../log_action.php';

// –¢–æ–ª—å–∫–æ –¥–ª—è db_admin
if ($_SESSION['role'] !== 'admin') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

$table = $_GET['table'] ?? '';
$id = (int)($_GET['id'] ?? 0);

if (empty($table) || !$id) {
    $_SESSION['message'] = "‚ùå –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.";
    header("Location: ../pages/view_db.php?table=" . urlencode($table));
    exit;
}

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
    $stmt = $pdo->prepare("SHOW TABLES LIKE ?");
    $stmt->execute([$table]);
    if (!$stmt->fetch()) {
        $_SESSION['message'] = "‚ùå –¢–∞–±–ª–∏—Ü–∞ '$table' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.";
        header("Location: ../pages/view_db.php");
        exit;
    }

    // === –û—Å–æ–±–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `backups` ===
    if ($table === 'backups') {
        $stmt = $pdo->prepare("SELECT file_path FROM backups WHERE id = ?");
        $stmt->execute([$id]);
        $backup = $stmt->fetch(PDO::FETCH_ASSOC);

        if (!$backup) {
            $_SESSION['message'] = "‚ùå –ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.";
            header("Location: ../pages/view_db.php?table=backups");
            exit;
        }

        $file_path = $backup['file_path'];

        $stmt = $pdo->prepare("DELETE FROM backups WHERE id = ?");
        if ($stmt->execute([$id])) {
            // –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞
            $full_path = __DIR__ . '/../' . ltrim($file_path, '/');
            if (file_exists($full_path)) {
                if (unlink($full_path)) {
                    $_SESSION['message'] = "‚úÖ –ó–∞–ø–∏—Å—å –∏ —Ñ–∞–π–ª –±—ç–∫–∞–ø–∞ —É–¥–∞–ª–µ–Ω—ã.";
                } else {
                    $_SESSION['message'] = "‚ö†Ô∏è –ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞, –Ω–æ —Ñ–∞–π–ª –Ω–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å –¥–∏—Å–∫–∞.";
                }
            } else {
                $_SESSION['message'] = "‚úÖ –ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞ (—Ñ–∞–π–ª —É–∂–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –Ω–∞ –¥–∏—Å–∫–µ).";
            }
            logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'DELETE_RECORD', "–¢–∞–±–ª–∏—Ü–∞: backups, ID: $id, —Ñ–∞–π–ª: $file_path");
        } else {
            $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏ –∏–∑ –ë–î.";
        }
    } else {
        // –û–±—ã—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∞–±–ª–∏—Ü
        $stmt = $pdo->prepare("DELETE FROM `$table` WHERE id = ?");
        if ($stmt->execute([$id])) {
            $_SESSION['message'] = "‚úÖ –ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞.";
            logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'DELETE_RECORD', "–¢–∞–±–ª–∏—Ü–∞: $table, ID: $id");
        } else {
            $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏.";
        }
    }
} catch (PDOException $e) {
    $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage());
}

header("Location: ../pages/view_db.php?table=" . urlencode($table));
exit;
?>
actions/delete_table.php 
<?php
session_start();
require_once '../auth.php';
requireAuth();
require_once '../config.php';
require_once '../log_action.php';

// –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞
if ($_SESSION['role'] !== 'admin') {
    $_SESSION['message'] = "‚ùå –£–¥–∞–ª—è—Ç—å —Ç–∞–±–ª–∏—Ü—ã –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.";
    header("Location: ../pages/view_db.php");
    exit;
}

$table = $_GET['table'] ?? '';

if (empty($table)) {
    $_SESSION['message'] = "‚ùå –ù–µ —É–∫–∞–∑–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è.";
    header("Location: ../pages/view_db.php");
    exit;
}

// –ó–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
$protected_tables = ['users', 'logs', 'backups'];
if (in_array($table, $protected_tables)) {
    $_SESSION['message'] = "‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ —É–¥–∞–ª—è—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã.";
    header("Location: ../pages/view_db.php");
    exit;
}

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
    $stmt = $pdo->prepare("SHOW TABLES LIKE ?");
    $stmt->execute([$table]);
    if (!$stmt->fetch()) {
        $_SESSION['message'] = "‚ùå –¢–∞–±–ª–∏—Ü–∞ '$table' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.";
        header("Location: ../pages/view_db.php");
        exit;
    }

    // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
    $pdo->exec("DROP TABLE `$table`");
    $_SESSION['message'] = "‚úÖ –¢–∞–±–ª–∏—Ü–∞ '$table' —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞.";

    // –õ–æ–≥–∏—Ä—É–µ–º –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
    logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'DELETE_TABLE', "–¢–∞–±–ª–∏—Ü–∞: $table");

} catch (PDOException $e) {
    $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã: " . htmlspecialchars($e->getMessage());
}

header("Location: ../pages/view_db.php");
exit;
?>
actions/edit_record.php 
<?php
// –ù–∞—á–∞–ª–æ —Å–µ—Å—Å–∏–∏ ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
session_start();
require_once '../auth.php';
requireAuth();
require_once '../config.php';
require_once '../log_action.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: " . htmlspecialchars($e->getMessage()));
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
$stmt = $pdo->prepare("SHOW TABLES LIKE ?");
$stmt->execute([$table]);
if (!$stmt->fetch()) {
    die("–¢–∞–±–ª–∏—Ü–∞ '$table' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.");
}

// –ü–æ–ª—É—á–∞–µ–º –∑–∞–ø–∏—Å—å
$stmt = $pdo->prepare("SELECT * FROM `$table` WHERE id = ?");
$stmt->execute([$id]);
$record = $stmt->fetch(PDO::FETCH_ASSOC);
if (!$record) die("–ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.");

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
if ($_POST && isset($_POST['action']) && $_POST['action'] === 'update') {
    $columns_info = $pdo->query("DESCRIBE `$table`")->fetchAll(PDO::FETCH_ASSOC);
    $set = [];
    $values = [];
    foreach ($columns_info as $col) {
        $field = $col['Field'];
        if ($field === 'id') continue;
        $set[] = "`$field` = ?";
        $value = $_POST[$field] ?? '';
        // –•–µ—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å, –µ—Å–ª–∏ –ø–æ–ª–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è 'password' –∏ –Ω–µ –ø—É—Å—Ç–æ–µ
        if ($field === 'password' && $value !== '') {
            $value = password_hash($value, PASSWORD_DEFAULT);
        }
        $values[] = $value;
    }
    $values[] = $id;
    $sql = "UPDATE `$table` SET " . implode(', ', $set) . " WHERE id = ?";
    $stmt = $pdo->prepare($sql);
    if ($stmt->execute($values)) {
        $_SESSION['message'] = "‚úÖ –ó–∞–ø–∏—Å—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞.";
        logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'EDIT_RECORD', "–¢–∞–±–ª–∏—Ü–∞: $table, ID: $id");
    } else {
        $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.";
    }
    header("Location: ../pages/view_db.php?table=" . urlencode($table));
    exit;
}
?>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å ‚Äî <?= htmlspecialchars($table) ?></title>
    <link rel="stylesheet" href="../css/view_db.css">
</head>
<body>
    <div style="max-width: 800px; margin: 30px auto; background: rgba(30,25,45,0.95); padding: 20px; border-radius: 12px; border: 1px solid #5a1a8f;">
        <h2 style="text-align: center; color: #c7b8ff;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ: <?= htmlspecialchars($table) ?></h2>
        <form method="POST">
            <input type="hidden" name="action" value="update">
            <input type="hidden" name="id" value="<?= $id ?>">
            <?php foreach ($record as $col => $value): ?>
                <?php if ($col === 'id') continue; ?>
                <div style="margin: 12px 0;">
                    <label style="display: block; color: #c7b8ff; margin-bottom: 4px;"><?= htmlspecialchars($col) ?>:</label>
                    <?php if ($col === 'password'): ?>
                        <input type="text" name="<?= $col ?>" value="" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å"
                               style="width: 100%; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px;">
                    <?php else: ?>
                        <input type="text" name="<?= $col ?>" value="<?= htmlspecialchars($value) ?>"
                               style="width: 100%; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px;">
                    <?php endif; ?>
                </div>
            <?php endforeach; ?>
            <div style="text-align: center; margin-top: 20px;">
                <button type="submit" style="background: linear-gradient(to right, #3a0d6a, #5a1a8f); color: white; padding: 10px 24px; border: none; border-radius: 6px; cursor: pointer;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <a href="../pages/view_db.php?table=<?= urlencode($table) ?>" style="color: #ff6b6b; text-decoration: none; margin-left: 15px;">‚ùå –û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
    </div>
</body>
</html>
actions/remove_from_cart.php 
<?php
session_start();
require_once '../auth.php';
requireAuth();

if ($_SESSION['role'] !== 'user') {
    $_SESSION['message'] = "‚ùå –û–ø–µ—Ä–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.";
    header("Location: ../pages/cart.php");
    exit;
}

require_once '../config.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î.";
    header("Location: ../pages/cart.php");
    exit;
}

$action = $_GET['action'] ?? '';
$cart_id = (int)($_GET['id'] ?? 0);

if ($action === 'single' && $cart_id > 0) {
    // –£–¥–∞–ª–∏—Ç—å –æ–¥–Ω—É –∑–∞–ø–∏—Å—å
    $stmt = $pdo->prepare("DELETE FROM cart WHERE id = ? AND user_id = ?");
    if ($stmt->execute([$cart_id, $_SESSION['user_id']])) {
        $_SESSION['message'] = "‚úÖ –¢–æ–≤–∞—Ä —É–¥–∞–ª—ë–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã.";
    } else {
        $_SESSION['message'] = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä.";
    }
} elseif ($action === 'all') {
    // –£–¥–∞–ª–∏—Ç—å –≤—Å—é –∫–æ—Ä–∑–∏–Ω—É
    $stmt = $pdo->prepare("DELETE FROM cart WHERE user_id = ?");
    if ($stmt->execute([$_SESSION['user_id']])) {
        $_SESSION['message'] = "‚úÖ –ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞.";
    } else {
        $_SESSION['message'] = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É.";
    }
} else {
    $_SESSION['message'] = "‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å.";
}

header("Location: ../pages/cart.php");
exit;
?>
api 
api/captcha.php
<?php
session_start();
// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞–ø—á–∏
$pieces = range(1, 4);
shuffle($pieces);
$_SESSION['captcha_solution'] = $pieces;

header('Content-Type: application/json');
echo json_encode(['pieces' => $pieces]);
?>
api/export_table.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

// –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞
if ($_SESSION['role'] !== 'admin') {
    die("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω");
}

require_once '../config.php';
require_once '../vendor/autoload.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
    $table = $_GET['table'] ?? null;
    $format = $_GET['format'] ?? 'json';

    if (!in_array($format, ['json', 'xlsx', 'pdf'])) {
        die("–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ñ–æ—Ä–º–∞—Ç.");
    }

    // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
    $stmt = $pdo->query("SHOW TABLES");
    $all_tables = [];
    while ($row = $stmt->fetch(PDO::FETCH_NUM)) {
        $all_tables[] = $row[0];
    }

    if ($table && !in_array($table, $all_tables)) {
        die("–¢–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.");
    }

    // === –≠–ö–°–ü–û–†–¢ –û–î–ù–û–ô –¢–ê–ë–õ–ò–¶–´ ===
    if ($table) {
        $stmt = $pdo->query("SELECT * FROM `$table`");
        $rows = $stmt->fetchAll(PDO::FETCH_ASSOC);
        $columns = $rows ? array_keys($rows[0]) : [];

        if ($format === 'json') {
            header('Content-Type: application/json');
            header("Content-Disposition: attachment; filename=\"$table.json\"");
            echo json_encode($rows, JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT);
        } elseif ($format === 'xlsx') {
            $spreadsheet = new \PhpOffice\PhpSpreadsheet\Spreadsheet();
            $sheet = $spreadsheet->getActiveSheet();
            $sheet->fromArray($columns, null, 'A1');
            $sheet->fromArray(array_map('array_values', $rows), null, 'A2');
            $writer = new \PhpOffice\PhpSpreadsheet\Writer\Xlsx($spreadsheet);
            header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
            header("Content-Disposition: attachment; filename=\"$table.xlsx\"");
            $writer->save('php://output');
        } elseif ($format === 'pdf') {
            // –ü–æ–¥–∫–ª—é—á–∞–µ–º TCPDF –∏–∑ vendor
            require_once '../vendor/tecnickcom/tcpdf/tcpdf.php';
            $pdf = new \TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);
            $pdf->SetCreator(PDF_CREATOR);
            $pdf->SetTitle("–≠–∫—Å–ø–æ—Ä—Ç —Ç–∞–±–ª–∏—Ü—ã $table");
            $pdf->AddPage();
            $html = "<h2>–¢–∞–±–ª–∏—Ü–∞: $table</h2><table border='1' cellpadding='4'>";
            $html .= "<tr>" . implode('', array_map(fn($c) => "<th>$c</th>", $columns)) . "</tr>";
            foreach ($rows as $row) {
                $html .= "<tr>" . implode('', array_map(fn($v) => "<td>" . htmlspecialchars($v) . "</td>", $row)) . "</tr>";
            }
            $html .= "</table>";
            $pdf->writeHTML($html, true, false, true, false, '');
            $pdf->Output("$table.pdf", 'D');
        }

    // === –≠–ö–°–ü–û–†–¢ –í–°–ï–ô –ë–ê–ó–´ (—Ç–æ–ª—å–∫–æ JSON –∏ XLSX) ===
    } else {
        if ($format === 'pdf') {
            die("PDF –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü.");
        }

        if ($format === 'json') {
            $data = [];
            foreach ($all_tables as $tbl) {
                $stmt = $pdo->query("SELECT * FROM `$tbl`");
                $data[$tbl] = $stmt->fetchAll(PDO::FETCH_ASSOC);
            }
            header('Content-Type: application/json');
            header("Content-Disposition: attachment; filename=\"database_export.json\"");
            echo json_encode($data, JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT);
        } elseif ($format === 'xlsx') {
            $spreadsheet = new \PhpOffice\PhpSpreadsheet\Spreadsheet();
            $first = true;
            foreach ($all_tables as $tbl) {
                if (!$first) {
                    $spreadsheet->createSheet();
                }
                $sheet = $spreadsheet->setActiveSheetIndex($first ? 0 : $spreadsheet->getSheetCount() - 1);
                $sheet->setTitle(substr($tbl, 0, 31)); // Excel: –º–∞–∫—Å. 31 —Å–∏–º–≤–æ–ª
                $stmt = $pdo->query("SELECT * FROM `$tbl`");
                $rows = $stmt->fetchAll(PDO::FETCH_ASSOC);
                $columns = $rows ? array_keys($rows[0]) : ['(–ø—É—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞)'];
                $sheet->fromArray($columns, null, 'A1');
                $sheet->fromArray(array_map('array_values', $rows), null, 'A2');
                $first = false;
            }
            $writer = new \PhpOffice\PhpSpreadsheet\Writer\Xlsx($spreadsheet);
            header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
            header("Content-Disposition: attachment; filename=\"database_export.xlsx\"");
            $writer->save('php://output');
        }
    }

} catch (Exception $e) {
    die("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: " . htmlspecialchars($e->getMessage()));
}
?>
api/get_system_metrics.php
<?php
header('Content-Type: application/json');
session_start();
require_once '../auth.php';
requireAuth();

if ($_SESSION['role'] !== 'admin') {
    http_response_code(403);
    echo json_encode(['error' => '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω']);
    exit;
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∞–ª—å—à–∏–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
$labels = [];
$cpu = [];
$memory = [];
$disk = [];

for ($i = 19; $i >= 0; $i--) {
    $time = date('H:i:s', strtotime("-$i seconds"));
    $labels[] = $time;
    $cpu[] = rand(10, 90);    // CPU –æ—Ç 10% –¥–æ 90%
    $memory[] = rand(20, 85); // –ü–∞–º—è—Ç—å –æ—Ç 20% –¥–æ 85%
    $disk[] = rand(30, 75);   // –î–∏—Å–∫ –æ—Ç 30% –¥–æ 75%
}

echo json_encode([
    'labels' => $labels,
    'cpu' => $cpu,
    'memory' => $memory,
    'disk' => $disk,
    'source' => '–î–∞–Ω–Ω—ã–µ: —Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ (—Ñ–∞–ª—å—à–∏–≤—ã–µ, –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)'
]);
?>
api/mark_notification_read.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

// –¢–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
if ($_SESSION['role'] !== 'user') {
    echo json_encode(['success' => false]);
    exit;
}

require_once '../config.php';

$id = (int)($_GET['id'] ?? 0);
if ($id <= 0) {
    echo json_encode(['success' => false]);
    exit;
}

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    $stmt = $pdo->prepare("UPDATE notifications SET is_read = 1 WHERE id = ? AND user_id = ?");
    $stmt->execute([$id, $_SESSION['user_id']]);

    echo json_encode(['success' => true]);

} catch (PDOException $e) {
    echo json_encode(['success' => false]);
}
?>
backups
backups/backup_20251103_120116.sql
backups/backup_20251103_181820.sql
backups/backup_20251107_054106.sql
css
css/auth.css
/* css/auth.css */

body {
    background: linear-gradient(135deg, #0a0418, #160b2e);
    color: #e0e0e0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

.auth-box {
    background: rgba(30, 25, 45, 0.95);
    padding: 30px;
    border-radius: 12px;
    width: 350px;
    box-shadow: 0 8px 24px rgba(100, 30, 200, 0.4);
    border: 1px solid rgba(100, 60, 180, 0.3);
}

.auth-box h2 {
    text-align: center;
    color: #c7b8ff;
    margin-top: 0;
    margin-bottom: 20px;
}

.auth-box input {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    border: 1px solid #5a1a8f;
    border-radius: 6px;
    background: #1e192d;
    color: white;
    box-sizing: border-box;
}

.auth-box button {
    width: 100%;
    padding: 12px;
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    margin-top: 10px;
}

.auth-box .register-button {
    background: linear-gradient(to right, #00c853, #64dd17);
}

.message {
    text-align: center;
    margin-bottom: 15px;
    padding: 8px;
    border-radius: 6px;
}

.message.error {
    background: rgba(200, 50, 50, 0.3);
    color: #ffaaaa;
}

.message.success {
    background: rgba(40, 200, 80, 0.3);
    color: #aaffaa;
}

.auth-links {
    text-align: center;
    margin-top: 15px;
    font-size: 14px;
}

.auth-links a {
    color: #6ab7ff;
    text-decoration: none;
}
css/billing.css
/* css/billing.css */

/* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±–∏–ª–ª–∏–Ω–≥–∞ */
.billing-container {
    max-width: 1000px;
    margin: 30px auto;
    padding: 0 20px;
}

.invoice-item {
    background: rgba(30, 25, 45, 0.8);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease;
}

.invoice-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 16px rgba(100, 30, 200, 0.4);
}

.invoice-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.invoice-id {
    font-size: 0.9rem;
    color: #a090cc;
}

.invoice-title {
    color: #c7b8ff;
    margin: 0;
    font-size: 1.3rem;
}

.invoice-details {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 10px;
    font-size: 0.95rem;
    color: #d0d0d0;
}

.invoice-total {
    font-size: 1.2rem;
    font-weight: bold;
    color: #6ab7ff;
}

.invoice-date {
    font-size: 0.9rem;
    color: #a090cc;
}

.empty-billing {
    text-align: center;
    color: #aaa;
    font-size: 1.2rem;
    margin: 60px 0;
    padding: 20px;
}
css/cart.css
/* css/cart.css */
.user-panel {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: rgba(20, 15, 35, 0.95);
    padding: 10px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 1000;
    border-bottom: 1px solid rgba(100, 60, 180, 0.3);
}
.user-panel img {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    object-fit: cover;
    border: 1px solid #5a1a8f;
}
.user-panel .user-info {
    font-size: 14px;
    color: #e0e0e0;
}
.user-panel .user-info strong {
    color: #c7b8ff;
}
.content-wrapper {
    margin-top: 60px;
    padding: 20px;
}
.cart-item {
    background: rgba(30, 25, 45, 0.8);
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}
.cart-item h3 {
    margin: 0;
    color: #c7b8ff;
}
.cart-item .price {
    color: #6ab7ff;
    font-weight: bold;
}
.empty-cart {
    text-align: center;
    color: #aaa;
    font-size: 1.2rem;
    margin: 40px 0;
}
.total {
    text-align: right;
    font-size: 1.3rem;
    color: #c7b8ff;
    margin-top: 20px;
}

.checkout-form {
    margin-top: 30px;
    padding: 20px;
    background: rgba(40, 30, 60, 0.8);
    border-radius: 12px;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
    border: 1px solid #5a1a8f;
    box-shadow: 0 4px 12px rgba(100, 30, 200, 0.3);
}
.checkout-form label {
    display: block;
    color: #c7b8ff;
    margin-bottom: 5px;
}
.checkout-form input[type="email"] {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    background: #1e192d;
    border: 1px solid #5a1a8f;
    color: white;
    border-radius: 6px;
    font-size: 14px;
    box-sizing: border-box;
}
.checkout-form button {
    width: 100%;
    padding: 12px;
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
}
.checkout-form button:hover {
    background: linear-gradient(to right, #5a1a8f, #3a0d6a);
}

.cart-item .remove-btn {
    color: #ff6b6b;
    text-decoration: none;
    font-size: 18px;
    margin-left: 10px;
    line-height: 1;
}
.cart-item .remove-btn:hover {
    color: #ff3b3b;
}

.clear-cart {
    display: block;
    margin: 15px auto;
    padding: 8px 16px;
    background: rgba(200, 50, 50, 0.2);
    color: #ff6b6b;
    border: 1px solid #8a3a3a;
    border-radius: 6px;
    text-decoration: none;
    font-size: 14px;
    width: fit-content;
}
.clear-cart:hover {
    background: rgba(200, 50, 50, 0.3);
}
css/create_table.css
/* css/create_table.css */
body {
    background: linear-gradient(135deg, #0a0418, #160b2e);
    color: #e0e0e0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

.form-box {
    background: rgba(30, 25, 45, 0.95);
    padding: 30px;
    border-radius: 12px;
    width: 600px;
    box-shadow: 0 8px 24px rgba(100, 30, 200, 0.4);
    border: 1px solid rgba(100, 60, 180, 0.3);
}

.form-box h2 {
    text-align: center;
    color: #c7b8ff;
    margin-top: 0;
    margin-bottom: 20px;
}

.form-box label {
    display: block;
    color: #c7b8ff;
    margin-bottom: 4px;
}

.form-box input,
.form-box select {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    border: 1px solid #5a1a8f;
    border-radius: 6px;
    background: #1e192d;
    color: white;
    box-sizing: border-box;
    font-family: monospace;
    font-size: 14px;
}

.column-field {
    margin: 10px 0;
    padding: 10px;
    background: rgba(40, 35, 55, 0.7);
    border-radius: 6px;
}

.data-row {
    display: flex;
    gap: 10px;
    margin: 5px 0;
}

.buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 20px;
}

.buttons button {
    flex: 1;
    padding: 12px;
    background: linear-gradient(to right, #00c853, #64dd17);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
}

.buttons button:last-child {
    background: linear-gradient(to right, #ff3b3b, #ff6b6b);
}

.buttons button:hover {
    opacity: 0.9;
}
css/db_admin_dashboard.css
/* css/db_admin_dashboard.css */

body {
    background: linear-gradient(135deg, #0a0418, #160b2e);
    color: #e0e0e0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    min-height: 100vh;
}

.topbar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: rgba(20, 15, 35, 0.95);
    padding: 10px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 1000;
    border-bottom: 1px solid rgba(100, 60, 180, 0.3);
}

.topbar img {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    object-fit: cover;
    border: 1px solid #5a1a8f;
}

.user-info {
    font-size: 14px;
    color: #e0e0e0;
}

.user-info strong {
    color: #c7b8ff;
}

.user-info .role {
    font-size: 12px;
    color: #8ab7ff;
}

.content-wrapper {
    margin-top: 60px;
    padding: 0 20px;
}

.dashboard-header {
    text-align: center;
    color: #c7b8ff;
    margin: 30px 0 20px;
}

.quick-actions {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 20px 0 40px;
    flex-wrap: wrap;
}

.quick-btn {
    padding: 12px 24px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: bold;
    font-size: 16px;
    transition: all 0.3s ease;
    display: inline-block;
    text-align: center;
    min-width: 180px;
}

.btn-db {
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: white;
}

.btn-create {
    background: linear-gradient(to right, #00c853, #64dd17);
    color: white;
}

.btn-backup {
    background: linear-gradient(to right, #ff9800, #ffcc00);
    color: #000;
}

.btn-sql {
    background: linear-gradient(to right, #d32f2f, #f44336);
    color: white;
}

.quick-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 16px rgba(100, 30, 200, 0.5);
}

.tables-section {
    max-width: 1000px;
    margin: 0 auto;
    background: rgba(30, 25, 45, 0.8);
    border-radius: 12px;
    padding: 20px;
    border: 1px solid rgba(100, 60, 180, 0.3);
}

.tables-section h3 {
    color: #c7b8ff;
    margin-top: 0;
    margin-bottom: 15px;
    text-align: center;
}

.tables-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 12px;
}

.table-link {
    display: block;
    padding: 10px;
    background: rgba(40, 30, 60, 0.7);
    color: #6ab7ff;
    text-decoration: none;
    border-radius: 6px;
    text-align: center;
    transition: background 0.2s ease;
}

.table-link:hover {
    background: rgba(100, 80, 150, 0.4);
}

.footer {
    text-align: center;
    padding: 20px;
    color: #6a5a8f;
    font-size: 0.9rem;
    margin-top: 60px;
    border-top: 1px solid rgba(100, 60, 180, 0.2);
}
css/db_admin.css
/* css/db_admin.css */

/* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ —Ç–µ–ª–∞ */
body {
    background: linear-gradient(135deg, #0a0418, #160b2e);
    color: #e0e0e0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    line-height: 1.6;
}

/* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
.topbar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: rgba(20, 15, 35, 0.95);
    padding: 10px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 1000;
    border-bottom: 1px solid rgba(100, 60, 180, 0.3);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
}

.topbar img {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    object-fit: cover;
    border: 1px solid #5a1a8f;
}

.user-info {
    font-size: 14px;
    color: #e0e0e0;
}

.user-info strong {
    color: #c7b8ff;
}

.user-info .role {
    font-size: 12px;
    color: #8ab7ff;
}

/* –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–µ–Ω—é */
.nav-menu {
    display: flex;
    gap: 15px;
    margin-left: auto;
    font-size: 14px;
}

.nav-menu a {
    color: #e0e0e0;
    text-decoration: none;
    transition: color 0.2s ease;
}

.nav-menu a:hover {
    color: #6ab7ff;
}

.nav-menu a.logout {
    color: #ff6b6b;
}

.nav-menu a.logout:hover {
    color: #ff3b3b;
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (—Å –æ—Ç—Å—Ç—É–ø–æ–º –ø–æ–¥ –ø–∞–Ω–µ–ª—å) */
.content-wrapper {
    margin-top: 60px;
    padding: 0 20px;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã –∏ –∫–Ω–æ–ø–∫–∏ */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding: 10px 0;
    border-bottom: 1px solid rgba(100, 60, 180, 0.3);
}

.header-title {
    color: #c7b8ff;
    font-size: 1.5rem;
    margin: 0;
}

.header-buttons {
    display: flex;
    gap: 10px;
}

.btn-add, .btn-delete-table {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    text-decoration: none;
    font-size: 14px;
    color: white;
}

.btn-add {
    background: linear-gradient(to right, #00c853, #64dd17);
}

.btn-delete-table {
    background: linear-gradient(to right, #ff3b3b, #ff6b6b);
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–∞–±–ª–∏—Ü—ã */
.table-container {
    background: rgba(30, 25, 45, 0.8);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 10px;
    overflow-x: auto;
    margin-bottom: 20px;
}

/* –°—Ç–∏–ª–∏ —Ç–∞–±–ª–∏—Ü—ã */
table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
    color: #d0d0d0;
}

th {
    background: #3a0d6a;
    color: #f0e6ff;
    padding: 8px 12px;
    font-weight: 600;
    text-align: left;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    font-size: 13px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    white-space: nowrap;
}

td {
    padding: 8px 12px;
    color: #ffffff;
    border-bottom: 1px solid rgba(100, 80, 130, 0.2);
    font-size: 13px;
    line-height: 1.4;
    word-wrap: break-word;
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
}

tr:last-child td {
    border-bottom: none;
}

tr:nth-child(even) {
    background: rgba(40, 35, 55, 0.7);
}

tr:hover {
    background: rgba(100, 80, 150, 0.2) !important;
    transition: background 0.3s ease;
}

/* –î–µ–π—Å—Ç–≤–∏—è (–∫–Ω–æ–ø–∫–∏ –ò–∑–º/–£–¥) */
.actions {
    text-align: center;
    white-space: nowrap;
    padding: 6px !important;
}

.btn-edit, .btn-delete {
    text-decoration: none;
    padding: 4px 8px;
    border-radius: 4px;
    margin: 0 2px;
    display: inline-block;
    font-weight: bold;
    font-size: 12px;
}

.btn-edit {
    color: #6ab7ff;
    background: rgba(106, 183, 255, 0.1);
}

.btn-delete {
    color: #ff6b6b;
    background: rgba(255, 107, 107, 0.1);
}

.btn-edit:hover, .btn-delete:hover {
    opacity: 0.9;
}

/* –¶–≤–µ—Ç–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ */
.status-success {
    background: rgba(40, 200, 80, 0.3);
    color: #aaffaa;
}

.status-failed {
    background: rgba(200, 50, 50, 0.3);
    color: #ffaaaa;
}

/* –§—É—Ç–µ—Ä */
.footer {
    text-align: center;
    padding: 20px;
    color: #6a5a8f;
    font-size: 0.9rem;
    margin-top: 40px;
    border-top: 1px solid rgba(100, 60, 180, 0.2);
}
css/engineer_dashboard.css
/* css/engineer_dashboard.css */

/* –û–±—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.content-wrapper {
    margin-top: 60px;
    padding: 0 20px;
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ –ø–∞–Ω–µ–ª–∏ */
.engineer-panel {
    max-width: 800px;
    margin: 30px auto;
    padding: 20px;
    background: rgba(30, 25, 45, 0.8);
    border-radius: 12px;
    border: 1px solid rgba(100, 60, 180, 0.3);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
.engineer-header {
    text-align: center;
    color: #c7b8ff;
    margin-bottom: 20px;
    font-size: 1.8rem;
}

/* –ë–ª–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ */
.incidents-section {
    background: rgba(40, 30, 60, 0.9);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.incident-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid rgba(100, 80, 130, 0.2);
}

.incident-item:last-child {
    border-bottom: none;
}

.incident-title {
    color: #6ab7ff;
    font-weight: bold;
    flex: 1;
}

.incident-status {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: bold;
    text-align: center;
}

.status-open {
    background: rgba(50, 100, 255, 0.3);
    color: #aaffaa;
}

.status-in_progress {
    background: rgba(255, 165, 0, 0.3);
    color: #ffcc66;
}

.incident-actions a {
    display: inline-block;
    margin-left: 10px;
    padding: 4px 8px;
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-size: 0.9rem;
}

/* –ë–ª–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ */
.servers-section {
    background: rgba(40, 30, 60, 0.9);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.server-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid rgba(100, 80, 130, 0.2);
}

.server-item:last-child {
    border-bottom: none;
}

.server-name {
    color: #c7b8ff;
    font-weight: bold;
    flex: 1;
}

.server-ip {
    color: #d0d0d0;
    margin: 0 10px;
}

.server-status {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: bold;
    text-align: center;
}

.status-online {
    background: rgba(40, 200, 80, 0.3);
    color: #aaffaa;
}

.status-offline {
    background: rgba(200, 50, 50, 0.3);
    color: #ffaaaa;
}

.status-maintenance {
    background: rgba(255, 165, 0, 0.3);
    color: #ffcc66;
}
css/guest.css
/* css/guest.css */
body {
    background: linear-gradient(135deg, #0a0418, #160b2e);
    color: #e0e0e0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

.header {
    text-align: center;
    padding: 40px 20px 20px;
}

.header h1 {
    font-size: 2.5rem;
    color: #c7b8ff;
    margin: 0;
    text-shadow: 0 0 10px rgba(150, 100, 255, 0.5);
}

.header p {
    font-size: 1.2rem;
    margin-top: 10px;
    color: #a090cc;
}

.services-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    max-width: 1200px;
    margin: 30px auto;
    padding: 0 20px;
}

.service-card {
    background: rgba(30, 25, 45, 0.8);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease;
}

.service-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(100, 30, 200, 0.5);
}

.service-card .card-icon {
    font-size: 2rem;
    margin-bottom: 10px;
    color: #c7b8ff;
}

.service-card h3 {
    color: #c7b8ff;
    margin-top: 0;
    margin-bottom: 10px;
}

.service-card p {
    font-size: 0.95rem;
    color: #d0d0d0;
    line-height: 1.5;
}

.support-section {
    max-width: 900px;
    margin: 30px auto;
    padding: 20px;
    text-align: center;
}

.support-section h2 {
    color: #c7b8ff;
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 1.6rem;
}

.support-section p {
    color: #a090cc;
    margin-bottom: 20px;
}

.support-info {
    display: flex;
    justify-content: center;
    gap: 30px;
    flex-wrap: wrap;
    margin-top: 20px;
}

.contact-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1rem;
    color: #d0d0d0;
}

.contact-item .icon {
    font-size: 1.2rem;
    color: #c7b8ff;
}

.actions {
    text-align: center;
    padding: 20px;
}

.btn {
    display: inline-block;
    padding: 12px 30px;
    margin: 0 10px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: bold;
    font-size: 16px;
    transition: all 0.3s ease;
}

.btn-login {
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: white;
}

.btn-register {
    background: linear-gradient(to right, #00c853, #64dd17);
    color: white;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(100, 30, 200, 0.5);
}

footer {
    text-align: center;
    padding: 20px;
    color: #6a5a8f;
    font-size: 0.9rem;
    margin-top: auto;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .header h1 {
        font-size: 2rem;
    }
    .header p {
        font-size: 1rem;
    }
    .services-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    .service-card {
        padding: 15px;
    }
    .support-info {
        flex-direction: column;
        gap: 15px;
    }
    .btn {
        display: block;
        width: 200px;
        margin: 10px auto;
    }
}
css/history.css
/* css/history.css */
.content-wrapper {
    margin-top: 60px;
    padding: 0 20px;
}
.purchases-list {
    max-width: 1000px;
    margin: 30px auto;
    padding: 20px;
}
.purchase-item {
    background: rgba(30, 25, 45, 0.8);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}
.purchase-item h3 {
    color: #c7b8ff;
    margin: 0 0 10px;
}
.purchase-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
    font-size: 0.95rem;
    color: #d0d0d0;
}
.purchase-price {
    font-size: 1.2rem;
    font-weight: bold;
    color: #6ab7ff;
}
.purchase-date {
    font-size: 0.9rem;
    color: #a090cc;
}
.empty-history {
    text-align: center;
    color: #aaa;
    font-size: 1.2rem;
    margin: 60px 0;
}
.buy-more-btn {
    display: inline-block;
    padding: 12px 30px;
    background: linear-gradient(to right, #00c853, #64dd17);
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-weight: bold;
    font-size: 16px;
    transition: all 0.3s ease;
    margin-top: 30px;
}
.buy-more-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(100, 30, 200, 0.5);
}
css/index.css
/* css/index.css */

body {
    background: linear-gradient(135deg, #0a0418, #160b2e);
    color: #e0e0e0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

.header {
    text-align: center;
    padding: 40px 20px 20px;
}

.header h1 {
    font-size: 2.5rem;
    color: #c7b8ff;
    margin: 0;
    text-shadow: 0 0 10px rgba(150, 100, 255, 0.5);
}

.header p {
    font-size: 1.2rem;
    margin-top: 10px;
    color: #a090cc;
}

.services-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    max-width: 1200px;
    margin: 30px auto;
    padding: 0 20px;
}

.service-card {
    background: rgba(30, 25, 45, 0.8);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease;
}

.service-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(100, 30, 200, 0.5);
}

.service-card .card-icon {
    font-size: 2rem;
    margin-bottom: 10px;
    color: #c7b8ff;
}

.service-card h3 {
    color: #c7b8ff;
    margin-top: 0;
    margin-bottom: 10px;
}

.service-card p {
    font-size: 0.95rem;
    color: #d0d0d0;
    line-height: 1.5;
}

.support-section {
    max-width: 900px;
    margin: 30px auto;
    padding: 20px;
    text-align: center;
}

.support-section h2 {
    color: #c7b8ff;
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 1.6rem;
}

.support-section p {
    color: #a090cc;
    margin-bottom: 20px;
}

.support-info {
    display: flex;
    justify-content: center;
    gap: 30px;
    flex-wrap: wrap;
    margin-top: 20px;
}

.contact-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1rem;
    color: #d0d0d0;
}

.contact-item .icon {
    font-size: 1.2rem;
    color: #c7b8ff;
}

.actions {
    text-align: center;
    padding: 20px;
}

.btn {
    display: inline-block;
    padding: 12px 30px;
    margin: 0 10px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: bold;
    font-size: 16px;
    transition: all 0.3s ease;
}

.btn-login {
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: white;
}

.btn-register {
    background: linear-gradient(to right, #00c853, #64dd17);
    color: white;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(100, 30, 200, 0.5);
}

footer {
    text-align: center;
    padding: 20px;
    color: #6a5a8f;
    font-size: 0.9rem;
    margin-top: auto;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .header h1 {
        font-size: 2rem;
    }
    .header p {
        font-size: 1rem;
    }
    .services-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    .service-card {
        padding: 15px;
    }
    .support-info {
        flex-direction: column;
        gap: 15px;
    }
    .btn {
        display: block;
        width: 200px;
        margin: 10px auto;
    }
}
css/manager_dashboard.css
/* css/manager_dashboard.css */
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin: 20px 0 30px;
}
.stat-card {
    background: rgba(40, 30, 60, 0.8);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
.stat-value {
    font-size: 2rem;
    font-weight: bold;
    color: #6ab7ff;
    margin: 10px 0;
}
.stat-label {
    color: #a090cc;
    font-size: 0.95rem;
}
.welcome-banner {
    text-align: center;
    padding: 12px;
    background: rgba(40, 100, 40, 0.3);
    color: #aaffaa;
    margin: 10px auto 20px;
    max-width: 600px;
    border-radius: 8px;
    border: 1px solid #3a8a3a;
}
.section-title {
    color: #c7b8ff;
    margin: 25px 0 15px;
    font-size: 1.4rem;
    text-align: center;
}
.incident-list {
    list-style: none;
    padding: 0;
    max-width: 800px;
    margin: 0 auto;
}
.incident-item {
    padding: 10px;
    border-bottom: 1px solid rgba(100, 80, 130, 0.2);
    color: #d0d0d0;
}
.incident-item:last-child {
    border-bottom: none;
}
.status-badge {
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: bold;
}
.status-open { background: rgba(50, 100, 255, 0.3); color: #aaffaa; }
.status-in_progress { background: rgba(255, 165, 0, 0.3); color: #ffcc66; }
.status-resolved,
.status-closed { background: rgba(40, 200, 80, 0.3); color: #aaffaa; }

/* –ì—Ä–∞—Ñ–∏–∫–∏ */
.charts-container {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 20px;
    margin: 20px 0 30px;
}
.chart-box {
    background: rgba(30, 25, 45, 0.8);
    padding: 15px;
    border-radius: 12px;
    border: 1px solid rgba(100, 60, 180, 0.3);
    height: 200px;
    position: relative;
}
.chart-box h3 {
    color: #c7b8ff;
    text-align: center;
    margin-top: 0;
    margin-bottom: 5px;
}
.chart-box canvas {
    width: 100% !important;
    height: 150px !important;
}
css/notifications.css
/* css/notifications.css */
.notifications-list {
    max-width: 800px;
    margin: 30px auto;
    padding: 0 20px;
}
.notification-item {
    background: rgba(30, 25, 45, 0.8);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    position: relative;
}
.notification-item.unread {
    border-left: 4px solid #ffcc00;
}
.notification-title {
    color: #c7b8ff;
    margin: 0 0 10px;
    font-size: 1.2rem;
}
.notification-content {
    color: #d0d0d0;
    line-height: 1.5;
    margin-bottom: 10px;
}
.notification-date {
    font-size: 0.9rem;
    color: #a090cc;
    text-align: right;
}
.notification-type {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 0.8rem;
    padding: 2px 6px;
    border-radius: 4px;
    background: rgba(100, 80, 150, 0.3);
}
.mark-read {
    display: inline-block;
    margin-top: 10px;
    padding: 4px 8px;
    background: rgba(100, 80, 150, 0.3);
    color: #6ab7ff;
    border-radius: 4px;
    font-size: 0.8rem;
    cursor: pointer;
}
css/payment_method.css
/* css/payment_method.css */
.payment-box {
    max-width: 400px;
    margin: 30px auto;
    padding: 20px;
    background: rgba(30, 25, 45, 0.95);
    border-radius: 12px;
    border: 1px solid #5a1a8f;
    box-shadow: 0 4px 12px rgba(100, 30, 200, 0.3);
}
.payment-box h2 {
    color: #c7b8ff;
    text-align: center;
}
.payment-box label {
    display: block;
    color: #c7b8ff;
    margin: 15px 0 5px;
}
.payment-box input[type="radio"] {
    margin-right: 10px;
}
.payment-box button {
    width: 100%;
    padding: 12px;
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    margin-top: 20px;
    font-weight: bold;
}
.payment-box button:hover {
    background: linear-gradient(to right, #5a1a8f, #3a0d6a);
}
css/purchased.css
/* css/purchased.css */

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –ø–æ–∫—É–ø–æ–∫ */
.purchased-item {
    background: rgba(30, 25, 45, 0.8);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease;
}
.purchased-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 16px rgba(100, 30, 200, 0.4);
}
.purchased-item h3 {
    color: #6ab7ff;
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 1.3rem;
}
.purchased-item .price {
    color: #c7b8ff;
    font-weight: bold;
    font-size: 1.1rem;
}
.empty-purchases {
    text-align: center;
    color: #aaa;
    font-size: 1.2rem;
    margin: 50px 0;
    padding: 20px;
}
.empty-purchases img {
    width: 60px;
    opacity: 0.5;
    margin-bottom: 15px;
}

/* –ö–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å –µ—â—ë" */
.buy-more-btn {
    display: inline-block;
    padding: 12px 30px;
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-weight: bold;
    font-size: 16px;
    transition: all 0.3s ease;
    margin-top: 10px;
}
.buy-more-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(100, 30, 200, 0.5);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .purchased-item {
        padding: 15px;
    }
    .purchased-item h3 {
        font-size: 1.2rem;
    }
    .buy-more-btn {
        display: block;
        width: 200px;
        margin: 20px auto 0;
        text-align: center;
    }
}
css/referral.css
/* css/referral.css */

/* –û–±—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.content-wrapper {
    margin-top: 60px;
    padding: 0 20px;
}

.referral-container {
    max-width: 600px;
    margin: 30px auto;
    padding: 20px;
    background: rgba(30, 25, 45, 0.8);
    border-radius: 12px;
    border: 1px solid rgba(100, 60, 180, 0.3);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.referral-header {
    text-align: center;
    color: #c7b8ff;
    margin: 0 0 15px;
    font-size: 1.8rem;
    display: flex;
    align-items: center;
    gap: 10px;
}
.referral-header .icon {
    font-size: 1.4rem;
    color: #ffcc00;
}

.referral-intro {
    color: #a090cc;
    text-align: center;
    margin: 0 0 20px;
    font-size: 0.95rem;
}

.referral-link-box {
    background: rgba(40, 30, 60, 0.9);
    padding: 15px;
    border-radius: 6px;
    margin: 15px 0;
    word-break: break-all;
    font-family: monospace;
    font-size: 0.9rem;
    color: #6ab7ff;
    border: 1px solid #5a1a8f;
    position: relative;
}

.referral-link-box::before {
    content: "üîó ";
    position: absolute;
    left: 10px;
    top: 10px;
    color: #ffcc00;
    font-weight: bold;
}

.referral-link-box input {
    width: 100%;
    background: transparent;
    border: none;
    color: inherit;
    font-family: inherit;
    font-size: inherit;
    padding: 0;
    margin: 0;
    cursor: pointer;
    text-align: center;
    outline: none;
}

.referral-link-box input:focus {
    outline: none;
}

.referral-copy-btn {
    display: block;
    width: 100%;
    padding: 8px;
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 10px;
    font-size: 0.9rem;
    font-weight: bold;
    transition: opacity 0.3s ease;
}

.referral-copy-btn:hover {
    opacity: 0.9;
}

.referral-stats {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    margin: 20px 0;
    padding: 15px;
    background: rgba(40, 30, 60, 0.7);
    border-radius: 6px;
    border: 1px solid rgba(100, 60, 180, 0.2);
}

.stat-item {
    text-align: center;
    flex: 1;
}

.stat-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: #6ab7ff;
    margin: 5px 0;
}

.stat-label {
    font-size: 0.9rem;
    color: #a090cc;
}

.referral-info {
    margin-top: 20px;
    color: #a090cc;
    font-size: 0.9rem;
    line-height: 1.5;
    text-align: center;
}

.back-btn {
    display: inline-block;
    padding: 10px 24px;
    background: linear-gradient(to right, #00c853, #64dd17);
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-weight: bold;
    margin-top: 30px;
    font-size: 16px;
    transition: all 0.3s ease;
    float: right;
}

.back-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(100, 30, 200, 0.5);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .referral-container {
        margin: 15px;
        padding: 15px;
    }
    .referral-stats {
        flex-direction: column;
        gap: 10px;
    }
    .stat-value {
        font-size: 1.3rem;
    }
    .back-btn {
        float: none;
        width: 100%;
        text-align: center;
    }
}
css/services.css
/* css/services.css */
body {
    background: linear-gradient(135deg, #0a0418, #160b2e);
    color: #e0e0e0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    line-height: 1.6;
}

.header {
    text-align: center;
    padding: 40px 20px 20px;
}

.header h1 {
    font-size: 2.5rem;
    color: #c7b8ff;
    margin: 0;
    text-shadow: 0 0 10px rgba(150, 100, 255, 0.5);
}

.header p {
    font-size: 1.2rem;
    margin-top: 10px;
    color: #a090cc;
}

.services-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px 40px;
}

.services-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
    margin-top: 20px;
}

.service-card {
    background: rgba(30, 25, 45, 0.8);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 25px;
    text-align: center;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease;
}

.service-card:hover {
    transform: translateY(-5px);
}

.service-card h3 {
    color: #c7b8ff;
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 1.4rem;
}

.service-card p {
    font-size: 0.95rem;
    color: #d0d0d0;
    line-height: 1.5;
    margin-bottom: 15px;
}

.service-card .price {
    font-size: 1.2rem;
    font-weight: bold;
    color: #6ab7ff;
    margin: 10px 0;
}

.btn-cart {
    display: inline-block;
    padding: 8px 20px;
    background: linear-gradient(to right, #00c853, #64dd17);
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-weight: bold;
    margin-top: 10px;
    cursor: pointer;
}

.btn-cart:hover {
    opacity: 0.9;
}

.actions {
    text-align: center;
    padding: 20px;
}

.btn {
    display: inline-block;
    padding: 10px 24px;
    margin: 0 8px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: bold;
    font-size: 16px;
    transition: all 0.3s ease;
}

.btn-back {
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: white;
}

.btn-login {
    background: linear-gradient(to right, #00c853, #64dd17);
    color: white;
}

.btn-logout {
    background: linear-gradient(to right, #ff3b3b, #ff6b6b);
    color: white;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(100, 30, 200, 0.5);
}

.no-services {
    text-align: center;
    color: #aaa;
    font-size: 1.2rem;
    margin: 60px 0;
}
/* css/services.css ‚Äî –î–û–ü–û–õ–ù–ï–ù–ò–ï (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–¥–µ–ª–∏—Ç—å –æ—Ç userbar) */
.services-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px 40px;
}
.services-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
    margin-top: 20px;
}
.service-card {
    background: rgba(30, 25, 45, 0.8);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 25px;
    text-align: center;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease;
}
.service-card:hover {
    transform: translateY(-5px);
}
.service-card h3 {
    color: #c7b8ff;
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 1.4rem;
}
.service-card p {
    font-size: 0.95rem;
    color: #d0d0d0;
    line-height: 1.5;
    margin-bottom: 15px;
}
.service-card .price {
    font-size: 1.2rem;
    font-weight: bold;
    color: #6ab7ff;
    margin: 10px 0;
}
.btn-cart {
    display: inline-block;
    padding: 8px 20px;
    background: linear-gradient(to right, #00c853, #64dd17);
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-weight: bold;
    margin-top: 10px;
    cursor: pointer;
}
.btn-cart:hover {
    opacity: 0.9;
}
.no-services {
    text-align: center;
    color: #aaa;
    font-size: 1.2rem;
    margin: 60px 0;
}

/* –ü–∞–∫–µ—Ç—ã */
.packages-section {
    margin-top: 40px;
}
.packages-section h2 {
    color: #c7b8ff;
    margin-bottom: 20px;
    text-align: center;
}
.packages-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
    margin-top: 20px;
}
.package-card {
    background: rgba(30, 25, 45, 0.8);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 25px;
    text-align: center;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease;
}
.package-card:hover {
    transform: translateY(-5px);
}
.package-card h3 {
    color: #c7b8ff;
    margin: 0 0 15px;
    font-size: 1.4rem;
}
.package-card .price {
    font-size: 1.8rem;
    font-weight: bold;
    color: #6ab7ff;
    margin: 10px 0;
}
.package-card ul {
    list-style: none;
    padding: 0;
    margin: 20px 0;
    text-align: left;
    font-size: 0.95rem;
    color: #d0d0d0;
}
.package-card ul li {
    margin-bottom: 8px;
    padding-left: 20px;
    position: relative;
}
.package-card ul li::before {
    content: "‚úì";
    color: #00c853;
    position: absolute;
    left: 0;
    font-weight: bold;
}
.package-card .btn {
    display: inline-block;
    padding: 10px 20px;
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-weight: bold;
    margin-top: 10px;
}
/* –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
.user-panel {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: rgba(20, 15, 35, 0.95);
    padding: 10px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 1000;
    border-bottom: 1px solid rgba(100, 60, 180, 0.3);
}

.user-panel img {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    object-fit: cover;
    border: 1px solid #5a1a8f;
}

.user-info {
    font-size: 14px;
    color: #e0e0e0;
}

.user-info strong {
    color: #c7b8ff;
}

.user-info .role {
    font-size: 12px;
    color: #8ab7ff;
}

.user-menu {
    margin-left: auto;
    display: flex;
    gap: 15px;
}

.user-menu a {
    color: #e0e0e0;
    text-decoration: none;
    font-size: 14px;
    transition: color 0.2s ease;
}

.user-menu a:hover {
    color: #6ab7ff;
}

.user-menu a.logout {
    color: #ff6b6b;
}

.user-menu a.logout:hover {
    color: #ff3b3b;
}
css/support_tickets_all.css
/* css/support_tickets_all.css */
.support-container {
    max-width: 1000px;
    margin: 30px auto;
    padding: 0 20px;
}
.ticket-item {
    background: rgba(40, 30, 60, 0.8);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}
.ticket-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}
.ticket-status {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: bold;
}
.status-open {
    background: rgba(40, 200, 80, 0.3);
    color: #aaffaa;
}
.status-closed {
    background: rgba(200, 50, 50, 0.3);
    color: #ffaaaa;
}
.ticket-body {
    color: #d0d0d0;
    line-height: 1.5;
    white-space: pre-wrap;
}
.ticket-date {
    font-size: 0.9rem;
    color: #a090cc;
    margin-top: 10px;
}
.empty-tickets {
    text-align: center;
    color: #aaa;
    font-size: 1.2rem;
    margin: 60px 0;
}
css/support.css
/* css/support.css */

.support-container {
    max-width: 800px;
    margin: 30px auto;
    padding: 0 20px;
}

.ticket-form {
    background: rgba(30, 25, 45, 0.8);
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 30px;
    border: 1px solid rgba(100, 60, 180, 0.3);
}

.ticket-form input,
.ticket-form textarea {
    width: 100%;
    padding: 10px;
    margin: 8px 0;
    background: #1e192d;
    border: 1px solid #5a1a8f;
    color: white;
    border-radius: 6px;
    font-size: 14px;
    box-sizing: border-box;
}

.ticket-form button {
    width: 100%;
    padding: 12px;
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    margin-top: 10px;
    font-weight: bold;
    transition: opacity 0.3s ease;
}

.ticket-form button:hover {
    opacity: 0.9;
}

.ticket-item {
    background: rgba(40, 30, 60, 0.8);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.ticket-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.ticket-status {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: bold;
}

.status-open {
    background: rgba(40, 200, 80, 0.3);
    color: #aaffaa;
}

.status-closed {
    background: rgba(200, 50, 50, 0.3);
    color: #ffaaaa;
}

.ticket-body {
    color: #d0d0d0;
    line-height: 1.5;
    white-space: pre-wrap;
}

.ticket-date {
    font-size: 0.9rem;
    color: #a090cc;
    margin-top: 10px;
}

.empty-tickets {
    text-align: center;
    color: #aaa;
    font-size: 1.2rem;
    margin: 60px 0;
}
css/tariffs.css
/* css/tariffs.css */
.tariffs-section {
    max-width: 1200px;
    margin: 40px auto;
    padding: 0 20px;
}

.tariffs-section h2 {
    text-align: center;
    color: #c7b8ff;
    margin-bottom: 30px;
    font-size: 2rem;
}

.packages-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
    margin-bottom: 50px;
}

.package-card {
    background: rgba(30, 25, 45, 0.8);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 25px;
    text-align: center;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease;
}

.package-card:hover {
    transform: translateY(-5px);
}

.package-card.recommended {
    border: 2px solid #ffcc00;
    background: rgba(40, 30, 60, 0.9);
    position: relative;
}

.package-card.recommended::before {
    content: "üåü –†–ï–ö–û–ú–ï–ù–î–£–ï–ú";
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    background: #ffcc00;
    color: #000;
    font-weight: bold;
    padding: 2px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
}

.package-card h3 {
    color: #c7b8ff;
    margin: 0 0 15px;
    font-size: 1.4rem;
}

.package-card .price {
    font-size: 1.8rem;
    font-weight: bold;
    color: #6ab7ff;
    margin: 10px 0;
}

.package-card .price-label {
    font-size: 0.9rem;
    color: #a090cc;
}

.package-card ul {
    list-style: none;
    padding: 0;
    margin: 20px 0;
    text-align: left;
    font-size: 0.95rem;
    color: #d0d0d0;
}

.package-card ul li {
    margin-bottom: 8px;
    padding-left: 20px;
    position: relative;
}

.package-card ul li::before {
    content: "‚úì";
    color: #00c853;
    position: absolute;
    left: 0;
    font-weight: bold;
}

.package-card .btn {
    display: inline-block;
    padding: 10px 20px;
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-weight: bold;
    margin-top: 10px;
}

.package-card.recommended .btn {
    background: linear-gradient(to right, #ff9800, #ffcc00);
    color: #000;
}

/* –û—Ç–¥–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ */
.services-list {
    max-width: 900px;
    margin: 0 auto;
    padding: 0 20px;
}

.services-list h2 {
    text-align: center;
    color: #c7b8ff;
    margin: 40px 0 20px;
    font-size: 1.8rem;
}

.service-item {
    display: flex;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid rgba(100, 60, 180, 0.2);
    font-size: 1rem;
}

.service-item:last-child {
    border-bottom: none;
}

.service-item .desc {
    color: #e0e0e0;
    flex: 1;
}

.service-item .price {
    color: #6ab7ff;
    font-weight: bold;
    min-width: 80px;
    text-align: right;
}

/* –ö–∞—Ä—Ç–æ—á–∫–∞ "–ü–æ–¥–∫–ª—é—á–∏—Ç–µ —É—Å–ª—É–≥–∏" */
.connect-services {
    background: rgba(40, 30, 60, 0.8);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 30px;
    text-align: center;
    margin: 40px auto;
    max-width: 600px;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
}

.connect-services h3 {
    color: #c7b8ff;
    margin: 0 0 15px;
    font-size: 1.6rem;
}

.connect-services p {
    color: #d0d0d0;
    margin: 0 0 20px;
    line-height: 1.5;
}

.connect-services .btn {
    display: inline-block;
    padding: 12px 30px;
    background: linear-gradient(to right, #00c853, #64dd17);
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-weight: bold;
    font-size: 16px;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .packages-grid {
        grid-template-columns: 1fr;
    }
    .service-item {
        flex-direction: column;
        gap: 5px;
    }
    .service-item .price {
        text-align: left;
    }
    .connect-services {
        padding: 20px;
    }
}
css/update_incident.css
/* css/update_incident.css */

.content-wrapper {
    margin-top: 60px;
    padding: 0 20px;
}

.form-card {
    max-width: 600px;
    margin: 30px auto;
    padding: 20px;
    background: rgba(30, 25, 45, 0.8);
    border-radius: 12px;
    border: 1px solid rgba(100, 60, 180, 0.3);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.form-card h2 {
    color: #c7b8ff;
    text-align: center;
    margin-top: 0;
    margin-bottom: 10px;
}

.form-card h3 {
    color: #c7b8ff;
    margin: 0 0 10px;
    font-size: 1.3rem;
}

.form-card p {
    color: #d0d0d0;
    line-height: 1.5;
    margin: 5px 0;
}

.form-card label {
    display: block;
    color: #c7b8ff;
    margin: 10px 0 5px;
    font-size: 0.9rem;
}

.form-card select {
    width: 100%;
    padding: 8px;
    margin: 5px 0;
    background: #1e192d;
    color: white;
    border: 1px solid #5a1a8f;
    border-radius: 6px;
    font-size: 14px;
}

.save-btn {
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    text-decoration: none;
    display: inline-block;
}

.save-btn:hover {
    opacity: 0.9;
}

.cancel-btn {
    color: #ff6b6b;
    text-decoration: none;
    font-size: 14px;
    font-weight: bold;
    padding: 8px 16px;
    border-radius: 6px;
    display: inline-block;
}

.cancel-btn:hover {
    text-decoration: underline;
}
css/userbar.css
/* css/userbar.css */
.user-panel {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: rgba(20, 15, 35, 0.95);
    padding: 10px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 1000;
    border-bottom: 1px solid rgba(100, 60, 180, 0.3);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
}
.user-panel img {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    object-fit: cover;
    border: 1px solid #5a1a8f;
}
.user-panel .user-info {
    font-size: 14px;
    color: #e0e0e0;
}
.user-panel .user-info strong {
    color: #c7b8ff;
}
.user-panel .user-menu {
    margin-left: auto;
    display: flex;
    gap: 15px;
}
.user-panel .user-menu a {
    color: #e0e0e0;
    text-decoration: none;
    font-size: 14px;
    transition: color 0.2s ease;
}
.user-panel .user-menu a:hover {
    color: #6ab7ff;
}
.user-panel .user-menu a.logout {
    color: #ff6b6b;
}
.user-panel .user-menu a.logout:hover {
    color: #ff3b3b;
}

/* –û—Ç—Å—Ç—É–ø –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ–¥ –ø–∞–Ω–µ–ª—å—é */
.content-wrapper {
    margin-top: 60px;
    padding: 0 20px;
}
css/verify_email.css
/* css/verify_email.css */
.verification-box {
    max-width: 400px;
    margin: 30px auto;
    padding: 20px;
    background: rgba(30, 25, 45, 0.95);
    border-radius: 12px;
    border: 1px solid #5a1a8f;
    box-shadow: 0 4px 12px rgba(100, 30, 200, 0.3);
}
.verification-box h2 {
    color: #c7b8ff;
    text-align: center;
    margin-top: 0;
    margin-bottom: 15px;
}
.verification-box p {
    color: #d0d0d0;
    margin: 10px 0 20px;
    text-align: center;
    font-size: 0.95rem;
}
.verification-box input[type="text"] {
    width: 100%;
    padding: 12px;
    margin: 10px 0 20px;
    background: #1e192d;
    border: 1px solid #5a1a8f;
    color: white;
    border-radius: 6px;
    font-size: 16px;
    text-align: center;
    box-sizing: border-box;
}
.verification-box button {
    width: 100%;
    padding: 12px;
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    transition: background 0.3s ease;
}
.verification-box button:hover {
    background: linear-gradient(to right, #5a1a8f, #3a0d6a);
}
.error-message {
    text-align: center;
    padding: 10px;
    background: rgba(200, 50, 50, 0.3);
    color: #ffaaaa;
    margin: 10px 0;
    border-radius: 6px;
    border: 1px solid #8a3a3a;
}
css/view_billing_summary.css
/* css/view_billing_summary.css */
.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 20px 0 30px;
}
.summary-card {
    background: rgba(40, 30, 60, 0.8);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
.summary-value {
    font-size: 1.8rem;
    font-weight: bold;
    color: #6ab7ff;
    margin: 10px 0;
}
.summary-label {
    color: #a090cc;
    font-size: 0.95rem;
}
.section-title {
    color: #c7b8ff;
    margin: 30px 0 15px;
    font-size: 1.4rem;
    text-align: center;
}
.table-container {
    max-width: 1000px;
    margin: 0 auto;
    background: rgba(30, 25, 45, 0.8);
    border-radius: 12px;
    padding: 20px;
    border: 1px solid rgba(100, 60, 180, 0.3);
    box-shadow: 0 6px 16px rgba(0,0,0,0.3);
}
table {
    width: 100%;
    border-collapse: collapse;
    color: #d0d0d0;
    font-size: 0.95rem;
}
th {
    background: rgba(30, 25, 45, 0.95);
    color: #c7b8ff;
    padding: 10px;
    text-align: left;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.85rem;
}
td {
    padding: 10px;
    border-bottom: 1px solid rgba(100, 80, 130, 0.2);
}
tr:last-child td {
    border-bottom: none;
}
tr:nth-child(even) {
    background: rgba(40, 35, 55, 0.5);
}
css/view_db.css
/* css/view_db.css */

/* –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–Ω –∏ —à—Ä–∏—Ñ—Ç */
body {
    background: linear-gradient(135deg, #0a0418, #160b2e);
    color: #e0e0e0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    line-height: 1.6;
}

.sidebar {
    width: 250px;
    background: rgba(20, 15, 35, 0.95);
    padding: 20px;
    border-right: 1px solid rgba(100, 60, 180, 0.2);
    overflow-y: auto;
    box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
}

.sidebar h3 {
    color: #c7b8ff;
    margin-top: 0;
    margin-bottom: 15px;
    text-align: center;
    font-weight: 500;
    letter-spacing: 1px;
}

.sidebar ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.sidebar li {
    margin: 5px 0;
}

.sidebar a {
    display: block;
    padding: 10px 15px;
    color: #e0e0e0;
    text-decoration: none;
    border-radius: 6px;
    transition: all 0.2s ease;
    font-size: 14px;
}

.sidebar a:hover {
    background: rgba(100, 80, 150, 0.3);
    color: white;
}

.sidebar a.active {
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: white;
    font-weight: bold;
    box-shadow: 0 0 8px rgba(100, 30, 200, 0.5);
}

.content {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    background: rgba(30, 25, 45, 0.9);
}

h1, h2 {
    text-align: center;
    color: #c7b8ff;
    text-shadow: 0 0 8px rgba(150, 100, 255, 0.3);
    margin: 25px 0 15px;
    font-weight: 500;
    letter-spacing: 1px;
}

.alert {
    text-align: center;
    padding: 12px;
    background: rgba(40, 100, 40, 0.3);
    color: #aaffaa;
    margin: 15px auto;
    max-width: 600px;
    border-radius: 8px;
    border: 1px solid #3a8a3a;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –æ–±—ë—Ä—Ç–∫–∞ –¥–ª—è —Ç–∞–±–ª–∏—Ü */
.table-container {
    width: 100%;
    overflow-x: auto;
    margin: 15px auto;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(50, 20, 100, 0.3);
    border: 1px solid rgba(100, 60, 180, 0.2);
    background: rgba(30, 25, 45, 0.9);
    backdrop-filter: blur(6px);
    padding: 10px;
}

table {
    width: 100%;
    border-collapse: collapse;
    min-width: 600px;
    font-size: 14px;
}

th {
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: #f0e6ff;
    padding: 10px 12px;
    font-weight: 600;
    text-align: left;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    font-size: 13px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    white-space: nowrap;
}

td {
    padding: 10px 12px;
    color: #ffffff;
    border-bottom: 1px solid rgba(100, 80, 130, 0.2);
    font-size: 13px;
    line-height: 1.4;
    word-wrap: break-word;
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
}

tr:last-child td {
    border-bottom: none;
}

tr:nth-child(even) {
    background: rgba(40, 35, 55, 0.7);
}

tr:hover {
    background: rgba(100, 80, 150, 0.2) !important;
    transition: background 0.3s ease;
}

.actions {
    text-align: center;
    white-space: nowrap;
    padding: 6px !important;
}

.btn-edit, .btn-delete {
    text-decoration: none;
    padding: 4px 8px;
    border-radius: 4px;
    margin: 0 2px;
    display: inline-block;
    font-weight: bold;
    font-size: 12px;
}

.btn-edit {
    color: #6ab7ff;
    background: rgba(106, 183, 255, 0.1);
}

.btn-delete {
    color: #ff6b6b;
    background: rgba(255, 107, 107, 0.1);
}

.btn-edit:hover, .btn-delete:hover {
    opacity: 0.9;
}

/* –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
@media (max-width: 768px) {
    .container {
        flex-direction: column;
    }

    .sidebar {
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 1px solid rgba(100, 60, 180, 0.2);
    }

    .content {
        padding: 10px;
    }

    .table-container {
        margin: 10px auto;
        padding: 5px;
    }

    th, td {
        padding: 8px 6px;
        font-size: 12px;
    }

    .btn-edit, .btn-delete {
        padding: 3px 6px;
        font-size: 11px;
    }
}

@media (max-width: 480px) {
    .modal-content {
        margin: 20% auto;
        max-width: 95%;
    }

    th, td {
        padding: 6px 4px;
        font-size: 11px;
    }

    .btn-edit, .btn-delete {
        padding: 2px 4px;
        font-size: 10px;
    }
}
/* === –í–µ—Ä—Ö–Ω–µ–µ –º–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è === */
.topbar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: rgba(20, 15, 35, 0.95);
    padding: 10px 20px;
    display: flex;
    justify-content: flex-start;
    align-items: center;
    z-index: 2000;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
    border-bottom: 1px solid rgba(100, 60, 180, 0.2);
}

.user-dropdown {
    display: flex;
    align-items: center;
    cursor: pointer;
    padding: 6px 12px;
    border-radius: 6px;
    color: #e0e0e0;
    font-size: 14px;
}

.user-dropdown:hover {
    background: rgba(100, 80, 150, 0.3);
}

.dropdown-content {
    display: none;
    position: absolute;
    top: 50px;
    left: 20px;
    background: rgba(30, 25, 45, 0.95);
    min-width: 200px;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
    border-radius: 8px;
    z-index: 2001;
    border: 1px solid rgba(100, 60, 180, 0.3);
}

.dropdown-content a {
    display: block;
    padding: 10px 16px;
    color: #e0e0e0;
    text-decoration: none;
    font-size: 14px;
}

.dropdown-content a:hover {
    background: rgba(100, 80, 150, 0.3);
}

.dropdown-content hr {
    margin: 4px 0;
    border-color: rgba(100, 60, 180, 0.2);
}

/* –°–¥–≤–∏–≥ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤–Ω–∏–∑ */
.container {
    display: flex;
    height: 100vh;
    max-width: 100%;
    overflow: hidden;
    margin-top: 60px; /* –≤—ã—Å–æ—Ç–∞ topbar + –æ—Ç—Å—Ç—É–ø */
}
/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥–º–µ–Ω—é —Ç–∞–±–ª–∏—Ü */
.tables-list {
    display: none;
    margin-top: 8px;
}
.tables-list a {
    display: block;
    padding: 8px 15px;
    color: #e0e0e0;
    text-decoration: none;
    border-radius: 6px;
    transition: all 0.2s ease;
    font-size: 14px;
}
.tables-list a:hover {
    background: rgba(100, 80, 150, 0.3);
    color: white;
}
.tables-list a.active {
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: white;
    font-weight: bold;
}
.topbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 12px 20px;
            background: rgba(20, 15, 35, 0.95);
            border-bottom: 1px solid rgba(100, 60, 180, 0.3);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .topbar img {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            object-fit: cover;
            border: 1px solid #5a1a8f;
        }
        .user-info {
            font-size: 14px;
            color: #e0e0e0;
        }
        .user-info strong {
            color: #c7b8ff;
        }
        .user-info .role {
            font-size: 12px;
            color: #8ab7ff;
        }
        .content-wrapper {
            margin-top: 60px;
            padding: 0 20px;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é */
        .dropdown-content {
            display: none;
            position: absolute;
            top: 50px;
            left: 20px;
            background: rgba(30, 25, 45, 0.95);
            min-width: 200px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
            border-radius: 8px;
            z-index: 2000;
            padding: 10px;
            border: 1px solid rgba(100, 60, 180, 0.3);
        }
        .dropdown-content a {
            display: block;
            padding: 8px 16px;
            color: #e0e0e0;
            text-decoration: none;
            font-size: 14px;
        }
        .dropdown-content a:hover {
            background: rgba(100, 80, 150, 0.3);
            color: white;
        }
        .dropdown-content hr {
            border: 0;
            border-top: 1px solid rgba(100, 60, 180, 0.2);
            margin: 6px 0;
        }
css/view_incidents.css
/* css/view_incidents.css */

.content-wrapper {
    margin-top: 60px;
    padding: 0 20px;
}

.table-container {
    max-width: 1000px;
    margin: 30px auto;
    padding: 0 20px;
    background: rgba(30, 25, 45, 0.8);
    border-radius: 12px;
    border: 1px solid rgba(100, 60, 180, 0.3);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
}

table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
    color: #d0d0d0;
}

th {
    background: rgba(30, 25, 45, 0.95);
    color: #c7b8ff;
    padding: 10px 12px;
    font-weight: 600;
    text-align: left;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    font-size: 13px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    white-space: nowrap;
}

td {
    padding: 10px 12px;
    color: #ffffff;
    border-bottom: 1px solid rgba(100, 80, 130, 0.2);
    font-size: 13px;
    line-height: 1.4;
    word-wrap: break-word;
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
}

tr:last-child td {
    border-bottom: none;
}

tr:nth-child(even) {
    background: rgba(40, 35, 55, 0.7);
}

tr:hover {
    background: rgba(100, 80, 150, 0.2) !important;
    transition: background 0.3s ease;
}

.actions {
    text-align: center;
    white-space: nowrap;
    padding: 6px !important;
}

.btn-edit {
    color: #6ab7ff;
    background: rgba(106, 183, 255, 0.1);
    padding: 4px 8px;
    border-radius: 4px;
    font-weight: bold;
    font-size: 12px;
}

.btn-edit:hover {
    opacity: 0.9;
}
css/view_logs.css
/* css/view_logs.css */

body {
    background: linear-gradient(135deg, #0a0418, #160b2e);
    color: #e0e0e0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    min-height: 100vh;
}

.topbar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: rgba(20, 15, 35, 0.95);
    padding: 10px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 1000;
    border-bottom: 1px solid rgba(100, 60, 180, 0.3);
}

.topbar img {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    object-fit: cover;
    border: 1px solid #5a1a8f;
}

.user-info {
    font-size: 14px;
    color: #e0e0e0;
}

.user-info strong {
    color: #c7b8ff;
}

.user-info .role {
    font-size: 12px;
    color: #8ab7ff;
}

.user-menu {
    margin-left: auto;
    display: flex;
    gap: 15px;
}

.user-menu a {
    color: #e0e0e0;
    text-decoration: none;
    font-size: 14px;
}

.user-menu a:hover {
    color: #6ab7ff;
}

.user-menu a.logout {
    color: #ff6b6b;
}

.user-menu a.logout:hover {
    color: #ff3b3b;
}

.content-wrapper {
    margin-top: 60px;
    padding: 0 20px;
}

.logs-container {
    max-width: 1000px;
    margin: 30px auto;
    padding: 20px;
    background: rgba(30, 25, 45, 0.8);
    border-radius: 12px;
    border: 1px solid rgba(100, 60, 180, 0.3);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
}

.log-item {
    background: rgba(40, 30, 60, 0.9);
    border: 1px solid rgba(100, 60, 180, 0.3);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.log-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
}

.log-type {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: bold;
    text-align: center;
}

.log-type.info {
    background: rgba(40, 200, 80, 0.3);
    color: #aaffaa;
}

.log-type.warning {
    background: rgba(255, 165, 0, 0.3);
    color: #ffcc66;
}

.log-type.error {
    background: rgba(200, 50, 50, 0.3);
    color: #ffaaaa;
}

.log-type.critical {
    background: rgba(255, 107, 107, 0.3);
    color: #ff6b6b;
}

.log-message {
    color: #d0d0d0;
    line-height: 1.5;
    white-space: pre-wrap;
    margin: 10px 0;
}

.log-meta {
    font-size: 0.9rem;
    color: #a090cc;
    margin-top: 5px;
    display: flex;
    gap: 10px;
}

.log-meta span {
    white-space: nowrap;
}

.empty-logs {
    text-align: center;
    color: #aaa;
    font-size: 1.2rem;
    margin: 60px 0;
}

.footer {
    text-align: center;
    padding: 20px;
    color: #6a5a8f;
    font-size: 0.9rem;
    margin-top: 40px;
    border-top: 1px solid rgba(100, 60, 180, 0.2);
}
css/view_network.css
/* css/view_network.css */

/* –ö–æ–ø–∏—Ä—É–µ–º –∏–∑ view_servers.css ‚Äî –ø–æ—á—Ç–∏ –∏–¥–µ–Ω—Ç–∏—á–µ–Ω */
.content-wrapper {
    margin-top: 60px;
    padding: 0 20px;
}

.table-container {
    max-width: 1000px;
    margin: 30px auto;
    padding: 0 20px;
    background: rgba(30, 25, 45, 0.8);
    border-radius: 12px;
    border: 1px solid rgba(100, 60, 180, 0.3);
    box-shadow: 0 6px 16px rgba(50, 20, 100, 0.3);
}

table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}

th {
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: #f0e6ff;
    padding: 10px 12px;
    font-weight: 600;
    text-align: left;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    font-size: 13px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    white-space: nowrap;
}

td {
    padding: 10px 12px;
    color: #ffffff;
    border-bottom: 1px solid rgba(100, 80, 130, 0.2);
    font-size: 13px;
    line-height: 1.4;
    word-wrap: break-word;
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
}

tr:last-child td {
    border-bottom: none;
}

tr:nth-child(even) {
    background: rgba(40, 35, 55, 0.7);
}

tr:hover {
    background: rgba(100, 80, 150, 0.2) !important;
    transition: background 0.3s ease;
}

.actions {
    text-align: center;
    white-space: nowrap;
    padding: 6px !important;
}

.btn-edit {
    color: #6ab7ff;
    background: rgba(106, 183, 255, 0.1);
    padding: 4px 8px;
    border-radius: 4px;
    margin: 0 2px;
    display: inline-block;
    font-weight: bold;
    font-size: 12px;
}

.btn-edit:hover {
    opacity: 0.9;
}

.status-online {
    background: rgba(40, 200, 80, 0.3);
    color: #aaffaa;
}

.status-offline {
    background: rgba(200, 50, 50, 0.3);
    color: #ffaaaa;
}

.status-maintenance {
    background: rgba(255, 165, 0, 0.3);
    color: #ffcc66;
}
css/view_servers.css
/* css/view_servers.css */

.content-wrapper {
    margin-top: 60px;
    padding: 0 20px;
}

.table-container {
    max-width: 1000px;
    margin: 30px auto;
    padding: 0 20px;
    background: rgba(30, 25, 45, 0.8);
    border-radius: 12px;
    border: 1px solid rgba(100, 60, 180, 0.3);
    box-shadow: 0 6px 16px rgba(50, 20, 100, 0.3);
}

table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}

th {
    background: linear-gradient(to right, #3a0d6a, #5a1a8f);
    color: #f0e6ff;
    padding: 10px 12px;
    font-weight: 600;
    text-align: left;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    font-size: 13px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    white-space: nowrap;
}

td {
    padding: 10px 12px;
    color: #ffffff;
    border-bottom: 1px solid rgba(100, 80, 130, 0.2);
    font-size: 13px;
    line-height: 1.4;
    word-wrap: break-word;
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
}

tr:last-child td {
    border-bottom: none;
}

tr:nth-child(even) {
    background: rgba(40, 35, 55, 0.7);
}

tr:hover {
    background: rgba(100, 80, 150, 0.2) !important;
    transition: background 0.3s ease;
}

.actions {
    text-align: center;
    white-space: nowrap;
    padding: 6px !important;
}

.btn-edit {
    color: #6ab7ff;
    background: rgba(106, 183, 255, 0.1);
    padding: 4px 8px;
    border-radius: 4px;
    margin: 0 2px;
    display: inline-block;
    font-weight: bold;
    font-size: 12px;
}

.btn-edit:hover {
    opacity: 0.9;
}

.status-online {
    background: rgba(40, 200, 80, 0.3);
    color: #aaffaa;
}

.status-offline {
    background: rgba(200, 50, 50, 0.3);
    color: #ffaaaa;
}

.status-maintenance {
    background: rgba(255, 165, 0, 0.3);
    color: #ffcc66;
}

imang 
imang/Capcha
imang/Capcha/–°–ª–æ–∏_hq.jpg
imang/Capcha/df4afab504d97849e195e13c26cc2421e1a560d0r1-1280-720v2_hq.jpg
imang/Capcha/fragment1.jpg
imang/Capcha/fragment2.jpg
imang/Capcha/fragment3.jpg
imang/Capcha/fragment4.jpg
imang/default.png
imang/user_29_1761502186.jpg
pages

pages/billing.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

if ($_SESSION['role'] !== 'user') {
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –ø–æ–∫—É–ø–∫–∏ (–∫–∞–∫ —Å—á–µ—Ç–∞)
    $stmt = $pdo->prepare("
        SELECT p.id, p.item_type, p.service_id, p.package_id, p.price, p.purchased_at,
               s.name AS service_name,
               t.name AS package_name
        FROM purchases p
        LEFT JOIN services s ON p.service_id = s.id
        LEFT JOIN tariff_plans t ON p.package_id = t.id
        WHERE p.user_id = ?
        ORDER BY p.purchased_at DESC
    ");
    $stmt->execute([$_SESSION['user_id']]);
    $purchases = $stmt->fetchAll(PDO::FETCH_ASSOC);

} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ë–î.");
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ë–∏–ª–ª–∏–Ω–≥</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/billing.css">
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-panel">
        <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
        <div class="user-info">
            <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å') ?></strong>
        </div>
        <div class="user-menu">
            <a href="user_dashboard.php">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="cart.php">–ö–æ—Ä–∑–∏–Ω–∞</a>
            <a href="purchased.php">–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏</a>
            <a href="history.php">–ò—Å—Ç–æ—Ä–∏—è</a>
            <a href="support.php">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
            <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="notifications.php">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
            <a href="referral.php">–†–µ—Ñ–µ—Ä–∞–ª—ã</a>
            <a href="../logout.php">–í—ã—Ö–æ–¥</a>
        </div>
    </div>

    <div class="content-wrapper">
        <h1 style="text-align: center; color: #c7b8ff;">–ë–∏–ª–ª–∏–Ω–≥</h1>
        <p style="text-align: center; color: #a090cc; margin-bottom: 30px;">–í—Å–µ –≤–∞—à–∏ –ø–ª–∞—Ç–µ–∂–∏ –∑–∞ —É—Å–ª—É–≥–∏ –∏ –ø–∞–∫–µ—Ç—ã.</p>

        <div class="billing-container">
            <?php if (empty($purchases)): ?>
                <div style="text-align: center; color: #aaa; font-size: 1.2rem; margin: 60px 0;">
                    –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–ª–∞—Ç–µ–∂–µ–π.
                </div>
            <?php else: ?>
                <?php foreach ($purchases as $purchase): ?>
                    <div class="invoice-item">
                        <div class="invoice-header">
                            <h3 class="invoice-title">
                                <?= htmlspecialchars($purchase['item_type'] === 'service' ? $purchase['service_name'] : $purchase['package_name']) ?>
                            </h3>
                            <span class="invoice-id">ID: <?= htmlspecialchars($purchase['id']) ?></span>
                        </div>
                        <div class="invoice-details">
                            <span class="invoice-total">–°—É–º–º–∞: <?= number_format($purchase['price'], 0, '', ' ') ?> ‚ÇΩ</span>
                            <span class="invoice-date">–î–∞—Ç–∞: <?= htmlspecialchars(date('d.m.Y H:i', strtotime($purchase['purchased_at']))) ?></span>
                        </div>
                    </div>
                <?php endforeach; ?>
            <?php endif; ?>
        </div>
    </div>
</body>
</html>
pages/cart.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

if ($_SESSION['role'] !== 'user') {
    header("Location: ../index.php");
    exit;
}

// –ü–æ–¥–∫–ª—é—á–∞–µ–º PHPMailer ‚Äî –î–û –ª—é–±–æ–π –ª–æ–≥–∏–∫–∏
use PHPMailer\PHPMailer\PHPMailer;
use PHPMailer\PHPMailer\SMTP;
use PHPMailer\PHPMailer\Exception;
require_once __DIR__ . '/../vendor/autoload.php';

require_once '../config.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ—Ä–∑–∏–Ω—ã —Å –¥–∞–Ω–Ω—ã–º–∏
    $stmt = $pdo->prepare("
        SELECT c.id AS cart_id, c.type, c.service_id, c.package_id,
               s.name AS service_name, s.price AS service_price,
               p.name AS package_name, p.price AS package_price
        FROM cart c
        LEFT JOIN services s ON c.service_id = s.id AND c.type = 'service'
        LEFT JOIN tariff_plans p ON c.package_id = p.id AND c.type = 'package'
        WHERE c.user_id = ?
        ORDER BY c.added_at DESC
    ");
    $stmt->execute([$_SESSION['user_id']]);
    $items = $stmt->fetchAll(PDO::FETCH_ASSOC);

    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (email)
    $stmt_user = $pdo->prepare("SELECT email FROM users WHERE id = ?");
    $stmt_user->execute([$_SESSION['user_id']]);
    $user = $stmt_user->fetch(PDO::FETCH_ASSOC);

} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ë–î.");
}

// –õ–æ–≥–∏–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['action']) && $_POST['action'] === 'checkout') {
    $email = trim($_POST['email'] ?? '');
    if (empty($email) || !filter_var($email, FILTER_VALIDATE_EMAIL)) {
        $_SESSION['message'] = "‚ùå –£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email.";
        header("Location: cart.php");
        exit;
    }

    $_SESSION['pending_email'] = $email;

    try {
        $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
        $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

        $stmt = $pdo->prepare("SELECT last_verification_code_sent_at FROM users WHERE id = ?");
        $stmt->execute([$_SESSION['user_id']]);
        $last_sent = $stmt->fetchColumn();

        if ($last_sent) {
            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–ª email ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —ç—Ç–∞–ø
            $_SESSION['verification_code'] = 'ALREADY_VERIFIED';
            header("Location: verify_email.php");
            exit;
        }

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–¥
        $verification_code = substr(str_shuffle('0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'), 0, 10);
        $_SESSION['verification_code'] = $verification_code;

        $mail = new PHPMailer(true);
        try {
            $mail->isSMTP();
            $mail->Host       = 'smtp.mail.ru';
            $mail->SMTPAuth   = true;
            $mail->Username   = 'it-servis-05@mail.ru';
            $mail->Password   = 'w03ZqhoC4P0F83CCpO94';
            $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
            $mail->Port       = 587;
            $mail->CharSet    = 'UTF-8';

            $mail->setFrom('it-servis-05@mail.ru', '–ò–¢-–°–µ—Ä–≤–∏—Å');
            $mail->addAddress($email);

            $mail->isHTML(true);
            $mail->Subject = '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email ‚Äî –ò–¢-–°–µ—Ä–≤–∏—Å';
            $mail->Body    = "
                <html>
                <head>
                    <meta charset='UTF-8'>
                    <style>
                        body { font-family: Arial, sans-serif; background-color: #f4f4f4; margin: 0; padding: 0; }
                        .container { max-width: 600px; margin: 20px auto; background: white; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); overflow: hidden; }
                        .header { background: #f8f8f8; padding: 20px; text-align: center; }
                        .content { padding: 30px; }
                        .code-box { background: #f0f0f0; border-radius: 8px; padding: 20px; text-align: center; font-size: 24px; font-weight: bold; color: #333; }
                        .footer { background: #f8f8f8; padding: 15px; text-align: center; font-size: 12px; color: #666; }
                    </style>
                </head>
                <body>
                    <div class='container'>
                        <div class='header'>
                            <h2>–ò–¢-–°–µ—Ä–≤–∏—Å</h2>
                        </div>
                        <div class='content'>
                            <h2>–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</h2>
                            <div class='code-box'>{$verification_code}</div>
                            <p>–î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—Ö–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–¥ –Ω–∏–∂–µ.</p>
                            <p><strong>–ù–∏–∫–æ–º—É –Ω–µ —Å–æ–æ–±—â–∞–π—Ç–µ –µ–≥–æ! –ö–æ–¥ –¥–µ–π—Å—Ç–≤—É–µ—Ç 10 –º–∏–Ω—É—Ç.</strong></p>
                        </div>
                        <div class='footer'>
                            &copy; " . date('Y') . " –ò–¢-–°–µ—Ä–≤–∏—Å. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
                        </div>
                    </div>
                </body>
                </html>
            ";

            $mail->send();
            $stmt_update = $pdo->prepare("UPDATE users SET last_verification_code_sent_at = NOW() WHERE id = ?");
            $stmt_update->execute([$_SESSION['user_id']]);

            header("Location: verify_email.php");
            exit;

        } catch (Exception $e) {
            error_log("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: " . $mail->ErrorInfo);
            $_SESSION['message'] = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ.";
            header("Location: cart.php");
            exit;
        }

    } catch (PDOException $e) {
        $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏.";
        header("Location: cart.php");
        exit;
    }
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ú–æ—è –∫–æ—Ä–∑–∏–Ω–∞</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/cart.css">
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-panel">
        <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
        <div class="user-info">
            <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å') ?></strong>
        </div>
        <div class="user-menu">
            <a href="user_dashboard.php">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="purchased.php">–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏</a>
            <a href="history.php">–ò—Å—Ç–æ—Ä–∏—è</a>
            <a href="support.php">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
            <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="billing.php">–ë–∏–ª–ª–∏–Ω–≥</a>
            <a href="notifications.php">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
            <a href="referral.php">–†–µ—Ñ–µ—Ä–∞–ª—ã</a>
            <a href="../logout.php">–í—ã—Ö–æ–¥</a>
        </div>
    </div>

    <div class="content-wrapper">
        <h1 style="text-align: center; color: #c7b8ff;">–ú–æ—è –∫–æ—Ä–∑–∏–Ω–∞</h1>

        <?php if (empty($items)): ?>
            <div class="empty-cart">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
        <?php else: ?>
            <?php $total = 0; ?>
            <?php foreach ($items as $item): ?>
                <div class="cart-item">
                    <div>
                        <?php if ($item['type'] === 'service'): ?>
                            <h3><?= htmlspecialchars($item['service_name']) ?></h3>
                            <div class="price"><?= number_format($item['service_price'], 0, '', ' ') ?> ‚ÇΩ</div>
                        <?php else: ?>
                            <h3>üì¶ –ü–∞–∫–µ—Ç: <?= htmlspecialchars($item['package_name']) ?></h3>
                            <div class="price"><?= number_format($item['package_price'], 0, '', ' ') ?> ‚ÇΩ</div>
                        <?php endif; ?>
                    </div>
                    <a href="../actions/remove_from_cart.php?action=single&id=<?= (int)$item['cart_id'] ?>" 
                       class="remove-btn" 
                       title="–£–¥–∞–ª–∏—Ç—å"
                       onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã?')">√ó</a>
                </div>
                <?php $total += ($item['type'] === 'service') ? $item['service_price'] : $item['package_price']; ?>
            <?php endforeach; ?>

            <div class="total">–ò—Ç–æ–≥–æ: <?= number_format($total, 0, '', ' ') ?> ‚ÇΩ</div>

            <a href="../actions/remove_from_cart.php?action=all" 
               class="clear-cart"
               onclick="return confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∫–æ—Ä–∑–∏–Ω—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')">
                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
            </a>

            <form method="POST" class="checkout-form">
                <input type="hidden" name="action" value="checkout">
                <label for="email">Email –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:</label>
                <input type="email" id="email" name="email" 
                       value="<?= !empty($user['email']) && $user['email'] !== 'no-email@example.com' ? htmlspecialchars($user['email']) : '' ?>"
                       placeholder="your@email.com"
                       required>
                <button type="submit">–ü—Ä–∏–æ–±—Ä–µ—Å—Ç–∏</button>
            </form>
        <?php endif; ?>

        <div style="text-align: center; margin-top: 30px;">
            <a href="services.php" class="btn" style="background: linear-gradient(to right, #3a0d6a, #5a1a8f); color: white;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏</a>
        </div>
    </div>
</body>
</html>
pages/data_editor.php
<?php
session_start(); // ‚Üê –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –î–û requireAuth()
require_once '../auth.php';
requireAuth();
require_once '../log_action.php';

// === –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ===
$host = 'localhost';
$dbname = 'local';
$username = 'root';
$password = '';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: " . htmlspecialchars($e->getMessage()));
}

// === –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ===
$id = (int)($_GET['id'] ?? 0);
$table = $_GET['table'] ?? '';

// === –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã ===
if (!in_array($table, ['users', 'servers', 'network_devices', 'changes', 'incidents', 'backups', 'logs'])) {
    die("–ù–µ–¥–æ–ø—É—Å—Ç–∏–º–∞—è —Ç–∞–±–ª–∏—Ü–∞.");
}

// === –ü–æ–ª—É—á–∞–µ–º –∑–∞–ø–∏—Å—å ===
$stmt = $pdo->prepare("SELECT * FROM `$table` WHERE id = ?");
$stmt->execute([$id]);
$record = $stmt->fetch(PDO::FETCH_ASSOC);

if (!$record) {
    die("–ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.");
}

// === –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª–µ–π ===
$columns = array_keys($record);

// === –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã ===
if ($_POST && isset($_POST['action']) && $_POST['action'] === 'update') {
    $set = [];
    $values = [];
    foreach ($columns as $col) {
        if ($col !== 'id') {
            $set[] = "`$col` = ?";
            $values[] = $_POST[$col] ?? '';
        }
    }
    $values[] = $id;

    $sql = "UPDATE `$table` SET " . implode(', ', $set) . " WHERE id = ?";
    $stmt = $pdo->prepare($sql);
    if ($stmt->execute($values)) {
        $_SESSION['message'] = "‚úÖ –ó–∞–ø–∏—Å—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞.";
        logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'EDIT_RECORD', "–¢–∞–±–ª–∏—Ü–∞: $table, ID: $id");
    } else {
        $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.";
    }
    header("Location: ../pages/view_db.php");
    exit;
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å ‚Äî <?= htmlspecialchars($table) ?></title>
    <link rel="stylesheet" href="../css/view_db.css">
</head>
<body>

<?php if (!empty($_SESSION['message'])): ?>
    <div style="text-align: center; padding: 10px; background: rgba(40, 100, 40, 0.3); color: #aaffaa; margin: 10px auto; max-width: 600px; border-radius: 6px;">
        <?= htmlspecialchars($_SESSION['message']) ?>
    </div>
    <?php unset($_SESSION['message']); ?>
<?php endif; ?>

<div style="max-width: 800px; margin: 30px auto; background: rgba(30,25,45,0.95); padding: 20px; border-radius: 12px; border: 1px solid #5a1a8f;">
    <h2 style="text-align: center; color: #c7b8ff;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ: <?= htmlspecialchars($table) ?></h2>
    <form method="POST">
        <input type="hidden" name="action" value="update">
        <input type="hidden" name="id" value="<?= $id ?>">

        <?php foreach ($columns as $col): ?>
            <?php if ($col === 'id') continue; ?>
            <div style="margin: 12px 0;">
                <label style="display: block; color: #c7b8ff; margin-bottom: 4px;"><?= htmlspecialchars($col) ?>:</label>
                <input type="text" name="<?= $col ?>" value="<?= htmlspecialchars($record[$col]) ?>" 
                       style="width: 100%; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px;">
            </div>
        <?php endforeach; ?>

        <div style="text-align: center; margin-top: 20px;">
            <button type="submit" style="background: linear-gradient(to right, #3a0d6a, #5a1a8f); color: white; padding: 10px 24px; border: none; border-radius: 6px; cursor: pointer;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <a href="../pages/view_db.php" style="color: #ff6b6b; text-decoration: none; margin-left: 15px;">‚ùå –û—Ç–º–µ–Ω–∞</a>
        </div>
    </form>
</div>

</body>
</html>
pages/db_admin_add.php
<?php
session_start();
require_once '../auth.php';
requireAuth();
require_once '../log_action.php';

// –¢–æ–ª—å–∫–æ –¥–ª—è db_admin
if ($_SESSION['role'] !== 'db_admin') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';
try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: " . htmlspecialchars($e->getMessage()));
}

$table = $_GET['table'] ?? '';
if (empty($table)) {
    die("–ù–µ —É–∫–∞–∑–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞.");
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
$stmt = $pdo->prepare("SHOW TABLES LIKE ?");
$stmt->execute([$table]);
if (!$stmt->fetch()) {
    die("–¢–∞–±–ª–∏—Ü–∞ '$table' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.");
}

// === –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã ===
if ($_POST && isset($_POST['action']) && $_POST['action'] === 'insert') {
    $columns_info = $pdo->query("DESCRIBE `$table`")->fetchAll(PDO::FETCH_ASSOC);
    $columns = [];
    $values = [];
    $placeholders = [];
    $password_fields = ['password', 'pass', 'passwd', 'user_password', 'pwd', 'PASSWORD_HASH', 'password_hash'];

    foreach ($columns_info as $col) {
        $field = $col['Field'];
        if ($field === 'id' && strpos($col['Extra'], 'auto_increment') !== false) {
            continue;
        }
        $columns[] = "`$field`";
        $placeholders[] = "?";
        $value = $_POST[$field] ?? '';
        if (in_array($field, $password_fields) && $value !== '') {
            $value = password_hash($value, PASSWORD_DEFAULT);
        }
        $values[] = $value;
    }

    if (!empty($columns)) {
        $sql = "INSERT INTO `$table` (" . implode(', ', $columns) . ") VALUES (" . implode(', ', $placeholders) . ")";
        $stmt = $pdo->prepare($sql);
        if ($stmt->execute($values)) {
            $_SESSION['message'] = "‚úÖ –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞.";
            // –õ–æ–≥–∏—Ä—É–µ–º —Å —Ä–µ–∞–ª—å–Ω—ã–º ID
            $new_id = $pdo->lastInsertId();
            logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'ADD_RECORD', "–¢–∞–±–ª–∏—Ü–∞: $table, ID: $new_id");
        } else {
            $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏.";
        }
    } else {
        $_SESSION['message'] = "‚ùå –ù–µ—Ç –ø–æ–ª–µ–π –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏.";
    }

    header("Location: ../pages/db_admin_view.php?table=" . urlencode($table));
    exit;
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å ‚Äî <?= htmlspecialchars($table) ?></title>
    <link rel="stylesheet" href="../css/view_db.css">
</head>
<body>
    <div style="max-width: 800px; margin: 30px auto; background: rgba(30,25,45,0.95); padding: 20px; border-radius: 12px; border: 1px solid #5a1a8f;">
        <h2 style="text-align: center; color: #c7b8ff;">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É: <?= htmlspecialchars($table) ?></h2>
        <form method="POST">
            <input type="hidden" name="action" value="insert">
            <?php
            $columns_info = $pdo->query("DESCRIBE `$table`")->fetchAll(PDO::FETCH_ASSOC);
            foreach ($columns_info as $col):
                $field = $col['Field'];
                if ($field === 'id' && strpos($col['Extra'], 'auto_increment') !== false) {
                    continue;
                }
            ?>
                <div style="margin: 12px 0;">
                    <label style="display: block; color: #c7b8ff; margin-bottom: 4px;"><?= htmlspecialchars($field) ?>:</label>
                    <input type="text" name="<?= $field ?>" 
                           style="width: 100%; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px;">
                </div>
            <?php endforeach; ?>
            <div style="text-align: center; margin-top: 20px;">
                <button type="submit" style="background: linear-gradient(to right, #00c853, #64dd17); color: white; padding: 10px 24px; border: none; border-radius: 6px; cursor: pointer;">–î–æ–±–∞–≤–∏—Ç—å</button>
                <a href="../pages/db_admin_view.php?table=<?= urlencode($table) ?>" style="color: #ff6b6b; text-decoration: none; margin-left: 15px;">–û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
    </div>
</body>
</html>
pages/db_admin_backup.php
<?php
session_start();
require_once '../auth.php';
requireAuth();
require_once '../log_action.php';

// –¢–æ–ª—å–∫–æ –¥–ª—è db_admin
if ($_SESSION['role'] !== 'db_admin') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../pages/db_admin_dashboard.php");
    exit;
}

require_once '../config.php';

// –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ backups ‚Äî –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
$backup_dir = __DIR__ . '/../backups/';
if (!is_dir($backup_dir)) {
    mkdir($backup_dir, 0777, true);
}

// –ò–º—è —Ñ–∞–π–ª–∞
$filename = 'backup_' . date('Ymd_His') . '.sql';
$filepath = $backup_dir . $filename; // –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ –¥–∏—Å–∫
$relative_path = '/backups/' . $filename; // –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
    $tables = [];
    $stmt = $pdo->query("SHOW TABLES");
    while ($row = $stmt->fetch(PDO::FETCH_NUM)) {
        $tables[] = $row[0];
    }

    // –§–æ—Ä–º–∏—Ä—É–µ–º SQL-–¥–∞–º–ø
    $sql = "-- Backup of database `$dbname`\n";
    $sql .= "-- Date: " . date('Y-m-d H:i:s') . "\n";
    $sql .= "SET FOREIGN_KEY_CHECKS = 0;\n";

    foreach ($tables as $table) {
        // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã
        $create = $pdo->query("SHOW CREATE TABLE `$table`")->fetch(PDO::FETCH_NUM);
        $sql .= $create[1] . ";\n";

        // –î–∞–Ω–Ω—ã–µ
        $stmt = $pdo->query("SELECT * FROM `$table`");
        $columns = [];
        for ($i = 0; $i < $stmt->columnCount(); $i++) {
            $col = $stmt->getColumnMeta($i);
            $columns[] = "`" . $col['name'] . "`";
        }

        while ($row = $stmt->fetch(PDO::FETCH_NUM)) {
            $values = [];
            foreach ($row as $val) {
                $values[] = $val === null ? 'NULL' : "'" . addslashes($val) . "'";
            }
            $sql .= "INSERT INTO `$table` (" . implode(', ', $columns) . ") VALUES (" . implode(', ', $values) . ");\n";
        }
        $sql .= "\n";
    }

    $sql .= "SET FOREIGN_KEY_CHECKS = 1;\n";

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª –Ω–∞ –¥–∏—Å–∫
    if (file_put_contents($filepath, $sql)) {
        try {
            // –ü–æ–ª—É—á–∞–µ–º server_id
            $server_name = 'Prod-DB-01';
            $stmt = $pdo->prepare("SELECT id FROM servers WHERE name = ? LIMIT 1");
            $stmt->execute([$server_name]);
            $server = $stmt->fetch(PDO::FETCH_ASSOC);

            if (!$server) {
                $stmt = $pdo->query("SELECT id FROM servers ORDER BY id LIMIT 1");
                $server = $stmt->fetch(PDO::FETCH_ASSOC);
                if (!$server) {
                    throw new Exception("–ù–µ—Ç —Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ —Ç–∞–±–ª–∏—Ü–µ 'servers'.");
                }
            }

            $server_id = $server['id'];
            $file_size_mb = round(filesize($filepath) / (1024 * 1024), 2);

            $insert = $pdo->prepare("
                INSERT INTO backups (server_id, backup_date, file_path, size_mb, status)
                VALUES (?, NOW(), ?, ?, 'success')
            ");
            $insert->execute([$server_id, $relative_path, $file_size_mb]);

            $_SESSION['message'] = "‚úÖ –ë—ç–∫–∞–ø '$filename' —Å–æ–∑–¥–∞–Ω –∏ –∑–∞–ø–∏—Å–∞–Ω –≤ –ë–î.";
            logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'BACKUP_CREATED', "–§–∞–π–ª: $relative_path");
        } catch (Exception $inner_e) {
            $_SESSION['message'] = "‚ö†Ô∏è –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω, –Ω–æ –æ—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –ë–î: " . htmlspecialchars($inner_e->getMessage());
        }
    } else {
        $_SESSION['message'] = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª –±—ç–∫–∞–ø–∞.";
    }
} catch (Exception $e) {
    $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±—ç–∫–∞–ø–∞: " . htmlspecialchars($e->getMessage());
}

header("Location: ../pages/db_admin_dashboard.php");
exit;
?>
pages/db_admin_create_table_form.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

// –¢–æ–ª—å–∫–æ –¥–ª—è db_admin
if ($_SESSION['role'] !== 'db_admin') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É</title>
    <link rel="stylesheet" href="../css/create_table.css">
</head>
<body>
    <div class="form-box">
        <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É</h2>
        <form method="POST" action="../actions/create_table.php">
            <label for="table_name">–ò–º—è —Ç–∞–±–ª–∏—Ü—ã:</label>
            <input type="text" id="table_name" name="table_name" required>
            <label for="column_count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±—Ü–æ–≤:</label>
            <input type="number" id="column_count" name="column_count" min="1" max="50" value="5" required>
            <div id="columnsContainer">
                <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ–ª—è –¥–ª—è —Å—Ç–æ–ª–±—Ü–æ–≤ -->
            </div>
            <div style="margin-top: 20px; display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="fillDataToggle" name="fill_data" style="width: auto; height: auto;">
                <label for="fillDataToggle" style="color: #c7b8ff;">–•–æ—Ç–∏—Ç–µ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ?</label>
            </div>
            <div id="dataFields" style="display: none; margin-top: 20px;">
                <label>–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ (3 —Å—Ç—Ä–æ–∫–∏):</label>
                <div id="dataRows">
                    <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö -->
                </div>
            </div>
            <div class="buttons">
                <button type="submit">–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É</button>
                <button type="button" onclick="window.location.href='db_admin_dashboard.php'">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
    <script>
        // –°–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
        const dataTypes = [
            { value: 'INT', label: 'INT' },
            { value: 'VARCHAR', label: 'VARCHAR' },
            { value: 'TEXT', label: 'TEXT' },
            { value: 'DATE', label: 'DATE' },
            { value: 'DATETIME', label: 'DATETIME' },
            { value: 'DECIMAL', label: 'DECIMAL' },
            { value: 'BOOLEAN', label: 'BOOLEAN' },
            { value: 'JSON', label: 'JSON' }
        ];

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π –¥–ª—è —Å—Ç–æ–ª–±—Ü–æ–≤
        function generateColumnFields(count) {
            const container = document.getElementById('columnsContainer');
            container.innerHTML = '';
            for (let i = 1; i <= count; i++) {
                const field = document.createElement('div');
                field.className = 'column-field';
                field.innerHTML = `
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin: 5px 0; align-items: center;">
                        <input type="text" name="column_${i}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–∞" required style="flex: 1; min-width: 120px; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                        <select name="type_${i}" required style="width: auto; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                            ${dataTypes.map(opt => `<option value="${opt.value}">${opt.label}</option>`).join('')}
                        </select>
                        <input type="text" name="length_${i}" placeholder="–î–ª–∏–Ω–∞/–∑–Ω–∞—á–µ–Ω–∏–µ" style="width: 80px; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin: 5px 0; align-items: center;">
                        <select name="default_${i}" style="width: auto; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                            <option value="">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
                            <option value="NULL">NULL</option>
                            <option value="CURRENT_TIMESTAMP">CURRENT_TIMESTAMP</option>
                            <option value="0">0</option>
                            <option value="''">''</option>
                        </select>
                        <select name="collation_${i}" style="width: auto; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                            <option value="">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ</option>
                            <option value="utf8mb4_general_ci">utf8mb4_general_ci</option>
                            <option value="utf8mb4_unicode_ci">utf8mb4_unicode_ci</option>
                        </select>
                        <select name="attributes_${i}" style="width: auto; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                            <option value="">–ê—Ç—Ä–∏–±—É—Ç—ã</option>
                            <option value="UNSIGNED">UNSIGNED</option>
                            <option value="ZEROFILL">ZEROFILL</option>
                        </select>
                        <select name="null_${i}" style="width: auto; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                            <option value="NOT NULL">NOT NULL</option>
                            <option value="NULL">NULL</option>
                        </select>
                        <input type="text" name="comment_${i}" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" style="flex: 1; min-width: 150px; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                    </div>
                `;
                container.appendChild(field);
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
        function generateDataFields(count) {
            const container = document.getElementById('dataRows');
            container.innerHTML = '';
            for (let row = 1; row <= 3; row++) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'data-row';
                for (let col = 1; col <= count; col++) {
                    rowDiv.innerHTML += `
                        <input type="text" name="data_${row}_${col}" placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ ${row}.${col}" style="flex: 1; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 4px; font-size: 14px;">
                    `;
                }
                container.appendChild(rowDiv);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç–æ–ª–±—Ü–æ–≤
        document.getElementById('column_count').addEventListener('input', function() {
            const count = parseInt(this.value) || 5;
            generateColumnFields(count);
            if (document.getElementById('fillDataToggle').checked) {
                generateDataFields(count);
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç—É–º–±–ª–µ—Ä–∞ "–•–æ—Ç–∏—Ç–µ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ?"
        document.getElementById('fillDataToggle').addEventListener('change', function() {
            const count = parseInt(document.getElementById('column_count').value) || 5;
            const dataFields = document.getElementById('dataFields');
            if (this.checked) {
                dataFields.style.display = 'block';
                generateDataFields(count);
            } else {
                dataFields.style.display = 'none';
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', function() {
            generateColumnFields(5); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 5 —Å—Ç–æ–ª–±—Ü–æ–≤
        });
    </script>
</body>
</html>
pages/db_admin_dashboard.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

// –¢–æ–ª—å–∫–æ –¥–ª—è db_admin
if ($_SESSION['role'] !== 'db_admin') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';
try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
    $stmt = $pdo->query("SHOW TABLES");
    $tables = [];
    while ($row = $stmt->fetch(PDO::FETCH_NUM)) {
        $tables[] = $row[0];
    }
} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î: " . htmlspecialchars($e->getMessage()));
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü–∞–Ω–µ–ª—å DB-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/db_admin_dashboard.css">
</head>
<body>

<!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
<div class="user-panel">
    <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä">
    <div class="user-info">
        <strong><?= htmlspecialchars($_SESSION['username']) ?></strong><br>
        <span class="role">–†–æ–ª—å: <?= htmlspecialchars($_SESSION['role']) ?></span>
    </div>
    <div class="user-menu">
        <!-- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ -->
        <a href="db_admin_dashboard.php">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="view_db.php">–ü—Ä–æ—Å–º–æ—Ç—Ä –ë–î</a>
        <a href="../actions/create_table_form.php">–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É</a>
        <a href="../actions/backup.php">–ë—ç–∫–∞–ø</a>
        <a href="sql_console.php">SQL-–∫–æ–Ω—Å–æ–ª—å</a>
        <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
        <a href="../logout.php">–í—ã—Ö–æ–¥</a>
    </div>
</div>

<div class="content-wrapper">
    <h1 class="dashboard-header">–ü–∞–Ω–µ–ª—å DB-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>

    <div class="quick-actions">
        <a href="view_db.php" class="quick-btn btn-db">üëÅÔ∏è‚Äç –ü—Ä–æ—Å–º–æ—Ç—Ä –ë–î</a>
        <a href="../actions/create_table_form.php" class="quick-btn btn-create">‚ûï –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É</a>
        <a href="../actions/backup.php" class="quick-btn btn-backup">üíæ –ë—ç–∫–∞–ø</a>
        <a href="sql_console.php" class="quick-btn btn-sql">üíª SQL-–∫–æ–Ω—Å–æ–ª—å</a>
    </div>

    <div class="tables-section">
        <h3>–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã</h3>
        <?php if (empty($tables)): ?>
            <p style="text-align: center; color: #aaa;">–ù–µ—Ç —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.</p>
        <?php else: ?>
            <div class="tables-grid">
                <?php foreach ($tables as $table): ?>
                    <a href="view_db.php?table=<?= urlencode($table) ?>" class="table-link">
                        <?= htmlspecialchars($table) ?>
                    </a>
                <?php endforeach; ?>
            </div>
        <?php endif; ?>
    </div>
</div>

<?php include '../footer.php'; ?>

</body>
</html>
pages/db_admin_delete_table.php
<?php
session_start();
require_once '../auth.php';
requireAuth();
require_once '../log_action.php';

// –¢–æ–ª—å–∫–æ –¥–ª—è db_admin
if ($_SESSION['role'] !== 'db_admin') {
    $_SESSION['message'] = "‚ùå –£–¥–∞–ª—è—Ç—å —Ç–∞–±–ª–∏—Ü—ã –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ DB-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.";
    header("Location: ../pages/db_admin_dashboard.php");
    exit;
}

require_once '../config.php';

$table = $_GET['table'] ?? '';
if (empty($table)) {
    $_SESSION['message'] = "‚ùå –ù–µ —É–∫–∞–∑–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è.";
    header("Location: ../pages/db_admin_dashboard.php");
    exit;
}

// –ó–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
$protected_tables = ['users', 'logs', 'backups']; // –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å
if (in_array($table, $protected_tables)) {
    $_SESSION['message'] = "‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ —É–¥–∞–ª—è—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã.";
    header("Location: ../pages/db_admin_dashboard.php");
    exit;
}

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
    $stmt = $pdo->prepare("SHOW TABLES LIKE ?");
    $stmt->execute([$table]);
    if (!$stmt->fetch()) {
        $_SESSION['message'] = "‚ùå –¢–∞–±–ª–∏—Ü–∞ '$table' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.";
        header("Location: ../pages/db_admin_dashboard.php");
        exit;
    }

    // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
    $pdo->exec("DROP TABLE `$table`");
    $_SESSION['message'] = "‚úÖ –¢–∞–±–ª–∏—Ü–∞ '$table' —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞.";
    logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'DELETE_TABLE', "–¢–∞–±–ª–∏—Ü–∞: $table");

} catch (PDOException $e) {
    $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã: " . htmlspecialchars($e->getMessage());
}

header("Location: ../pages/db_admin_dashboard.php");
exit;
?>
pages/db_admin_delete.php
<?php
session_start();
require_once '../auth.php';
requireAuth();
require_once '../log_action.php';

// –¢–æ–ª—å–∫–æ –¥–ª—è db_admin
if ($_SESSION['role'] !== 'db_admin') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';

$table = $_GET['table'] ?? '';
$id = (int)($_GET['id'] ?? 0);

if (empty($table) || !$id) {
    $_SESSION['message'] = "‚ùå –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.";
    header("Location: ../pages/db_admin_view.php?table=" . urlencode($table));
    exit;
}

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
    $stmt = $pdo->prepare("SHOW TABLES LIKE ?");
    $stmt->execute([$table]);
    if (!$stmt->fetch()) {
        $_SESSION['message'] = "‚ùå –¢–∞–±–ª–∏—Ü–∞ '$table' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.";
        header("Location: ../pages/db_admin_view.php");
        exit;
    }

    // === –û—Å–æ–±–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `backups` ===
    if ($table === 'backups') {
        $stmt = $pdo->prepare("SELECT file_path FROM backups WHERE id = ?");
        $stmt->execute([$id]);
        $backup = $stmt->fetch(PDO::FETCH_ASSOC);
        if (!$backup) {
            $_SESSION['message'] = "‚ùå –ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.";
            header("Location: ../pages/db_admin_view.php?table=backups");
            exit;
        }
        $file_path = $backup['file_path'];

        $stmt = $pdo->prepare("DELETE FROM backups WHERE id = ?");
        if ($stmt->execute([$id])) {
            // –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞
            $full_path = __DIR__ . '/../' . ltrim($file_path, '/'); // –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø—É—Ç—å: /backups/... ‚Üí ../backups/...
            if (file_exists($full_path)) {
                if (unlink($full_path)) {
                    $_SESSION['message'] = "‚úÖ –ó–∞–ø–∏—Å—å –∏ —Ñ–∞–π–ª –±—ç–∫–∞–ø–∞ —É–¥–∞–ª–µ–Ω—ã.";
                } else {
                    $_SESSION['message'] = "‚ö†Ô∏è –ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞, –Ω–æ —Ñ–∞–π–ª –Ω–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å –¥–∏—Å–∫–∞.";
                }
            } else {
                $_SESSION['message'] = "‚úÖ –ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞ (—Ñ–∞–π–ª —É–∂–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –Ω–∞ –¥–∏—Å–∫–µ).";
            }
            logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'DELETE_RECORD', "–¢–∞–±–ª–∏—Ü–∞: backups, ID: $id, —Ñ–∞–π–ª: $file_path");
        } else {
            $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏ –∏–∑ –ë–î.";
        }
    } else {
        // –û–±—ã—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∞–±–ª–∏—Ü
        $stmt = $pdo->prepare("DELETE FROM `$table` WHERE id = ?");
        if ($stmt->execute([$id])) {
            $_SESSION['message'] = "‚úÖ –ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞.";
            logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'DELETE_RECORD', "–¢–∞–±–ª–∏—Ü–∞: $table, ID: $id");
        } else {
            $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏.";
        }
    }
} catch (PDOException $e) {
    $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage());
}

header("Location: ../pages/db_admin_view.php?table=" . urlencode($table));
exit;
?>
pages/db_admin_edit.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

// –¢–æ–ª—å–∫–æ –¥–ª—è db_admin
if ($_SESSION['role'] !== 'db_admin') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';
try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: " . htmlspecialchars($e->getMessage()));
}

$table = $_GET['table'] ?? '';
$id = (int)($_GET['id'] ?? 0);
if (empty($table) || !$id) {
    die("–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.");
}

require_once '../log_action.php';

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
$stmt = $pdo->prepare("SHOW TABLES LIKE ?");
$stmt->execute([$table]);
if (!$stmt->fetch()) {
    die("–¢–∞–±–ª–∏—Ü–∞ '$table' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.");
}

// –ü–æ–ª—É—á–∞–µ–º –∑–∞–ø–∏—Å—å
$stmt = $pdo->prepare("SELECT * FROM `$table` WHERE id = ?");
$stmt->execute([$id]);
$record = $stmt->fetch(PDO::FETCH_ASSOC);
if (!$record) die("–ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.");

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
if ($_POST && isset($_POST['action']) && $_POST['action'] === 'update') {
    $columns_info = $pdo->query("DESCRIBE `$table`")->fetchAll(PDO::FETCH_ASSOC);
    $set = [];
    $values = [];
    foreach ($columns_info as $col) {
        $field = $col['Field'];
        if ($field === 'id') continue;
        $set[] = "`$field` = ?";
        $value = $_POST[$field] ?? '';
        // –•–µ—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å, –µ—Å–ª–∏ –ø–æ–ª–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è 'password' –∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –ø—É—Å—Ç–æ–µ
        if ($field === 'password' && $value !== '') {
            $value = password_hash($value, PASSWORD_DEFAULT);
        }
        $values[] = $value;
    }
    $values[] = $id;
    $sql = "UPDATE `$table` SET " . implode(', ', $set) . " WHERE id = ?";
    $stmt = $pdo->prepare($sql);
    if ($stmt->execute($values)) {
        $_SESSION['message'] = "‚úÖ –ó–∞–ø–∏—Å—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞.";
        logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'EDIT_RECORD', "–¢–∞–±–ª–∏—Ü–∞: $table, ID: $id");
    } else {
        $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.";
    }
    header("Location: ../pages/db_admin_view.php?table=" . urlencode($table));
    exit;
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å ‚Äî <?= htmlspecialchars($table) ?></title>
    <link rel="stylesheet" href="../css/view_db.css">
</head>
<body>
    <div style="max-width: 800px; margin: 30px auto; background: rgba(30,25,45,0.95); padding: 20px; border-radius: 12px; border: 1px solid #5a1a8f;">
        <h2 style="text-align: center; color: #c7b8ff;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ: <?= htmlspecialchars($table) ?></h2>
        <form method="POST">
            <input type="hidden" name="action" value="update">
            <input type="hidden" name="id" value="<?= $id ?>">
            <?php foreach ($record as $col => $value): ?>
                <?php if ($col === 'id') continue; ?>
                <div style="margin: 12px 0;">
                    <label style="display: block; color: #c7b8ff; margin-bottom: 4px;"><?= htmlspecialchars($col) ?>:</label>
                    <?php if ($col === 'password'): ?>
                        <input type="text" name="<?= $col ?>" value="" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å"
                               style="width: 100%; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px;">
                    <?php else: ?>
                        <input type="text" name="<?= $col ?>" value="<?= htmlspecialchars($value) ?>"
                               style="width: 100%; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px;">
                    <?php endif; ?>
                </div>
            <?php endforeach; ?>
            <div style="text-align: center; margin-top: 20px;">
                <button type="submit" style="background: linear-gradient(to right, #3a0d6a, #5a1a8f); color: white; padding: 10px 24px; border: none; border-radius: 6px; cursor: pointer;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <a href="../pages/db_admin_view.php?table=<?= urlencode($table) ?>" style="color: #ff6b6b; text-decoration: none; margin-left: 15px;">‚ùå –û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
    </div>
</body>
</html>
pages/db_admin_sql_console.php
<?php
session_start();
require_once '../auth.php';
requireAuth();
require_once '../log_action.php';

// –¢–æ–ª—å–∫–æ –¥–ª—è db_admin
if ($_SESSION['role'] !== 'db_admin') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../pages/db_admin_dashboard.php");
    exit;
}

require_once '../config.php';

$result = null;
$error = null;
$last_query = '';

if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['sql_query'])) {
    $last_query = trim($_POST['sql_query']);
    if (!empty($last_query)) {
        try {
            $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
            $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

            $query_upper = strtoupper(ltrim($last_query));
            if (strpos($query_upper, 'SELECT') === 0) {
                $stmt = $pdo->query($last_query);
                $result = $stmt->fetchAll(PDO::FETCH_ASSOC);
            } else {
                $count = $pdo->exec($last_query);
                $result = "‚úÖ –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ. –ó–∞—Ç—Ä–æ–Ω—É—Ç–æ —Å—Ç—Ä–æ–∫: $count";
                logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'SQL_EXEC', "–ó–∞–ø—Ä–æ—Å: $last_query");
            }
        } catch (PDOException $e) {
            $error = "‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞: " . htmlspecialchars($e->getMessage());
        }
    } else {
        $error = "‚ùå –ó–∞–ø—Ä–æ—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.";
    }
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>SQL-–∫–æ–Ω—Å–æ–ª—å</title>
    <link rel="stylesheet" href="../css/view_db.css">
</head>
<body>
    <div style="max-width: 1200px; margin: 20px auto; padding: 0 20px;">
        <h2 style="color: #c7b8ff; text-align: center;">SQL-–∫–æ–Ω—Å–æ–ª—å</h2>
        <form method="POST" style="margin-bottom: 20px;">
            <label style="display: block; color: #c7b8ff; margin-bottom: 8px;">–í–≤–µ–¥–∏—Ç–µ SQL-–∑–∞–ø—Ä–æ—Å:</label>
            <textarea name="sql_query" rows="6" style="width: 100%; padding: 10px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px; font-family: monospace; font-size: 14px;" placeholder="SELECT * FROM users;"><?= htmlspecialchars($last_query) ?></textarea>
            <div style="text-align: center; margin-top: 10px;">
                <button type="submit" style="background: linear-gradient(to right, #ff3b3b, #ff6b6b); color: white; padding: 10px 24px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
                <a href="db_admin_dashboard.php" style="color: #6ab7ff; text-decoration: none; margin-left: 15px;">‚Üê –ù–∞–∑–∞–¥</a>
            </div>
        </form>

        <?php if ($error): ?>
            <div style="background: rgba(200, 50, 50, 0.3); color: #ffaaaa; padding: 12px; border-radius: 6px; margin: 10px 0; border: 1px solid #8a3a3a;">
                <?= $error ?>
            </div>
        <?php endif; ?>

        <?php if (is_array($result) && !empty($result)): ?>
            <h3 style="color: #c7b8ff;">–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <?php foreach (array_keys($result[0]) as $col): ?>
                                <th><?= htmlspecialchars($col) ?></th>
                            <?php endforeach; ?>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach ($result as $row): ?>
                            <tr>
                                <?php foreach ($row as $cell): ?>
                                    <td><?= htmlspecialchars($cell) ?></td>
                                <?php endforeach; ?>
                            </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            </div>
        <?php elseif (is_string($result)): ?>
            <div style="background: rgba(40, 200, 80, 0.3); color: #aaffaa; padding: 12px; border-radius: 6px; margin: 10px 0; border: 1px solid #3a8a3a;">
                <?= $result ?>
            </div>
        <?php endif; ?>
    </div>
</body>
</html>
pages/db_admin_view.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

// –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞
if ($_SESSION['role'] !== 'admin') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
    $stmt = $pdo->query("SHOW TABLES");
    $all_tables = [];
    while ($row = $stmt->fetch(PDO::FETCH_NUM)) {
        $all_tables[] = $row[0];
    }

    $current_table = $_GET['table'] ?? '';
    if (!in_array($current_table, $all_tables)) {
        $current_table = $all_tables[0] ?? '';
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–æ–ª—å –∏ –∞–≤–∞—Ç–∞—Ä–∫—É –∏–∑ –ë–î
    try {
        $stmt = $pdo->prepare("SELECT role, avatar FROM users WHERE id = ?");
        $stmt->execute([$_SESSION['user_id']]);
        $user = $stmt->fetch(PDO::FETCH_ASSOC);
        if ($user) {
            $_SESSION['role'] = $user['role'] ?? 'user';
            $_SESSION['avatar'] = $user['avatar'] ?? 'imang/default.png';
        } else {
            session_destroy();
            header("Location: login.php");
            exit;
        }
    } catch (PDOException $e) {
        $_SESSION['role'] = $_SESSION['role'] ?? 'user';
        $_SESSION['avatar'] = $_SESSION['avatar'] ?? 'imang/default.png';
    }
} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î: " . htmlspecialchars($e->getMessage()));
}

function getUserName($pdo, $user_id) {
    if (!$user_id) return '‚Äî';
    $stmt = $pdo->prepare("SELECT username FROM users WHERE id = ?");
    $stmt->execute([$user_id]);
    $user = $stmt->fetch(PDO::FETCH_ASSOC);
    return $user ? htmlspecialchars($user['username']) : "ID: $user_id";
}

function getServerName($pdo, $server_id) {
    if (!$server_id) return '‚Äî';
    $stmt = $pdo->prepare("SELECT name FROM servers WHERE id = ?");
    $stmt->execute([$server_id]);
    $server = $stmt->fetch(PDO::FETCH_ASSOC);
    return $server ? htmlspecialchars($server['name']) : "ID: $server_id";
}

function getStatusColor($status) {
    $status = strtolower(trim($status));
    if (in_array($status, ['up', 'active', 'planned', 'approved', 'implemented', 'resolved', 'closed', 'success', 'online', 'running'])) {
        return 'rgba(40, 200, 80, 0.3)';
    } elseif (in_array($status, ['down', 'inactive', 'failed', 'error', 'offline', 'stopped', 'deleted'])) {
        return 'rgba(200, 50, 50, 0.3)';
    } elseif (in_array($status, ['maintenance', 'updating', 'restarting'])) {
        return 'rgba(255, 165, 0, 0.3)';
    } elseif (in_array($status, ['open', 'in_progress', 'pending', 'processing'])) {
        return 'rgba(50, 100, 255, 0.3)';
    } else {
        return 'rgba(100, 100, 100, 0.3)';
    }
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: <?= htmlspecialchars($dbname) ?></title>
    <link rel="stylesheet" href="../css/view_db.css">
</head>
<body>
<!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º -->
<div class="topbar">
    <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
    <div class="user-info">
        <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ì–æ—Å—Ç—å') ?></strong><br>
        <span class="role">–†–æ–ª—å: <?= htmlspecialchars($_SESSION['role'] ?? 'user') ?></span>
    </div>
    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é -->
    <button onclick="toggleUserMenu()" style="background: none; border: none; color: #c7b8ff; font-size: 16px; cursor: pointer;">‚ñº</button>
</div>

<!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é -->
<div id="userMenu" class="dropdown-content" style="display: none;">
    <div style="padding: 8px 12px; color: #c7b8ff; font-weight: bold; cursor: pointer; display: flex; justify-content: space-between; align-items: center;"
         onclick="toggleTablesMenu()">
        üìã –¢–∞–±–ª–∏—Ü—ã
        <span id="tablesArrow" style="font-size: 14px;">‚ñº</span>
    </div>
    <div id="tablesList" style="display: none; margin-top: 8px;">
        <?php foreach ($all_tables as $table): ?>
            <a href="?table=<?= urlencode($table) ?>"
               style="display: block; padding: 6px 12px; color: #e0e0e0; text-decoration: none; border-radius: 4px; font-size: 13px;"
               onmouseover="this.style.backgroundColor='rgba(100, 80, 150, 0.3)'; this.style.color='white';"
               onmouseout="this.style.backgroundColor=''; this.style.color='#e0e0e0';">
                <?= htmlspecialchars($table) ?>
            </a>
        <?php endforeach; ?>
    </div>
    <hr>
    <a href="edit_profile.php">üñäÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
    <a href="../actions/create_table_form.php">‚ûï –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É</a>
    <?php if ($_SESSION['role'] === 'admin'): ?>
        <a href="../actions/backup.php"
           style="display: block; margin-left: 5px; width: 90%; padding: 10px 12px; color: #e0e0e0; text-decoration: none; border-radius: 6px; font-size: 14px;">
            üíæ –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
        </a>
    <?php endif; ?>
    <?php if ($_SESSION['role'] === 'admin'): ?>
        <a href="sql_console.php">üíª SQL-–∫–æ–Ω—Å–æ–ª—å</a>
    <?php endif; ?>
    <hr>
    <a href="../logout.php">üö™ –í—ã–π—Ç–∏</a>
</div>

<div class="content-wrapper">
    <?php if (!empty($_SESSION['message'])): ?>
        <div style="text-align: center; padding: 12px; background: rgba(40, 100, 40, 0.3); color: #aaffaa; margin: 10px auto; max-width: 600px; border-radius: 8px; border: 1px solid #3a8a3a;">
            <?= htmlspecialchars($_SESSION['message']) ?>
        </div>
        <?php unset($_SESSION['message']); ?>
    <?php endif; ?>

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
        <h2 style="margin: 0;">–¢–∞–±–ª–∏—Ü–∞: <?= htmlspecialchars($current_table) ?></h2>
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <a href="../actions/add_record.php?table=<?= urlencode($current_table) ?>"
               style="background: linear-gradient(to right, #00c853, #64dd17); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; text-decoration: none;">
                + –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
            </a>
            <?php if ($_SESSION['role'] === 'admin' && $current_table !== 'users'): ?>
                <a href="../actions/delete_table.php?table=<?= urlencode($current_table) ?>"
                   onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–Æ —Ç–∞–±–ª–∏—Ü—É <?= addslashes($current_table) ?>? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')"
                   style="background: linear-gradient(to right, #ff3b3b, #ff6b6b); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; text-decoration: none;">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É
                </a>
            <?php endif; ?>
        </div>
    </div>

    <div class="table-container">
        <?php
        try {
            $stmt = $pdo->query("SELECT * FROM `$current_table`");
            $columns = [];
            for ($i = 0; $i < $stmt->columnCount(); $i++) {
                $col = $stmt->getColumnMeta($i);
                $columns[] = $col['name'];
            }
            echo "<table>";
            echo "<tr>";
            foreach ($columns as $col) {
                echo "<th>" . htmlspecialchars($col) . "</th>";
            }
            if (in_array('id', $columns)) {
                echo "<th>–î–µ–π—Å—Ç–≤–∏—è</th>";
            }
            echo "</tr>";
            while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
                echo "<tr>";
                foreach ($columns as $col) {
                    $value = $row[$col];
                    if ($current_table === 'changes' && in_array($col, ['requested_by', 'approved_by'])) {
                        $value = getUserName($pdo, $value);
                    } elseif ($current_table === 'incidents' && $col === 'assigned_to') {
                        $value = getUserName($pdo, $value);
                    } elseif ($current_table === 'backups' && $col === 'server_id') {
                        $value = getServerName($pdo, $value);
                    }
                    if (stripos($col, 'status') !== false) {
                        $bgColor = getStatusColor($value);
                        echo "<td style='background: {$bgColor}; padding: 10px 12px; border-bottom: 1px solid rgba(100, 80, 130, 0.2);'>";
                        echo htmlspecialchars($value);
                        echo "</td>";
                    } else {
                        echo "<td>" . htmlspecialchars($value) . "</td>";
                    }
                }
                if (in_array('id', $columns)) {
                    $id = $row['id'];
                    echo "<td class='actions'>";
                    echo "<a href='../actions/edit_record.php?table=" . urlencode($current_table) . "&id=$id' class='btn-edit'>‚úèÔ∏è –ò–∑–º</a> ";
                    echo "<a href='../actions/delete_record.php?table=" . urlencode($current_table) . "&id=$id' class='btn-delete' onclick='return confirm(\"–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?\")'>üóëÔ∏è –£–¥</a>";
                    echo "</td>";
                }
                echo "</tr>";
            }
            echo "</table>";
        } catch (PDOException $e) {
            echo "<div style='color: #ff6b6b; padding: 10px; background: rgba(200, 50, 50, 0.3); border-radius: 6px;'>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ —Ç–∞–±–ª–∏—Ü–µ: " . htmlspecialchars($e->getMessage()) . "</div>";
        }
        ?>
    </div>
</div>

<script>
function toggleUserMenu() {
    const menu = document.getElementById('userMenu');
    const button = document.querySelector('.topbar button');
    if (menu.style.display === 'block') {
        menu.style.display = 'none';
    } else {
        menu.style.display = 'block';
    }
}
function toggleTablesMenu() {
    const list = document.getElementById('tablesList');
    const arrow = document.getElementById('tablesArrow');
    if (list.style.display === 'block') {
        list.style.display = 'none';
        arrow.textContent = '‚ñº';
    } else {
        list.style.display = 'block';
        arrow.textContent = '‚ñ≤';
    }
}
// –ó–∞–∫—Ä—ã–≤–∞—Ç—å –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
document.addEventListener('click', function(event) {
    const menu = document.getElementById('userMenu');
    const button = document.querySelector('.topbar button');
    if (!button.contains(event.target) && !menu.contains(event.target)) {
        menu.style.display = 'none';
    }
});
</script>

<?php include '../footer.php'; ?>
</body>
</html>
pages/edit_profile.php
<?php
session_start();
require_once '../auth.php';
requireAuth();
require_once '../config.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î: " . htmlspecialchars($e->getMessage()));
}

$user_id = $_SESSION['user_id'] ?? 0;
if (!$user_id) {
    die("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.");
}

// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
$stmt = $pdo->prepare("SELECT username, email, role, avatar FROM users WHERE id = ?");
$stmt->execute([$user_id]);
$user = $stmt->fetch(PDO::FETCH_ASSOC);

if (!$user) {
    die("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.");
}

$error = '';
$success = '';

if ($_POST && isset($_POST['action']) && $_POST['action'] === 'update_profile') {
    $new_username = trim($_POST['username'] ?? '');
    $new_email = trim($_POST['email'] ?? '');
    $new_password = $_POST['password'] ?? '';
    $confirm_password = $_POST['confirm_password'] ?? '';

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–Ω–∞
    if (empty($new_username)) {
        $error = "–õ–æ–≥–∏–Ω –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.";
    } else {
        $stmt_check = $pdo->prepare("SELECT id FROM users WHERE username = ? AND id != ?");
        $stmt_check->execute([$new_username, $user_id]);
        if ($stmt_check->fetch()) {
            $error = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.";
        }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ email
    if (!filter_var($new_email, FILTER_VALIDATE_EMAIL)) {
        $error = "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email.";
    }

    if ($error) {
        goto show_form;
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏
    $avatar_path = $user['avatar']; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî —Å—Ç–∞—Ä—ã–π –∞–≤–∞—Ç–∞—Ä
    if (!empty($_FILES['avatar']['name'])) {
        $upload_dir = 'imang/';
        $allowed_types = ['image/jpeg', 'image/png', 'image/gif'];
        $file_type = $_FILES['avatar']['type'];

        if (!in_array($file_type, $allowed_types)) {
            $error = "–†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ JPG, PNG, GIF.";
            goto show_form;
        }

        $file_ext = pathinfo($_FILES['avatar']['name'], PATHINFO_EXTENSION);
        $new_filename = 'user_' . $user_id . '_' . time() . '.' . $file_ext;
        $target_path = $upload_dir . $new_filename;

        if (move_uploaded_file($_FILES['avatar']['tmp_name'], $target_path)) {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –∞–≤–∞—Ç–∞—Ä (–µ—Å–ª–∏ –Ω–µ default)
            $old_avatar = $user['avatar'];
            if ($old_avatar !== 'imang/default.png' && file_exists($old_avatar)) {
                unlink($old_avatar);
            }
            $avatar_path = $target_path;
        } else {
            $error = "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤–∞—Ç–∞—Ä–∫–∏.";
            goto show_form;
        }
    }

    // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    $updates = [];
    $params = [];

    if ($new_username !== $user['username']) {
        $updates[] = "username = ?";
        $params[] = $new_username;
    }
    if ($new_email !== $user['email']) {
        $updates[] = "email = ?";
        $params[] = $new_email;
    }
    if (!empty($new_password)) {
        if ($new_password !== $confirm_password) {
            $error = "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç.";
            goto show_form;
        }
        $updates[] = "password_hash = ?";
        $params[] = password_hash($new_password, PASSWORD_DEFAULT);
    }
    if ($avatar_path !== $user['avatar']) {
        $updates[] = "avatar = ?";
        $params[] = $avatar_path;
    }

    if (empty($updates)) {
        $success = "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π.";
    } else {
        $params[] = $user_id;
        $sql = "UPDATE users SET " . implode(', ', $updates) . " WHERE id = ?";
        $stmt_update = $pdo->prepare($sql);
        if ($stmt_update->execute($params)) {
            $success = "‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω.";
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Å—Å–∏—é
            if ($new_username !== $user['username']) {
                $_SESSION['username'] = $new_username;
            }
            $_SESSION['avatar'] = $avatar_path;
        } else {
            $error = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏.";
        }
    }

    if ($success) {
        $_SESSION['message'] = $success;
        header("Location: ../pages/view_db.php");
        exit;
    }
}

show_form:
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</title>
    <link rel="stylesheet" href="../css/view_db.css">
</head>
<body>
    <div style="max-width: 600px; margin: 30px auto; background: rgba(30,25,45,0.95); padding: 20px; border-radius: 12px; border: 1px solid #5a1a8f;">
        <h2 style="text-align: center; color: #c7b8ff;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h2>

        <?php if ($error): ?>
            <div style="text-align: center; padding: 10px; background: rgba(200, 50, 50, 0.3); color: #ffaaaa; margin: 10px auto; max-width: 600px; border-radius: 6px;">
                <?= htmlspecialchars($error) ?>
            </div>
        <?php endif; ?>

        <form method="POST" enctype="multipart/form-data">
            <input type="hidden" name="action" value="update_profile">

            <!-- –ê–≤–∞—Ç–∞—Ä–∫–∞ -->
            <div style="text-align: center; margin-bottom: 15px;">
                <img src="<?= htmlspecialchars($user['avatar']) ?>" alt="–ê–≤–∞—Ç–∞—Ä" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid #5a1a8f;">
                <div style="margin-top: 8px; font-size: 12px; color: #c7b8ff;">–¢–µ–∫—É—â–∞—è –∞–≤–∞—Ç–∞—Ä–∫–∞</div>
            </div>

            <div style="margin: 12px 0;">
                <label style="display: block; color: #c7b8ff; margin-bottom: 4px;">–ù–æ–≤–∞—è –∞–≤–∞—Ç–∞—Ä–∫–∞ (JPG/PNG/GIF):</label>
                <input type="file" name="avatar" accept="image/*"
                       style="width: 100%; padding: 4px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px;">
            </div>

            <div style="margin: 12px 0;">
                <label style="display: block; color: #c7b8ff; margin-bottom: 4px;">–õ–æ–≥–∏–Ω:</label>
                <input type="text" name="username" value="<?= htmlspecialchars($user['username']) ?>"
                       style="width: 100%; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px;" required>
            </div>

            <div style="margin: 12px 0;">
                <label style="display: block; color: #c7b8ff; margin-bottom: 4px;">Email:</label>
                <input type="email" name="email" value="<?= htmlspecialchars($user['email']) ?>"
                       style="width: 100%; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px;" required>
            </div>

            <div style="margin: 12px 0;">
                <label style="display: block; color: #c7b8ff; margin-bottom: 4px;">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ –º–µ–Ω—è–µ—Ç–µ):</label>
                <input type="password" name="password"
                       style="width: 100%; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px;">
            </div>

            <div style="margin: 12px 0;">
                <label style="display: block; color: #c7b8ff; margin-bottom: 4px;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
                <input type="password" name="confirm_password"
                       style="width: 100%; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px;">
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button type="submit" 
                        style="background: linear-gradient(to right, #3a0d6a, #5a1a8f); color: white; padding: 10px 24px; border: none; border-radius: 6px; cursor: pointer;">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </button>
                <a href="view_db.php" style="color: #ff6b6b; text-decoration: none; margin-left: 15px;">–û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
    </div>
</body>
</html>
pages/engineer_dashboard.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

// –¢–æ–ª—å–∫–æ –¥–ª—è –∏–Ω–∂–µ–Ω–µ—Ä–∞
if ($_SESSION['role'] !== 'engineer') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–∫—Ä—ã—Ç—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã
    $stmt = $pdo->prepare("
        SELECT i.id, i.title, i.description, i.status, i.assigned_to, i.created_at,
               u.username AS assigned_username
        FROM incidents i
        LEFT JOIN users u ON i.assigned_to = u.id
        WHERE i.status IN ('open', 'in_progress')
        ORDER BY i.created_at DESC
        LIMIT 5
    ");
    $stmt->execute();
    $incidents = $stmt->fetchAll(PDO::FETCH_ASSOC);

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–µ—Ä–≤–µ—Ä—ã
    $stmt = $pdo->prepare("SELECT id, name, ip_address, status FROM servers ORDER BY name");
    $stmt->execute();
    $servers = $stmt->fetchAll(PDO::FETCH_ASSOC);

} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage()));
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü–∞–Ω–µ–ª—å –∏–Ω–∂–µ–Ω–µ—Ä–∞</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/engineer_dashboard.css">
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-panel">
        <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä">
        <div class="user-info">
            <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ò–Ω–∂–µ–Ω–µ—Ä') ?></strong><br>
            <span class="role">–†–æ–ª—å: <?= htmlspecialchars($_SESSION['role'] ?? 'user') ?></span>
        </div>
        <div class="user-menu">
            <a href="engineer_dashboard.php">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="view_incidents.php">–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã</a>
            <a href="view_servers.php">–°–µ—Ä–≤–µ—Ä—ã</a>
            <a href="view_network.php">–°–µ—Ç—å</a>
            <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="../logout.php">–í—ã—Ö–æ–¥</a>
        </div>
    </div>

    <div class="content-wrapper">
        <?php if (!isset($_SESSION['welcome_shown'])): ?>
            <div style="text-align: center; padding: 12px; background: rgba(40, 100, 40, 0.3); color: #aaffaa; margin: 10px auto; max-width: 600px; border-radius: 8px; border: 1px solid #3a8a3a;">
                –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É, <strong><?= htmlspecialchars($_SESSION['username']) ?></strong>! –í–∞—à–∞ —Ä–æ–ª—å: <strong><?= htmlspecialchars($_SESSION['role']) ?></strong>.
            </div>
            <?php $_SESSION['welcome_shown'] = true; ?>
        <?php endif; ?>

        <div class="engineer-panel">
            <h1 class="engineer-header">–ü–∞–Ω–µ–ª—å –∏–Ω–∂–µ–Ω–µ—Ä–∞</h1>

            <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã -->
            <div class="incidents-section">
                <h2 style="color: #c7b8ff; margin-top: 0; margin-bottom: 15px;">–ê–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã</h2>
                <?php if (empty($incidents)): ?>
                    <p style="color: #aaa; text-align: center;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤.</p>
                <?php else: ?>
                    <?php foreach ($incidents as $incident): ?>
                        <div class="incident-item">
                            <div class="incident-title"><?= htmlspecialchars($incident['title']) ?></div>
                            <div>–ù–∞–∑–Ω–∞—á–µ–Ω: <?= htmlspecialchars($incident['assigned_username'] ?? '‚Äî') ?></div>
                            <div class="incident-status <?= $incident['status'] === 'open' ? 'status-open' : 'status-in_progress' ?>">
                                <?= htmlspecialchars($incident['status']) ?>
                            </div>
                            <div class="incident-actions">
                                <a href="update_incident.php?id=<?= $incident['id'] ?>">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</a>
                            </div>
                        </div>
                    <?php endforeach; ?>
                <?php endif; ?>
            </div>

            <!-- –°–µ—Ä–≤–µ—Ä—ã -->
            <div class="servers-section">
                <h2 style="color: #c7b8ff; margin-top: 0; margin-bottom: 15px;">–°–µ—Ä–≤–µ—Ä—ã</h2>
                <?php if (empty($servers)): ?>
                    <p style="color: #aaa; text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–µ—Ä–≤–µ—Ä–∞—Ö.</p>
                <?php else: ?>
                    <?php foreach ($servers as $server): ?>
                        <div class="server-item">
                            <div class="server-name"><?= htmlspecialchars($server['name']) ?></div>
                            <div class="server-ip">IP: <?= htmlspecialchars($server['ip_address']) ?></div>
                            <div class="server-status <?= $server['status'] === 'online' ? 'status-online' : ($server['status'] === 'offline' ? 'status-offline' : 'status-maintenance') ?>">
                                <?= htmlspecialchars($server['status']) ?>
                            </div>
                        </div>
                    <?php endforeach; ?>
                <?php endif; ?>
            </div>
        </div>
    </div>
</body>
</html>
pages/history.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

if ($_SESSION['role'] !== 'user') {
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –ø–æ–∫—É–ø–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    $stmt = $pdo->prepare("
        SELECT p.id, p.item_type, p.service_id, p.package_id, p.price, p.purchased_at,
               s.name AS service_name,
               t.name AS package_name
        FROM purchases p
        LEFT JOIN services s ON p.service_id = s.id
        LEFT JOIN tariff_plans t ON p.package_id = t.id
        WHERE p.user_id = ?
        ORDER BY p.purchased_at DESC
    ");
    $stmt->execute([$_SESSION['user_id']]);
    $purchases = $stmt->fetchAll(PDO::FETCH_ASSOC);

} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage()));
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/history.css">
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-panel">
        <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
        <div class="user-info">
            <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å') ?></strong>
        </div>
        <div class="user-menu">
            <a href="user_dashboard.php">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="cart.php">–ö–æ—Ä–∑–∏–Ω–∞</a>
            <a href="purchased.php">–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏</a>
            <a href="support.php">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
            <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="billing.php">–ë–∏–ª–ª–∏–Ω–≥</a>
            <a href="referral.php">–†–µ—Ñ–µ—Ä–∞–ª—ã</a>
            <a href="../logout.php">–í—ã—Ö–æ–¥</a>
        </div>
    </div>

    <div class="content-wrapper">
        <h1 style="text-align: center; color: #c7b8ff;">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫</h1>

        <?php if (empty($purchases)): ?>
            <div style="text-align: center; color: #aaa; font-size: 1.2rem; margin: 60px 0;">
                –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–∫—É–ø–æ–∫.
            </div>
        <?php else: ?>
            <div class="purchases-list">
                <?php foreach ($purchases as $purchase): ?>
                    <div class="purchase-item">
                        <h3>
                            <?= htmlspecialchars($purchase['item_type'] === 'service' ? $purchase['service_name'] : $purchase['package_name']) ?>
                        </h3>
                        <div class="purchase-info">
                            <span class="purchase-price">–¶–µ–Ω–∞: <?= number_format($purchase['price'], 0, '', ' ') ?> ‚ÇΩ</span>
                            <span class="purchase-date">–î–∞—Ç–∞: <?= htmlspecialchars(date('d.m.Y H:i', strtotime($purchase['purchased_at']))) ?></span>
                        </div>
                    </div>
                <?php endforeach; ?>
            </div>
        <?php endif; ?>

        <div style="text-align: center; margin-top: 30px;">
            <a href="services.php" class="btn" style="background: linear-gradient(to right, #00c853, #64dd17); color: white;">–ö—É–ø–∏—Ç—å –µ—â—ë</a>
        </div>
    </div>
</body>
</html>
pages/manager_dashboard.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

// –¢–æ–ª—å–∫–æ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏ –≤—ã—à–µ
if (!in_array($_SESSION['role'], ['manager', 'admin'])) {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';
try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // === –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ ===
    $stmt = $pdo->query("SELECT COUNT(*) FROM incidents");
    $incident_count = $stmt->fetchColumn();

    $stmt = $pdo->query("SELECT COUNT(*) FROM servers");
    $server_count = $stmt->fetchColumn();

    $stmt = $pdo->query("SELECT SUM(price) FROM purchases");
    $total_revenue = $stmt->fetchColumn() ?: 0;

    // === –ì—Ä–∞—Ñ–∏–∫: –í—ã—Ä—É—á–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π ===
    $stmt = $pdo->prepare("
        SELECT DATE(purchased_at) as day, COALESCE(SUM(price), 0) as total
        FROM purchases
        WHERE purchased_at >= CURDATE() - INTERVAL 6 DAY
        GROUP BY day
        ORDER BY day
    ");
    $stmt->execute();
    $daily_revenue = $stmt->fetchAll(PDO::FETCH_KEY_PAIR);

    $revenue_labels = [];
    $revenue_data = [];
    for ($i = 6; $i >= 0; $i--) {
        $date = date('Y-m-d', strtotime("-$i days"));
        $revenue_labels[] = date('d.m', strtotime($date));
        $revenue_data[] = (float)($daily_revenue[$date] ?? 0);
    }

    // === –ì—Ä–∞—Ñ–∏–∫: –°—Ç–∞—Ç—É—Å—ã –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ ===
    $stmt = $pdo->query("
        SELECT status, COUNT(*) as count
        FROM incidents
        GROUP BY status
    ");
    $status_counts = $stmt->fetchAll(PDO::FETCH_KEY_PAIR);
    $incident_status_labels = array_keys($status_counts);
    $incident_status_data = array_values($status_counts);

    // === –ì—Ä–∞—Ñ–∏–∫: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ 7 –¥–Ω–µ–π ===
    $stmt = $pdo->prepare("
        SELECT DATE(created_at) as day, COUNT(*) as count
        FROM users
        WHERE created_at >= CURDATE() - INTERVAL 6 DAY
        GROUP BY day
        ORDER BY day
    ");
    $stmt->execute();
    $daily_registrations = $stmt->fetchAll(PDO::FETCH_KEY_PAIR);

    $reg_labels = [];
    $reg_data = [];
    for ($i = 6; $i >= 0; $i--) {
        $date = date('Y-m-d', strtotime("-$i days"));
        $reg_labels[] = date('d.m', strtotime($date));
        $reg_data[] = (int)($daily_registrations[$date] ?? 0);
    }

    // === –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã ===
    $stmt = $pdo->prepare("
        SELECT id, title, status, created_at 
        FROM incidents 
        ORDER BY created_at DESC 
        LIMIT 5
    ");
    $stmt->execute();
    $recent_incidents = $stmt->fetchAll(PDO::FETCH_ASSOC);

} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage()));
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü–∞–Ω–µ–ª—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/manager_dashboard.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
<div class="user-panel">
    <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
    <div class="user-info">
        <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ú–µ–Ω–µ–¥–∂–µ—Ä') ?></strong><br>
        <span class="role">–†–æ–ª—å: <?= htmlspecialchars($_SESSION['role']) ?></span>
    </div>
    <div class="user-menu">
        <a href="manager_dashboard.php">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="view_billing_summary.php">–ë–∏–ª–ª–∏–Ω–≥</a>
        <a href="support_tickets_all.php">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
        <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
        <a href="../logout.php" class="logout">–í—ã—Ö–æ–¥</a>
    </div>
</div>

<div class="content-wrapper">

    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
    <?php if (!isset($_SESSION['welcome_shown_manager'])): ?>
        <div class="welcome-banner">
            –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É, <strong><?= htmlspecialchars($_SESSION['username']) ?></strong>! –í–∞—à–∞ —Ä–æ–ª—å: <strong><?= htmlspecialchars($_SESSION['role']) ?></strong>.
        </div>
        <?php $_SESSION['welcome_shown_manager'] = true; ?>
    <?php endif; ?>

    <h1 style="text-align: center; color: #c7b8ff;">–ü–∞–Ω–µ–ª—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞</h1>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="dashboard-grid">
        <div class="stat-card">
            <div class="stat-label">–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã</div>
            <div class="stat-value"><?= $incident_count ?></div>
        </div>
        <div class="stat-card">
            <div class="stat-label">–°–µ—Ä–≤–µ—Ä—ã</div>
            <div class="stat-value"><?= $server_count ?></div>
        </div>
        <div class="stat-card">
            <div class="stat-label">–í—ã—Ä—É—á–∫–∞</div>
            <div class="stat-value"><?= number_format($total_revenue, 0, '', ' ') ?> ‚ÇΩ</div>
        </div>
    </div>

    <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin: 20px 0 30px;">
        <!-- –í—ã—Ä—É—á–∫–∞ -->
        <div style="background: rgba(30, 25, 45, 0.8); padding: 15px; border-radius: 12px; border: 1px solid rgba(100, 60, 180, 0.3); height: 200px; position: relative;">
            <h3 style="color: #c7b8ff; text-align: center; margin-top: 0;">–í—ã—Ä—É—á–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é</h3>
            <canvas id="revenueChart" style="width: 100%; height: 150px;"></canvas>
        </div>

        <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
        <div style="background: rgba(30, 25, 45, 0.8); padding: 15px; border-radius: 12px; border: 1px solid rgba(100, 60, 180, 0.3); height: 200px; position: relative;">
            <h3 style="color: #c7b8ff; text-align: center; margin-top: 0;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
            <canvas id="registrationsChart" style="width: 100%; height: 150px;"></canvas>
        </div>

        <!-- –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º -->
        <div style="background: rgba(30, 25, 45, 0.8); padding: 15px; border-radius: 12px; border: 1px solid rgba(100, 60, 180, 0.3); height: 200px; position: relative;">
            <h3 style="color: #c7b8ff; text-align: center; margin-top: 0;">–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º</h3>
            <canvas id="incidentsChart" style="width: 100%; height: 150px;"></canvas>
        </div>
    </div>

    <script>
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    new Chart(revenueCtx, {
        type: 'line',
        data: {
            labels: <?= json_encode($revenue_labels) ?>,
            datasets: [{
                label: '–í—ã—Ä—É—á–∫–∞ (‚ÇΩ)',
                data: <?= json_encode($revenue_data) ?>,
                borderColor: '#6ab7ff',
                backgroundColor: 'rgba(106, 183, 255, 0.1)',
                borderWidth: 2,
                fill: true,
                tension: 0.3
            }]
        },
        options: {
            responsive: false,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, ticks: { color: '#a090cc' } },
                x: { ticks: { color: '#a090cc' } }
            }
        }
    });

    const regCtx = document.getElementById('registrationsChart').getContext('2d');
    new Chart(regCtx, {
        type: 'bar',
        data: {
            labels: <?= json_encode($reg_labels) ?>,
            datasets: [{
                label: '–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏',
                data: <?= json_encode($reg_data) ?>,
                backgroundColor: '#ffcc00',
                borderColor: '#ff9800',
                borderWidth: 1
            }]
        },
        options: {
            responsive: false,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, ticks: { color: '#a090cc' } },
                x: { ticks: { color: '#a090cc' } }
            }
        }
    });

    const incidentsCtx = document.getElementById('incidentsChart').getContext('2d');
    const statusColors = {
        'open': '#ff6b6b',
        'in_progress': '#ffcc66',
        'resolved': '#aaffaa',
        'closed': '#8888ff',
        'default': '#c7b8ff'
    };
    const labels = <?= json_encode($incident_status_labels) ?>;
    const data = <?= json_encode($incident_status_data) ?>;
    const colors = labels.map(label => statusColors[label] || statusColors.default);

    new Chart(incidentsCtx, {
        type: 'doughnut',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: colors,
                borderWidth: 0
            }]
        },
        options: {
            responsive: false,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } }
        }
    });

    setTimeout(() => {
        const ctx = incidentsCtx;
        const width = ctx.canvas.width;
        const height = ctx.canvas.height;
        const centerX = width / 2;
        const centerY = height / 2;
        let yOffset = -40;

        ctx.font = '12px Arial';
        ctx.fillStyle = '#ffffff';

        for (let i = 0; i < labels.length; i++) {
            const label = labels[i];
            const color = colors[i];

            ctx.fillStyle = color;
            ctx.fillRect(centerX - 60, centerY + yOffset, 10, 10);

            ctx.fillStyle = '#ffffff';
            ctx.fillText(`${label}`, centerX - 45, centerY + yOffset + 8);

            yOffset += 20;
        }
    }, 100);
    </script>

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã -->
    <h2 class="section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã</h2>
    <?php if (empty($recent_incidents)): ?>
        <p style="color: #aaa; text-align: center;">–ù–µ—Ç –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤.</p>
    <?php else: ?>
        <ul class="incident-list">
            <?php foreach ($recent_incidents as $inc): ?>
                <li class="incident-item">
                    <strong><?= htmlspecialchars($inc['title']) ?></strong><br>
                    <small>
                        <?= date('d.m.Y H:i', strtotime($inc['created_at'])) ?> |
                        <span class="status-badge status-<?= htmlspecialchars($inc['status']) ?>">
                            <?= htmlspecialchars($inc['status']) ?>
                        </span>
                    </small>
                </li>
            <?php endforeach; ?>
        </ul>
    <?php endif; ?>

</div>

<?php include '../footer.php'; ?>

</body>
</html>
pages/notifications.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

if ($_SESSION['role'] !== 'user') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    $stmt = $pdo->prepare("
        SELECT id, type, title, message, created_at, is_read
        FROM notifications
        WHERE user_id = ?
        ORDER BY created_at DESC
    ");
    $stmt->execute([$_SESSION['user_id']]);
    $notifications = $stmt->fetchAll(PDO::FETCH_ASSOC);

} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage()));
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/notifications.css">
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-panel">
        <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
        <div class="user-info">
            <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å') ?></strong>
        </div>
        <div class="user-menu">
            <a href="services.php">–£—Å–ª—É–≥–∏</a>
            <a href="cart.php">–ö–æ—Ä–∑–∏–Ω–∞</a>
            <a href="purchased.php">–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏</a>
            <a href="history.php">–ò—Å—Ç–æ—Ä–∏—è</a>
            <a href="support.php">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
            <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="billing.php">–ë–∏–ª–ª–∏–Ω–≥</a>
            <a href="referral.php">–†–µ—Ñ–µ—Ä–∞–ª—ã</a>
            <a href="../logout.php">–í—ã—Ö–æ–¥</a>
        </div>
    </div>

    <div class="content-wrapper" style="padding: 0 20px;">
        <h1 style="text-align: center; color: #c7b8ff;">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h1>

        <?php if (empty($notifications)): ?>
            <div style="text-align: center; color: #aaa; font-size: 1.2rem; margin: 60px 0;">
                –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
            </div>
        <?php else: ?>
            <div class="notifications-list">
                <?php foreach ($notifications as $notif): ?>
                    <div class="notification-item <?= $notif['is_read'] ? '' : 'unread' ?>">
                        <div class="notification-type"><?= htmlspecialchars($notif['type']) ?></div>
                        <div class="notification-title"><?= htmlspecialchars($notif['title']) ?></div>
                        <div class="notification-content"><?= nl2br(htmlspecialchars($notif['message'])) ?></div>
                        <div class="notification-date"><?= htmlspecialchars(date('d.m.Y H:i', strtotime($notif['created_at']))) ?></div>
                        <?php if (!$notif['is_read']): ?>
                            <div class="mark-read" onclick="markAsRead(<?= (int)$notif['id'] ?>)">–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ</div>
                        <?php endif; ?>
                    </div>
                <?php endforeach; ?>
            </div>
        <?php endif; ?>

        <div style="text-align: center; margin-top: 30px;">
            <a href="user_dashboard.php" class="btn" style="background: linear-gradient(to right, #00c853, #64dd17); color: white;">–ù–∞–∑–∞–¥</a>
        </div>
    </div>

    <script>
        function markAsRead(id) {
            fetch('../api/mark_notification_read.php?id=' + id)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ—Ç–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.');
                    }
                })
                .catch(() => {
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É.');
                });
        }
    </script>
</body>
</html>—ã
pages/payment_method.php
<?php
session_start();
require_once '../auth.php';
requireAuth();
require_once '../log_action.php';

if ($_SESSION['role'] !== 'user') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';

if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['payment_method'])) {
    try {
        $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
        $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        $stmt = $pdo->prepare("
            SELECT c.id AS cart_id, c.type, c.service_id, c.package_id,
                   COALESCE(s.price, p.price) AS price
            FROM cart c
            LEFT JOIN services s ON c.service_id = s.id AND c.type = 'service'
            LEFT JOIN tariff_plans p ON c.package_id = p.id AND c.type = 'package'
            WHERE c.user_id = ? AND c.added_at IS NOT NULL
        ");
        $stmt->execute([$_SESSION['user_id']]);
        $items = $stmt->fetchAll(PDO::FETCH_ASSOC);

        if (empty($items)) {
            $_SESSION['message'] = "‚ùå –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.";
            header("Location: cart.php");
            exit;
        }

        // –ù–∞—á–∏–Ω–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
        $pdo->beginTransaction();

        // –ö–æ–ø–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä –≤ —Ç–∞–±–ª–∏—Ü—É purchases
        foreach ($items as $item) {
            $stmt_ins = $pdo->prepare("
                INSERT INTO purchases (user_id, item_type, service_id, package_id, price)
                VALUES (?, ?, ?, ?, ?)
            ");
            $stmt_ins->execute([
                $_SESSION['user_id'],
                $item['type'],
                $item['type'] === 'service' ? $item['service_id'] : null,
                $item['type'] === 'package' ? $item['package_id'] : null,
                $item['price']
            ]);
        }

        // –£–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
        $stmt_del = $pdo->prepare("DELETE FROM cart WHERE user_id = ?");
        $stmt_del->execute([$_SESSION['user_id']]);

        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞
        $stmt_upd = $pdo->prepare("UPDATE users SET last_verification_code_sent_at = NOW() WHERE id = ?");
        $stmt_upd->execute([$_SESSION['user_id']]);

        // –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—É—é –ø–æ–∫—É–ø–∫—É
        logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'PURCHASE_SUCCESS', "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤: " . count($items));

        $pdo->commit();

        $_SESSION['message'] = "‚úÖ –ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∞!";
        header("Location: purchased.php");
        exit;

    } catch (PDOException $e) {
        $pdo->rollback();
        $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –ø–æ–∫—É–ø–∫–∏.";
        header("Location: cart.php");
        exit;
    }
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/payment_method.css">
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-panel">
        <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
        <div class="user-info">
            <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å') ?></strong>
        </div>
        <div class="user-menu">
            <a href="user_dashboard.php">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="cart.php">–ö–æ—Ä–∑–∏–Ω–∞</a>
            <a href="history.php">–ò—Å—Ç–æ—Ä–∏—è</a>
            <a href="support.php">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
            <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="billing.php">–ë–∏–ª–ª–∏–Ω–≥</a>
            <a href="referral.php">–†–µ—Ñ–µ—Ä–∞–ª—ã</a>
            <a href="../logout.php">–í—ã—Ö–æ–¥</a>
        </div>
    </div>

    <div class="content-wrapper">
        <div class="payment-box">
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</h2>
            <form method="POST">
                <label>
                    <input type="radio" name="payment_method" value="sfp" required> –°–ë–ü (–°–∏—Å—Ç–µ–º–∞ –±—ã—Å—Ç—Ä—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π)
                </label>
                <label>
                    <input type="radio" name="payment_method" value="other"> –î—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–±
                </label>
                <button type="submit">–û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–∫—É–ø–∫—É</button>
            </form>
        </div>
    </div>
</body>
</html>
pages/purchased.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

if ($_SESSION['role'] !== 'user') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¢–û–õ–¨–ö–û –∫—É–ø–ª–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ —Ç–∞–±–ª–∏—Ü—ã purchases
    $stmt = $pdo->prepare("
        SELECT p.item_type, p.service_id, p.package_id, p.price, p.purchased_at,
               s.name AS service_name,
               t.name AS package_name
        FROM purchases p
        LEFT JOIN services s ON p.service_id = s.id
        LEFT JOIN tariff_plans t ON p.package_id = t.id
        WHERE p.user_id = ?
        ORDER BY p.purchased_at DESC
    ");
    $stmt->execute([$_SESSION['user_id']]);
    $items = $stmt->fetchAll(PDO::FETCH_ASSOC);

} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage()));
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/purchased.css">
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-panel">
        <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
        <div class="user-info">
            <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å') ?></strong>
        </div>
        <div class="user-menu">
            <a href="user_dashboard.php">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="cart.php">–ö–æ—Ä–∑–∏–Ω–∞</a>
            <a href="history.php">–ò—Å—Ç–æ—Ä–∏—è</a>
            <a href="support.php">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
            <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="billing.php">–ë–∏–ª–ª–∏–Ω–≥</a>
            <a href="referral.php">–†–µ—Ñ–µ—Ä–∞–ª—ã</a>
            <a href="../logout.php">–í—ã—Ö–æ–¥</a>
        </div>
    </div>

    <div class="content-wrapper">
        <h1 style="text-align: center; color: #c7b8ff;">–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏</h1>

        <?php if (empty($items)): ?>
            <div class="empty-purchases">
                –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–∫—É–ø–æ–∫.
                <a href="services.php" class="buy-more-btn">–ö—É–ø–∏—Ç—å —É—Å–ª—É–≥–∏</a>
            </div>
        <?php else: ?>
            <?php foreach ($items as $item): ?>
                <div class="purchased-item">
                    <?php if ($item['item_type'] === 'service'): ?>
                        <h3>–£—Å–ª—É–≥–∞: <?= htmlspecialchars($item['service_name']) ?></h3>
                    <?php else: ?>
                        <h3>–ü–∞–∫–µ—Ç: <?= htmlspecialchars($item['package_name']) ?></h3>
                    <?php endif; ?>
                    <div class="price">–¶–µ–Ω–∞: <?= number_format($item['price'], 0, '', ' ') ?> ‚ÇΩ</div>
                    <div class="date">–ö—É–ø–ª–µ–Ω–æ: <?= htmlspecialchars(date('d.m.Y H:i', strtotime($item['purchased_at']))) ?></div>
                </div>
            <?php endforeach; ?>
            <div style="text-align: center; margin-top: 30px;">
                <a href="services.php" class="buy-more-btn">–ö—É–ø–∏—Ç—å –µ—â—ë</a>
            </div>
        <?php endif; ?>
    </div>
</body>
</html>
pages/referral.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

if ($_SESSION['role'] !== 'user') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    $user_id = $_SESSION['user_id'];
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥
    $stmt = $pdo->prepare("SELECT referral_code FROM users WHERE id = ?");
    $stmt->execute([$user_id]);
    $user = $stmt->fetch(PDO::FETCH_ASSOC);
    
    if (!$user || empty($user['referral_code'])) {
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥
        $referral_code = $user_id . '-' . substr(md5($_SESSION['username']), 0, 8);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        $stmt = $pdo->prepare("UPDATE users SET referral_code = ? WHERE id = ?");
        $stmt->execute([$referral_code, $user_id]);
        $referral_code = $referral_code;
    } else {
        $referral_code = $user['referral_code'];
    }

    // –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö ‚Äî –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò–©–ï–ú –ü–û referral_code
    $stmt = $pdo->prepare("
        SELECT COUNT(*) as invited_count
        FROM users
        WHERE referral_code = ?
    ");
    $stmt->execute([$referral_code]);
    $invited = (int) $stmt->fetch(PDO::FETCH_ASSOC)['invited_count'];

    // –°—á–∏—Ç–∞–µ–º –±–æ–Ω—É—Å—ã ‚Äî –ò–°–ü–†–ê–í–õ–ï–ù–û: JOIN –ü–û referral_code
    $stmt = $pdo->prepare("
        SELECT COALESCE(SUM(p.price), 0) as total_spent
        FROM purchases p
        JOIN users u ON p.user_id = u.id
        WHERE u.referral_code = ?
    ");
    $stmt->execute([$referral_code]);
    $total_spent = $stmt->fetch(PDO::FETCH_ASSOC)['total_spent'];
    $total_bonus = round($total_spent * 0.1, 2);

} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage()));
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/referral.css">
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-panel">
        <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
        <div class="user-info">
            <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å') ?></strong>
        </div>
        <div class="user-menu">
            <a href="services.php">–£—Å–ª—É–≥–∏</a>
            <a href="cart.php">–ö–æ—Ä–∑–∏–Ω–∞</a>
            <a href="purchased.php">–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏</a>
            <a href="history.php">–ò—Å—Ç–æ—Ä–∏—è</a>
            <a href="support.php">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
            <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="billing.php">–ë–∏–ª–ª–∏–Ω–≥</a>
            <a href="notifications.php">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
            <a href="../logout.php">–í—ã—Ö–æ–¥</a>
        </div>
    </div>

    <div class="content-wrapper">
        <div class="referral-container">
            <h2 class="referral-header">
                <span class="icon">üåü</span>
                –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
            </h2>
            <p class="referral-intro">–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –±–æ–Ω—É—Å—ã!</p>

            <div class="referral-link-box">
                <input type="text" value="https://<?php echo $_SERVER['HTTP_HOST']; ?>/register.php?ref=<?= urlencode($referral_code) ?>" readonly>
                <button class="referral-copy-btn" onclick="copyReferralLink()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
            </div>

            <div class="referral-stats">
                <div class="stat-item">
                    <div class="stat-value"><?= $invited ?></div>
                    <div class="stat-label">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value"><?= number_format($total_bonus, 2, '.', ' ') ?> ‚ÇΩ</div>
                    <div class="stat-label">–ë–æ–Ω—É—Å—ã</div>
                </div>
            </div>

            <p class="referral-info">
                –ó–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞, –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ –≤–∞—à–µ–π —Å—Å—ã–ª–∫–µ –∏ —Å–æ–≤–µ—Ä—à–∏—Ç –ø–æ–∫—É–ø–∫—É, –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ 10% –æ—Ç —Å—É–º–º—ã –µ–≥–æ –ø–µ—Ä–≤–æ–π –ø–æ–∫—É–ø–∫–∏.
            </p>

            <a href="user_dashboard.php" class="back-btn">–ù–∞–∑–∞–¥</a>
        </div>
    </div>

    <script>
        function copyReferralLink() {
            const link = document.querySelector('.referral-link-box input').value;
            navigator.clipboard.writeText(link).then(() => {
                alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
            }).catch(err => {
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É.');
            });
        }
    </script>
</body>
</html>
pages/services.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

// –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ 'user', –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ index.php
if ($_SESSION['role'] !== 'user') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';
try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î: " . htmlspecialchars($e->getMessage()));
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –¢–û–õ–¨–ö–û —É—Å–ª—É–≥–∏ —Å —Ü–µ–Ω–æ–π > 0
$stmt = $pdo->prepare("SELECT id, name, description, price FROM services WHERE price > 0 ORDER BY sort_order");
$stmt->execute();
$services = $stmt->fetchAll(PDO::FETCH_ASSOC);

// –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–∞–∫–µ—Ç—ã
$stmt = $pdo->query("SELECT * FROM tariff_plans ORDER BY sort_order LIMIT 3");
$packages = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞—à–∏ —É—Å–ª—É–≥–∏ ‚Äî –ò–¢-–°–µ—Ä–≤–∏—Å</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/services.css">
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-panel">
        <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
        <div class="user-info">
            <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å') ?></strong><br>
        </div>
        <div class="user-menu">
            <a href="user_dashboard.php">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="cart.php">–ö–æ—Ä–∑–∏–Ω–∞</a>
            <a href="purchased.php">–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏</a>
            <a href="history.php">–ò—Å—Ç–æ—Ä–∏—è</a>
            <a href="support.php">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
            <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="billing.php">–ë–∏–ª–ª–∏–Ω–≥</a>
            <a href="notifications.php">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
            <a href="referral.php">–†–µ—Ñ–µ—Ä–∞–ª—ã</a>
            <a href="../logout.php">–í—ã—Ö–æ–¥</a>
        </div>
    </div>

    <div class="content-wrapper">
        <div class="header">
            <h1>–ù–∞—à–∏ —É—Å–ª—É–≥–∏</h1>
            <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7</p>
        </div>

        <div class="services-page">
            <?php if (empty($services)): ?>
                <div class="no-services">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–ª–∞—Ç–Ω—ã—Ö —É—Å–ª—É–≥.</div>
            <?php else: ?>
                <div class="services-grid">
                    <?php foreach ($services as $service): ?>
                        <div class="service-card">
                            <h3><?= htmlspecialchars($service['name']) ?></h3>
                            <p><?= htmlspecialchars($service['description']) ?></p>
                            <div class="price">–¶–µ–Ω–∞: <?= number_format($service['price'], 0, '', ' ') ?> ‚ÇΩ</div>
                            <a href="../actions/add_to_cart.php?type=service&id=<?= (int)$service['id'] ?>" class="btn-cart">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</a>
                        </div>
                    <?php endforeach; ?>
                </div>
            <?php endif; ?>
        </div>

        <!-- –ü–∞–∫–µ—Ç—ã -->
        <div class="packages-section">
            <h2>–ù–∞—à–∏ –ø–∞–∫–µ—Ç—ã</h2>
            <div class="packages-grid">
                <?php foreach ($packages as $package): ?>
                    <div class="package-card">
                        <h3><?= htmlspecialchars($package['name']) ?></h3>
                        <div class="price">–¶–µ–Ω–∞: <?= number_format($package['price'], 0, '', ' ') ?> ‚ÇΩ</div>
                        <ul>
                            <?php 
                            $features = explode("\n", $package['features']);
                            foreach ($features as $feature):
                                if (!empty(trim($feature))):
                            ?>
                                <li><?= htmlspecialchars(trim($feature)) ?></li>
                            <?php 
                                endif;
                            endforeach; 
                            ?>
                        </ul>
                        <a href="../actions/add_to_cart.php?type=package&id=<?= (int)$package['id'] ?>" class="btn">–í—ã–±—Ä–∞—Ç—å –ø–∞–∫–µ—Ç</a>
                    </div>
                <?php endforeach; ?>
            </div>
        </div>

        <div class="actions">
            <a href="user_dashboard.php" class="btn btn-back">–ù–∞–∑–∞–¥</a>
            <a href="../logout.php" class="btn btn-logout">–í—ã–π—Ç–∏</a>
        </div>
    </div>

    <?php include '../footer.php'; ?>
</body>
</html>
pages/sql_console.php
<?php
session_start();
require_once '../auth.php';
requireAuth();
require_once '../log_action.php';

if (!in_array($_SESSION['role'], ['admin', 'db_admin'])) {
    $_SESSION['message'] = "‚ùå –¢–æ–ª—å–∫–æ DB-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏–ª–∏ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é.";
    header("Location: ../pages/db_admin_dashboard.php");
    exit;
}

require_once '../config.php';

$result = null;
$error = null;
$last_query = '';

if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['sql_query'])) {
    $last_query = trim($_POST['sql_query']);
    if (!empty($last_query)) {
        try {
            $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
            $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

            $query_upper = strtoupper(ltrim($last_query));
            if (strpos($query_upper, 'SELECT') === 0) {
                $stmt = $pdo->query($last_query);
                $result = $stmt->fetchAll(PDO::FETCH_ASSOC);
            } else {
                $count = $pdo->exec($last_query);
                $result = "‚úÖ –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ. –ó–∞—Ç—Ä–æ–Ω—É—Ç–æ —Å—Ç—Ä–æ–∫: $count";
                // –õ–æ–≥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–Ω–µ SELECT)
                logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'SQL_EXEC', "–ó–∞–ø—Ä–æ—Å: $last_query");
            }
        } catch (PDOException $e) {
            $error = "‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞: " . htmlspecialchars($e->getMessage());
        }
    } else {
        $error = "‚ùå –ó–∞–ø—Ä–æ—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.";
    }
}
?>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>SQL-–∫–æ–Ω—Å–æ–ª—å</title>
    <link rel="stylesheet" href="../css/view_db.css">
</head>
<body>
    <div style="max-width: 1200px; margin: 20px auto; padding: 0 20px;">
        <h2 style="color: #c7b8ff; text-align: center;">SQL-–∫–æ–Ω—Å–æ–ª—å</h2>

        <form method="POST" style="margin-bottom: 20px;">
            <label style="display: block; color: #c7b8ff; margin-bottom: 8px;">–í–≤–µ–¥–∏—Ç–µ SQL-–∑–∞–ø—Ä–æ—Å:</label>
            <textarea name="sql_query" rows="6" style="width: 100%; padding: 10px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px; font-family: monospace; font-size: 14px;" placeholder="SELECT * FROM users;"><?= htmlspecialchars($last_query) ?></textarea>
            <div style="text-align: center; margin-top: 10px;">
                <button type="submit" style="background: linear-gradient(to right, #ff3b3b, #ff6b6b); color: white; padding: 10px 24px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
                <a href="view_db.php" style="color: #6ab7ff; text-decoration: none; margin-left: 15px;">‚Üê –ù–∞–∑–∞–¥</a>
            </div>
        </form>

        <?php if ($error): ?>
            <div style="background: rgba(200, 50, 50, 0.3); color: #ffaaaa; padding: 12px; border-radius: 6px; margin: 10px 0; border: 1px solid #8a3a3a;">
                <?= $error ?>
            </div>
        <?php endif; ?>

        <?php if (is_array($result) && !empty($result)): ?>
            <h3 style="color: #c7b8ff;">–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <?php foreach (array_keys($result[0]) as $col): ?>
                                <th><?= htmlspecialchars($col) ?></th>
                            <?php endforeach; ?>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach ($result as $row): ?>
                            <tr>
                                <?php foreach ($row as $cell): ?>
                                    <td><?= htmlspecialchars($cell) ?></td>
                                <?php endforeach; ?>
                            </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            </div>
        <?php elseif (is_string($result)): ?>
            <div style="background: rgba(40, 200, 80, 0.3); color: #aaffaa; padding: 12px; border-radius: 6px; margin: 10px 0; border: 1px solid #3a8a3a;">
                <?= $result ?>
            </div>
        <?php endif; ?>
    </div>
</body>
</html>
pages/support_tickets_all.php
<?php
session_start();
require_once '../auth.php';
requireAuth();
require_once '../log_action.php';

// –¢–æ–ª—å–∫–æ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏ –≤—ã—à–µ
if (!in_array($_SESSION['role'], ['manager', 'admin'])) {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';
try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –í—Å–µ –∑–∞—è–≤–∫–∏
    $stmt = $pdo->query("
        SELECT t.id, t.subject, t.message, t.status, t.created_at,
               u.username AS user_name
        FROM support_tickets t
        JOIN users u ON t.user_id = u.id
        ORDER BY t.created_at DESC
    ");
    $tickets = $stmt->fetchAll(PDO::FETCH_ASSOC);

} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage()));
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–í—Å–µ –∑–∞—è–≤–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/support.css">
    <link rel="stylesheet" href="../css/support_tickets_all.css">
</head>
<body>

<!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
<div class="user-panel">
    <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
    <div class="user-info">
        <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ú–µ–Ω–µ–¥–∂–µ—Ä') ?></strong><br>
        <span class="role">–†–æ–ª—å: <?= htmlspecialchars($_SESSION['role']) ?></span>
    </div>
    <div class="user-menu">
        <a href="manager_dashboard.php">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="view_billing_summary.php">–ë–∏–ª–ª–∏–Ω–≥</a>
        <a href="support_tickets_all.php">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
        <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
        <a href="../logout.php" class="logout">–í—ã—Ö–æ–¥</a>
    </div>
</div>

<div class="content-wrapper">
    <h1 style="text-align: center; color: #c7b8ff;">–í—Å–µ –∑–∞—è–≤–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏</h1>
    <p style="text-align: center; color: #a090cc; margin-bottom: 30px;">
        –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ–±—Ä–∞—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
    </p>

    <div class="support-container">
        <?php if (empty($tickets)): ?>
            <div class="empty-tickets">–ó–∞—è–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç.</div>
        <?php else: ?>
            <?php foreach ($tickets as $ticket): ?>
                <div class="ticket-item">
                    <div class="ticket-header">
                        <h4><?= htmlspecialchars($ticket['subject']) ?></h4>
                        <span class="ticket-status <?= $ticket['status'] === 'open' ? 'status-open' : 'status-closed' ?>">
                            <?= $ticket['status'] === 'open' ? '–û—Ç–∫—Ä—ã—Ç–∞' : '–ó–∞–∫—Ä—ã—Ç–∞' ?>
                        </span>
                    </div>
                    <div class="ticket-body">
                        <?= htmlspecialchars($ticket['message']) ?>
                    </div>
                    <div class="ticket-date">
                        –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <strong><?= htmlspecialchars($ticket['user_name']) ?></strong><br>
                        –î–∞—Ç–∞: <?= htmlspecialchars(date('d.m.Y H:i', strtotime($ticket['created_at']))) ?>
                    </div>
                </div>
            <?php endforeach; ?>
        <?php endif; ?>
    </div>
</div>

<?php include '../footer.php'; ?>

</body>
</html>
pages/support.php
<?php
session_start();
require_once '../auth.php';
requireAuth();
require_once '../log_action.php';

if ($_SESSION['role'] !== 'user') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';

$error = '';
$success = '';

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['action']) && $_POST['action'] === 'create_ticket') {
    $subject = trim($_POST['subject'] ?? '');
    $message = trim($_POST['message'] ?? '');

    if (empty($subject) || empty($message)) {
        $error = "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ–º—É –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ.";
    } else {
        try {
            $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
            $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

            $stmt = $pdo->prepare("
                INSERT INTO support_tickets (user_id, subject, message, status, created_at)
                VALUES (?, ?, ?, 'open', NOW())
            ");
            $stmt->execute([$_SESSION['user_id'], $subject, $message]);

            // –õ–æ–≥–∏—Ä—É–µ–º –¢–û–õ–¨–ö–û –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏
            logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'SUPPORT_TICKET_CREATED', "–¢–µ–º–∞: $subject");

            $success = "‚úÖ –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.";

        } catch (PDOException $e) {
            $error = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏.";
        }
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫
try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    $stmt = $pdo->prepare("
        SELECT t.id, t.subject, t.message, t.status, t.created_at,
               u.username AS user_name
        FROM support_tickets t
        JOIN users u ON t.user_id = u.id
        WHERE t.user_id = ?
        ORDER BY t.created_at DESC
    ");
    $stmt->execute([$_SESSION['user_id']]);
    $tickets = $stmt->fetchAll(PDO::FETCH_ASSOC);

} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage()));
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/support.css">
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-panel">
        <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
        <div class="user-info">
            <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å') ?></strong>
        </div>
        <div class="user-menu">
            <a href="services.php">–£—Å–ª—É–≥–∏</a>
            <a href="cart.php">–ö–æ—Ä–∑–∏–Ω–∞</a>
            <a href="purchased.php">–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏</a>
            <a href="history.php">–ò—Å—Ç–æ—Ä–∏—è</a>
            <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="billing.php">–ë–∏–ª–ª–∏–Ω–≥</a>
            <a href="notifications.php">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
            <a href="referral.php">–†–µ—Ñ–µ—Ä–∞–ª—ã</a>
            <a href="../logout.php">–í—ã—Ö–æ–¥</a>
        </div>
    </div>

    <div class="content-wrapper">
        <h1 style="text-align: center; color: #c7b8ff;">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</h1>
        <p style="text-align: center; color: #a090cc; margin-bottom: 30px;">
            –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –û—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É ‚Äî –º—ã –æ—Ç–≤–µ—Ç–∏–º –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤.
        </p>

        <div class="support-container">
            <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏ -->
            <div class="ticket-form">
                <h3 style="color: #c7b8ff; margin-top: 0;">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞—è–≤–∫—É</h3>
                <?php if ($error): ?>
                    <div style="text-align: center; padding: 10px; background: rgba(200, 50, 50, 0.3); color: #ffaaaa; margin: 10px 0; border-radius: 6px;">
                        <?= htmlspecialchars($error) ?>
                    </div>
                <?php endif; ?>
                <?php if ($success): ?>
                    <div style="text-align: center; padding: 10px; background: rgba(40, 200, 80, 0.3); color: #aaffaa; margin: 10px 0; border-radius: 6px;">
                        <?= htmlspecialchars($success) ?>
                    </div>
                <?php endif; ?>
                <form method="POST">
                    <input type="hidden" name="action" value="create_ticket">
                    <label style="display: block; color: #c7b8ff; margin-bottom: 4px;">–¢–µ–º–∞:</label>
                    <input type="text" name="subject" value="<?= htmlspecialchars($_POST['subject'] ?? '') ?>" required
                           style="width: 100%; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px;">
                    <label style="display: block; color: #c7b8ff; margin-bottom: 4px; margin-top: 10px;">–°–æ–æ–±—â–µ–Ω–∏–µ:</label>
                    <textarea name="message" rows="6" required
                              style="width: 100%; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px;"><?= htmlspecialchars($_POST['message'] ?? '') ?></textarea>
                    <button type="submit" style="background: linear-gradient(to right, #3a0d6a, #5a1a8f); color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; margin-top: 10px;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
                </form>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ -->
            <h3 style="color: #c7b8ff; margin-top: 40px;">–í–∞—à–∏ –∑–∞—è–≤–∫–∏</h3>
            <?php if (empty($tickets)): ?>
                <div class="empty-tickets">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞—è–≤–æ–∫.</div>
            <?php else: ?>
                <?php foreach ($tickets as $ticket): ?>
                    <div class="ticket-item">
                        <div class="ticket-header">
                            <h4><?= htmlspecialchars($ticket['subject']) ?></h4>
                            <span class="ticket-status <?= $ticket['status'] === 'open' ? 'status-open' : 'status-closed' ?>">
                                <?= $ticket['status'] === 'open' ? '–û—Ç–∫—Ä—ã—Ç–∞' : '–ó–∞–∫—Ä—ã—Ç–∞' ?>
                            </span>
                        </div>
                        <div class="ticket-body">
                            <?= htmlspecialchars($ticket['message']) ?>
                        </div>
                        <div class="ticket-date">
                            –°–æ–∑–¥–∞–Ω–∞: <?= htmlspecialchars(date('d.m.Y H:i', strtotime($ticket['created_at']))) ?>
                        </div>
                    </div>
                <?php endforeach; ?>
            <?php endif; ?>
        </div>
    </div>
</body>
</html>
pages/update_device.php
<?php
session_start();
require_once '../auth.php';
requireAuth();
require_once '../log_action.php';

// –¢–æ–ª—å–∫–æ –¥–ª—è –∏–Ω–∂–µ–Ω–µ—Ä–∞
if ($_SESSION['role'] !== 'engineer') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../pages/view_network.php");
    exit;
}

require_once '../config.php';

$device_id = (int)($_GET['id'] ?? 0);
if (!$device_id) {
    $_SESSION['message'] = "‚ùå –ù–µ —É–∫–∞–∑–∞–Ω ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.";
    header("Location: ../pages/view_network.php");
    exit;
}

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ü–æ–ª—É—á–∞–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ ID
    $stmt = $pdo->prepare("SELECT `id`, `name`, `ip_address`, `device_type`, `status`, `last_checked` FROM `network_devices` WHERE `id` = ?");
    $stmt->execute([$device_id]);
    $device = $stmt->fetch(PDO::FETCH_ASSOC);

    if (!$device) {
        $_SESSION['message]'] = "‚ùå –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.";
        header("Location: ../pages/view_network.php");
        exit;
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
    if ($_POST && isset($_POST['action']) && $_POST['action'] === 'update') {
        $columns_info = $pdo->query("DESCRIBE network_devices")->fetchAll(PDO::FETCH_ASSOC);
        $set = [];
        $values = [];
        foreach ($columns_info as $col) {
            $field = $col['Field'];
            if ($field === 'id') continue;
            $set[] = "`$field` = ?";
            $value = $_POST[$field] ?? '';
            $values[] = $value;
        }
        $values[] = $device_id;
        $sql = "UPDATE network_devices SET " . implode(', ', $set) . " WHERE id = ?";
        $stmt = $pdo->prepare($sql);
        if ($stmt->execute($values)) {
            $_SESSION['message'] = "‚úÖ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ.";
            logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'NETWORK_DEVICE_UPDATED', "ID: $device_id, IP: " . ($_POST['ip_address'] ?? '‚Äî'));
        } else {
            $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.";
        }
        header("Location: ../pages/view_network.php");
        exit;
    }

} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage()));
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ ‚Äî <?= htmlspecialchars($device['name']) ?></title>
    <link rel="stylesheet" href="../css/view_db.css">
</head>
<body>
    <div style="max-width: 800px; margin: 30px auto; background: rgba(30,25,45,0.95); padding: 20px; border-radius: 12px; border: 1px solid #5a1a8f;">
        <h2 style="text-align: center; color: #c7b8ff;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: <?= htmlspecialchars($device['name']) ?></h2>
        <form method="POST">
            <input type="hidden" name="action" value="update">
            <input type="hidden" name="id" value="<?= (int)$device['id'] ?>">
            <?php foreach ($device as $col => $value): ?>
                <?php if ($col === 'id') continue; ?>
                <div style="margin: 12px 0;">
                    <label style="display: block; color: #c7b8ff; margin-bottom: 4px;"><?= htmlspecialchars($col) ?>:</label>
                    <input type="text" name="<?= $col ?>" value="<?= htmlspecialchars($value) ?>"
                           style="width: 100%; padding: 8px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px;">
                </div>
            <?php endforeach; ?>
            <div style="text-align: center; margin-top: 20px;">
                <button type="submit" style="background: linear-gradient(to right, #3a0d6a, #5a1a8f); color: white; padding: 10px 24px; border: none; border-radius: 6px; cursor: pointer;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <a href="../pages/view_network.php" style="color: #ff6b6b; text-decoration: none; margin-left: 15px;">‚ùå –û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
    </div>
</body>
</html>
pages/update_incident.php
<?php
session_start();
require_once '../auth.php';
requireAuth();
require_once '../log_action.php';

if ($_SESSION['role'] !== 'engineer') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';

$incident_id = (int)($_GET['id'] ?? 0);
if (!$incident_id) {
    $_SESSION['message'] = "‚ùå –ù–µ —É–∫–∞–∑–∞–Ω ID –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞.";
    header("Location: view_incidents.php");
    exit;
}

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ü–∏–¥–µ–Ω—Ç
    $stmt = $pdo->prepare("SELECT * FROM incidents WHERE id = ?");
    $stmt->execute([$incident_id]);
    $incident = $stmt->fetch(PDO::FETCH_ASSOC);

    if (!$incident) {
        $_SESSION['message'] = "‚ùå –ò–Ω—Ü–∏–¥–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.";
        header("Location: view_incidents.php");
        exit;
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
    if ($_POST && isset($_POST['action']) && $_POST['action'] === 'update') {
        $new_status = $_POST['status'] ?? '';
        $allowed_statuses = ['open', 'in_progress', 'resolved', 'closed'];
        if (!in_array($new_status, $allowed_statuses)) {
            $_SESSION['message'] = "‚ùå –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Å—Ç–∞—Ç—É—Å.";
        } else {
            $stmt = $pdo->prepare("UPDATE incidents SET status = ? WHERE id = ?");
            if ($stmt->execute([$new_status, $incident_id])) {
                $_SESSION['message'] = "‚úÖ –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—ë–Ω.";
                // –õ–æ–≥–∏—Ä—É–µ–º –¢–û–õ–¨–ö–û –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
                logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'INCIDENT_STATUS_UPDATED', "ID: $incident_id, –ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å: $new_status");
            } else {
                $_SESSION['message'] = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.";
            }
        }
        header("Location: engineer_dashboard.php");
        exit;
    }

} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage()));
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/update_incident.css">
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-panel">
        <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
        <div class="user-info">
            <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ò–Ω–∂–µ–Ω–µ—Ä') ?></strong><br>
            <span class="role">–†–æ–ª—å: <?= htmlspecialchars($_SESSION['role'] ?? 'user') ?></span>
        </div>
        <div class="user-menu">
            <a href="engineer_dashboard.php">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="view_incidents.php">–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã</a>
            <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="../logout.php">–í—ã—Ö–æ–¥</a>
        </div>
    </div>

    <div class="content-wrapper">
        <div class="form-card">
            <h2 style="text-align: center; color: #c7b8ff;">–û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç</h2>
            <h3><?= htmlspecialchars($incident['title']) ?></h3>
            <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> <?= htmlspecialchars($incident['description']) ?></p>
            <p><strong>–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:</strong> <?= htmlspecialchars($incident['status']) ?></p>

            <form method="POST">
                <input type="hidden" name="action" value="update">
                <input type="hidden" name="id" value="<?= $incident_id ?>">
                <label for="status" style="display: block; color: #c7b8ff; margin: 10px 0 5px;">–ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å:</label>
                <select name="status" id="status" required style="width: 100%; padding: 8px; background: #1e192d; color: white; border: 1px solid #5a1a8f; border-radius: 6px;">
                    <option value="open" <?= $incident['status'] === 'open' ? 'selected' : '' ?>>–û—Ç–∫—Ä—ã—Ç</option>
                    <option value="in_progress" <?= $incident['status'] === 'in_progress' ? 'selected' : '' ?>>–í —Ä–∞–±–æ—Ç–µ</option>
                    <option value="resolved" <?= $incident['status'] === 'resolved' ? 'selected' : '' ?>>–†–µ—à—ë–Ω</option>
                    <option value="closed" <?= $incident['status'] === 'closed' ? 'selected' : '' ?>>–ó–∞–∫—Ä—ã—Ç</option>
                </select>
                <div style="text-align: center; margin-top: 20px;">
                    <button type="submit" class="save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <a href="engineer_dashboard.php" class="cancel-btn">–û—Ç–º–µ–Ω–∞</a>
                </div>
            </form>
        </div>
    </div>
</body>
</html>
pages/user_dashboard.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

if ($_SESSION['role'] !== 'user') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';
try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î: " . htmlspecialchars($e->getMessage()));
}

$stmt = $pdo->query("SELECT * FROM services WHERE id IN (9, 10, 11, 12)");
$services = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ò–¢-–°–µ—Ä–≤–∏—Å ‚Äî –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-panel">
        <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? 'imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä">
        <div class="user-info">
            <strong><?= htmlspecialchars($_SESSION['username']) ?></strong>
        </div>
        <div class="user-menu">
    <a href="user_dashboard.php">–ì–ª–∞–≤–Ω–∞—è</a>
    <a href="cart.php">–ö–æ—Ä–∑–∏–Ω–∞</a>
    <a href="purchased.php">–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏</a>
    <a href="history.php">–ò—Å—Ç–æ—Ä–∏—è</a>
    <a href="support.php">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
    <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
    <a href="billing.php">–ë–∏–ª–ª–∏–Ω–≥</a>
    <a href="notifications.php">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
    <a href="referral.php">–†–µ—Ñ–µ—Ä–∞–ª—ã</a>
    <a href="../logout.php">–í—ã—Ö–æ–¥</a>
</div>
    </div>

    <div class="content-wrapper">
        <div class="header">
            <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ò–¢-–°–µ—Ä–≤–∏—Å</h1>
            <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7</p>
        </div>
        <div class="services-grid">
            <?php foreach ($services as $service): ?>
                <div class="service-card">
                    <h3><?= htmlspecialchars($service['name']) ?></h3>
                    <p><?= htmlspecialchars($service['description']) ?></p>
                </div>
            <?php endforeach; ?>

            <!-- –í—Å–µ —É—Å–ª—É–≥–∏ -->
            <div class="service-card">
                <h3>–í—Å–µ —É—Å–ª—É–≥–∏</h3>
                <p>–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –Ω–∞—à–∏—Ö —É—Å–ª—É–≥.</p>
                <a href="services.php" class="btn" style="background: linear-gradient(to right, #00c853, #64dd17); color: white; text-decoration: none; margin-top: 10px; display: inline-block; padding: 10px 20px; border-radius: 6px;">–ü–µ—Ä–µ–π—Ç–∏</a>
            </div>
        </div>

        <div class="support-section">
            <h2>üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
            <p>–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –ú—ã –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏!</p>
            <div class="support-info">
                <div class="contact-item"><span class="icon">üìß</span> support@it-service.com</div>
                <div class="contact-item"><span class="icon">üìû</span> +7 (999) 123-45-67</div>
                <div class="contact-item"><span class="icon">üïí</span> –†–∞–±–æ—Ç–∞–µ–º 24/7</div>
            </div>
        </div>
    </div>

    <?php include '../footer.php'; ?>
</body>
</html>
pages/verify_email.php
<?php
session_start();
require_once '../auth.php';
requireAuth();
require_once '../log_action.php';

if ($_SESSION['role'] !== 'user') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';

$error = '';
$success = '';

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ —É–∂–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω email
try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    $stmt = $pdo->prepare("SELECT last_verification_code_sent_at FROM users WHERE id = ?");
    $stmt->execute([$_SESSION['user_id']]);
    $last_sent = $stmt->fetchColumn();

    // –ï—Å–ª–∏ –¥–∞—Ç–∞ –µ—Å—Ç—å ‚Äî –∑–Ω–∞—á–∏—Ç, email —É–∂–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω
    if ($last_sent) {
        $_SESSION['verification_code'] = 'ALREADY_VERIFIED';
        header("Location: payment_method.php");
        exit;
    }

} catch (PDOException $e) {
    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—ã—á–Ω—É—é –ª–æ–≥–∏–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–µ
}

// –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞ ‚Äî email –ù–ï –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω, –Ω—É–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –∫–æ–¥
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['code'])) {
    $entered_code = trim($_POST['code'] ?? '');

    if (empty($entered_code)) {
        $error = "‚ùå –ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω.";
    } elseif ($entered_code === ($_SESSION['verification_code'] ?? '')) {
        try {
            $email = $_SESSION['pending_email'] ?? '';
            if (!empty($email) && filter_var($email, FILTER_VALIDATE_EMAIL)) {
                $stmt = $pdo->prepare("UPDATE users SET email = ? WHERE id = ?");
                $stmt->execute([$email, $_SESSION['user_id']]);
                $_SESSION['email'] = $email;

                logAction($pdo, $_SESSION['user_id'], $_SESSION['username'], 'EMAIL_VERIFIED', "Email: $email");
            }

            // –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            unset($_SESSION['verification_code']);
            unset($_SESSION['pending_email']);

            header("Location: payment_method.php");
            exit;

        } catch (PDOException $e) {
            $error = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ email.";
        }
    } else {
        $error = "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.";
    }
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ Email</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/verify_email.css">
</head>
<body>
    <div class="user-panel">
        <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä">
        <div class="user-info">
            <strong><?= htmlspecialchars($_SESSION['username']) ?></strong>
        </div>
        <div style="margin-left: auto;">
            <a href="../index.php" style="color: #e0e0e0; text-decoration: none; margin-left: 15px;">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="edit_profile.php" style="color: #e0e0e0; text-decoration: none; margin-left: 15px;">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="../logout.php" style="color: #ff6b6b; text-decoration: none; margin-left: 15px;">–í—ã—Ö–æ–¥</a>
        </div>
    </div>

    <div class="content-wrapper">
        <div class="verification-box">
            <h2>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ Email</h2>
            <p>–ù–∞ –≤–∞—à email –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è. –í–≤–µ–¥–∏—Ç–µ –µ–≥–æ –Ω–∏–∂–µ.</p>
            <?php if ($error): ?>
                <div class="error-message">
                    <?= htmlspecialchars($error) ?>
                </div>
            <?php endif; ?>
            <form method="POST">
                <input type="text" name="code" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è" required
                       style="width: 100%; padding: 10px; background: #1e192d; border: 1px solid #5a1a8f; color: white; border-radius: 6px; margin: 10px 0;">
                <button type="submit"
                        style="background: linear-gradient(to right, #00c853, #64dd17); color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer;">
                    –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                </button>
            </form>
        </div>
    </div>
</body>
</html>
pages/view_billing_summary.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

// –¢–æ–ª—å–∫–æ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏ –≤—ã—à–µ
if (!in_array($_SESSION['role'], ['manager', 'admin'])) {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';
try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞
    $stmt = $pdo->query("SELECT SUM(price) FROM purchases");
    $total_revenue = $stmt->fetchColumn() ?: 0;

    // –ö–æ–ª-–≤–æ –ø–æ–∫—É–ø–æ–∫
    $stmt = $pdo->query("SELECT COUNT(*) FROM purchases");
    $total_purchases = $stmt->fetchColumn();

    // –ö–æ–ª-–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π
    $stmt = $pdo->query("SELECT COUNT(DISTINCT user_id) FROM purchases");
    $unique_customers = $stmt->fetchColumn();

    // –¢–æ–ø-5 –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π
    $stmt = $pdo->prepare("
        SELECT u.username, SUM(p.price) AS total_spent, COUNT(p.id) AS purchase_count
        FROM purchases p
        JOIN users u ON p.user_id = u.id
        GROUP BY p.user_id
        ORDER BY total_spent DESC
        LIMIT 5
    ");
    $stmt->execute();
    $top_customers = $stmt->fetchAll(PDO::FETCH_ASSOC);

    // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ø–æ–∫—É–ø–æ–∫
    $stmt = $pdo->prepare("
        SELECT p.id, p.price, p.purchased_at, p.item_type,
               s.name AS service_name,
               t.name AS package_name,
               u.username AS buyer
        FROM purchases p
        LEFT JOIN services s ON p.service_id = s.id
        LEFT JOIN tariff_plans t ON p.package_id = t.id
        JOIN users u ON p.user_id = u.id
        ORDER BY p.purchased_at DESC
        LIMIT 10
    ");
    $stmt->execute();
    $recent_purchases = $stmt->fetchAll(PDO::FETCH_ASSOC);

} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage()));
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ë–∏–ª–ª–∏–Ω–≥ ‚Äî –°–≤–æ–¥–∫–∞</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/view_billing_summary.css">
</head>
<body>

<!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
<div class="user-panel">
    <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
    <div class="user-info">
        <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ú–µ–Ω–µ–¥–∂–µ—Ä') ?></strong><br>
        <span class="role">–†–æ–ª—å: <?= htmlspecialchars($_SESSION['role']) ?></span>
    </div>
    <div class="user-menu">
        <a href="manager_dashboard.php">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="view_billing_summary.php">–ë–∏–ª–ª–∏–Ω–≥</a>
        <a href="support_tickets_all.php">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
        <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
        <a href="../logout.php" class="logout">–í—ã—Ö–æ–¥</a>
    </div>
</div>

<div class="content-wrapper">

    <h1 style="text-align: center; color: #c7b8ff;">–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –ø–æ–∫—É–ø–∫–∞–º</h1>

    <div class="summary-grid">
        <div class="summary-card">
            <div class="summary-label">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</div>
            <div class="summary-value"><?= number_format($total_revenue, 0, '', ' ') ?> ‚ÇΩ</div>
        </div>
        <div class="summary-card">
            <div class="summary-label">–ü–æ–∫—É–ø–æ–∫ –≤—Å–µ–≥–æ</div>
            <div class="summary-value"><?= $total_purchases ?></div>
        </div>
        <div class="summary-card">
            <div class="summary-label">–ü–æ–∫—É–ø–∞—Ç–µ–ª–µ–π</div>
            <div class="summary-value"><?= $unique_customers ?></div>
        </div>
    </div>

    <h2 class="section-title">–¢–æ–ø-5 –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π</h2>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                    <th>–ü–æ—Ç—Ä–∞—á–µ–Ω–æ</th>
                    <th>–ü–æ–∫—É–ø–æ–∫</th>
                </tr>
            </thead>
            <tbody>
                <?php if (empty($top_customers)): ?>
                    <tr><td colspan="3" style="text-align: center; color: #aaa;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>
                <?php else: ?>
                    <?php foreach ($top_customers as $c): ?>
                        <tr>
                            <td><?= htmlspecialchars($c['username']) ?></td>
                            <td><?= number_format($c['total_spent'], 0, '', ' ') ?> ‚ÇΩ</td>
                            <td><?= $c['purchase_count'] ?></td>
                        </tr>
                    <?php endforeach; ?>
                <?php endif; ?>
            </tbody>
        </table>
    </div>

    <h2 class="section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏</h2>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</th>
                    <th>–¢–æ–≤–∞—Ä</th>
                    <th>–°—É–º–º–∞</th>
                    <th>–î–∞—Ç–∞</th>
                </tr>
            </thead>
            <tbody>
                <?php if (empty($recent_purchases)): ?>
                    <tr><td colspan="5" style="text-align: center; color: #aaa;">–ù–µ—Ç –ø–æ–∫—É–ø–æ–∫</td></tr>
                <?php else: ?>
                    <?php foreach ($recent_purchases as $p): ?>
                        <tr>
                            <td><?= $p['id'] ?></td>
                            <td><?= htmlspecialchars($p['buyer']) ?></td>
                            <td>
                                <?php if ($p['item_type'] === 'service'): ?>
                                    –£—Å–ª—É–≥–∞: <?= htmlspecialchars($p['service_name']) ?>
                                <?php else: ?>
                                    –ü–∞–∫–µ—Ç: <?= htmlspecialchars($p['package_name']) ?>
                                <?php endif; ?>
                            </td>
                            <td><?= number_format($p['price'], 0, '', ' ') ?> ‚ÇΩ</td>
                            <td><?= date('d.m.Y H:i', strtotime($p['purchased_at'])) ?></td>
                        </tr>
                    <?php endforeach; ?>
                <?php endif; ?>
            </tbody>
        </table>
    </div>

</div>

<?php include '../footer.php'; ?>

</body>
</html>
pages/view_db.php
<?php
// –ù–∞—á–∞–ª–æ —Å–µ—Å—Å–∏–∏ ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
session_start();
require_once '../auth.php';
requireAuth(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–æ—à—ë–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

// === üîí –î–û–°–¢–£–ü –¢–û–õ–¨–ö–û –î–õ–Ø –ê–î–ú–ò–ù–ê ===
if ($_SESSION['role'] !== 'admin') {
    $_SESSION['message'] = "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.";
    header("Location: ../index.php");
    exit;
}
// === –ö–û–ù–ï–¶ –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø ===

// –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ë–î
require_once '../config.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î: " . htmlspecialchars($e->getMessage()));
}

// –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏–∑ –ë–î
$stmt = $pdo->query("SHOW TABLES");
$all_tables = [];
while ($row = $stmt->fetch(PDO::FETCH_NUM)) {
    $all_tables[] = $row[0];
}

// –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã ‚Äî –≤ –Ω–∞—á–∞–ª–µ
$default_tables = ['users', 'servers', 'network_devices', 'changes', 'incidents', 'backups', 'logs'];
$allowed_tables = array_merge(
    array_intersect($default_tables, $all_tables),
    array_diff($all_tables, $default_tables)
);

$current_table = $_GET['table'] ?? '';
if (!in_array($current_table, $all_tables)) {
    $current_table = $all_tables[0] ?? '';
}

// –û–±–Ω–æ–≤–ª—è–µ–º —Ä–æ–ª—å –∏ –∞–≤–∞—Ç–∞—Ä–∫—É –∏–∑ –ë–î
try {
    $stmt = $pdo->prepare("SELECT role, avatar FROM users WHERE id = ?");
    $stmt->execute([$_SESSION['user_id']]);
    $user = $stmt->fetch(PDO::FETCH_ASSOC);
    
    if ($user) {
        $_SESSION['role'] = $user['role'] ?? 'user';
        $_SESSION['avatar'] = $user['avatar'] ?? '../imang/default.png';
    } else {
        session_destroy();
        header("Location: ../login.php");
        exit;
    }
} catch (PDOException $e) {
    $_SESSION['role'] = $_SESSION['role'] ?? 'user';
    $_SESSION['avatar'] = $_SESSION['avatar'] ?? '../imang/default.png';
}

function getUserName($pdo, $user_id) {
    if (!$user_id) return '‚Äî';
    $stmt = $pdo->prepare("SELECT username FROM users WHERE id = ?");
    $stmt->execute([$user_id]);
    $user = $stmt->fetch(PDO::FETCH_ASSOC);
    return $user ? htmlspecialchars($user['username']) : "ID: $user_id";
}

function getServerName($pdo, $server_id) {
    if (!$server_id) return '‚Äî';
    $stmt = $pdo->prepare("SELECT name FROM servers WHERE id = ?");
    $stmt->execute([$server_id]);
    $server = $stmt->fetch(PDO::FETCH_ASSOC);
    return $server ? htmlspecialchars($server['name']) : "ID: $server_id";
}

function getStatusColor($status) {
    $status = strtolower(trim($status));
    if (in_array($status, ['up', 'active', 'planned', 'approved', 'implemented', 'resolved', 'closed', 'success', 'online', 'running'])) {
        return 'rgba(40, 200, 80, 0.3)';
    } elseif (in_array($status, ['down', 'inactive', 'failed', 'error', 'offline', 'stopped', 'deleted'])) {
        return 'rgba(200, 50, 50, 0.3)';
    } elseif (in_array($status, ['maintenance', 'updating', 'restarting'])) {
        return 'rgba(255, 165, 0, 0.3)';
    } elseif (in_array($status, ['open', 'in_progress', 'pending', 'processing'])) {
        return 'rgba(50, 100, 255, 0.3)';
    } else {
        return 'rgba(100, 100, 100, 0.3)';
    }
}
?>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: local</title>
    <link rel="stylesheet" href="../css/view_db.css">
</head>
<body>

<!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º -->
<div class="topbar">
    <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
    <div class="user-info">
        <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ì–æ—Å—Ç—å') ?></strong><br>
        <span class="role">–†–æ–ª—å: <?= htmlspecialchars($_SESSION['role'] ?? 'user') ?></span>
    </div>
    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é -->
    <button onclick="toggleUserMenu()" style="background: none; border: none; color: #c7b8ff; font-size: 16px; cursor: pointer;">‚ñº</button>
</div>

<!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é -->
<div id="userMenu" class="dropdown-content" style="display: none;">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ "–¢–∞–±–ª–∏—Ü—ã" —Å –∫–Ω–æ–ø–∫–æ–π-—Å—Ç—Ä–µ–ª–∫–æ–π -->
    <div style="padding: 8px 12px; color: #c7b8ff; font-weight: bold; cursor: pointer; display: flex; justify-content: space-between; align-items: center;"
         onclick="toggleTablesMenu()">
        üìã –¢–∞–±–ª–∏—Ü—ã
        <span id="tablesArrow" style="font-size: 14px;">‚ñº</span>
    </div>

    <!-- –°–∫—Ä—ã—Ç—ã–π —Å–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü -->
    <div id="tablesList" style="display: none; margin-top: 8px;">
        <?php foreach ($all_tables as $table): ?>
            <a href="?table=<?= urlencode($table) ?>" 
               style="display: block; padding: 6px 12px; color: #e0e0e0; text-decoration: none; border-radius: 4px; font-size: 13px;"
               onmouseover="this.style.backgroundColor='rgba(100, 80, 150, 0.3)'; this.style.color='white';"
               onmouseout="this.style.backgroundColor=''; this.style.color='#e0e0e0';">
                <?= htmlspecialchars($table) ?>
            </a>
        <?php endforeach; ?>
    </div>

    <hr>
    <a href="edit_profile.php" style="display: block; padding: 8px 12px; color: #e0e0e0; text-decoration: none;">üñºÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
    <a href="../actions/create_table_form.php" style="display: block; padding: 8px 12px; color: #e0e0e0; text-decoration: none;">‚ûï –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É</a>
    <?php if ($_SESSION['role'] === 'admin'): ?>
        <a href="../actions/backup.php" style="display: block; padding: 8px 12px; color: #e0e0e0; text-decoration: none;">üíæ –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø</a>
        <a href="view_logs.php" style="display: block; padding: 8px 12px; color: #e0e0e0; text-decoration: none;">–õ–æ–≥–∏</a>
        <a href="sql_console.php" style="display: block; padding: 8px 12px; color: #e0e0e0; text-decoration: none;">üíª SQL-–∫–æ–Ω—Å–æ–ª—å</a>
    <?php endif; ?>
    <hr>
    <a href="../logout.php" style="display: block; padding: 8px 12px; color: #ff6b6b; text-decoration: none;">üö™ –í—ã–π—Ç–∏</a>
</div>

<div class="content-wrapper">
    <?php if (!empty($_SESSION['message'])): ?>
        <div style="text-align: center; padding: 12px; background: rgba(40, 100, 40, 0.3); color: #aaffaa; margin: 10px auto; max-width: 600px; border-radius: 8px; border: 1px solid #3a8a3a;">
            <?= htmlspecialchars($_SESSION['message']) ?>
        </div>
        <?php unset($_SESSION['message']); ?>
    <?php endif; ?>

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
        <h2 style="margin: 0;">–¢–∞–±–ª–∏—Ü–∞: <?= htmlspecialchars($current_table) ?></h2>
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <a href="../actions/add_record.php?table=<?= urlencode($current_table) ?>"
               style="background: linear-gradient(to right, #00c853, #64dd17); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; text-decoration: none;">
                + –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
            </a>
            <?php if ($_SESSION['role'] === 'admin' && $current_table !== 'users'): ?>
                <a href="../actions/delete_table.php?table=<?= urlencode($current_table) ?>"
                   onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–Æ —Ç–∞–±–ª–∏—Ü—É <?= addslashes($current_table) ?>? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')"
                   style="background: linear-gradient(to right, #ff3b3b, #ff6b6b); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; text-decoration: none;">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É
                </a>
            <?php endif; ?>
            <!-- –ö–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
            <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                <a href="../api/export_table.php?table=<?= urlencode($current_table) ?>&format=json"
                   style="background: #555; color: white; padding: 6px 10px; border-radius: 4px; font-size: 12px; text-decoration: none;">JSON</a>
                <a href="../api/export_table.php?table=<?= urlencode($current_table) ?>&format=xlsx"
                   style="background: #217346; color: white; padding: 6px 10px; border-radius: 4px; font-size: 12px; text-decoration: none;">Excel</a>
                <a href="../api/export_table.php?table=<?= urlencode($current_table) ?>&format=pdf"
                   style="background: #d63333; color: white; padding: 6px 10px; border-radius: 4px; font-size: 12px; text-decoration: none;">PDF</a>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –í–°–ï–ô –ë–î (—Ç–æ–ª—å–∫–æ JSON –∏ Excel) -->
    <div style="text-align: right; margin-bottom: 15px;">
        <span style="color: #a090cc; font-size: 0.9rem;">–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ–π –±–∞–∑—ã:</span>
        <a href="../api/export_table.php?format=json"
           style="background: #555; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; text-decoration: none; margin-left: 5px;">JSON</a>
        <a href="../api/export_table.php?format=xlsx"
           style="background: #217346; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; text-decoration: none; margin-left: 5px;">Excel</a>
    </div>

    <div class="table-container">
        <?php
        try {
            $stmt = $pdo->query("SELECT * FROM `$current_table`");
            $columns = [];
            for ($i = 0; $i < $stmt->columnCount(); $i++) {
                $col = $stmt->getColumnMeta($i);
                $columns[] = $col['name'];
            }
            echo "<table>";
            echo "<tr>";
            foreach ($columns as $col) {
                echo "<th>" . htmlspecialchars($col) . "</th>";
            }
            if (in_array('id', $columns)) {
                echo "<th>–î–µ–π—Å—Ç–≤–∏—è</th>";
            }
            echo "</tr>";

            while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
                echo "<tr>";
                foreach ($columns as $col) {
                    $value = $row[$col];
                    if ($current_table === 'changes' && in_array($col, ['requested_by', 'approved_by'])) {
                        $value = getUserName($pdo, $value);
                    } elseif ($current_table === 'incidents' && $col === 'assigned_to') {
                        $value = getUserName($pdo, $value);
                    } elseif ($current_table === 'backups' && $col === 'server_id') {
                        $value = getServerName($pdo, $value);
                    }
                    if (stripos($col, 'status') !== false) {
                        $bgColor = getStatusColor($value);
                        echo "<td style='background: {$bgColor}; padding: 10px 12px; border-bottom: 1px solid rgba(100, 80, 130, 0.2);'>";
                        echo htmlspecialchars($value);
                        echo "</td>";
                    } else {
                        echo "<td>" . htmlspecialchars($value) . "</td>";
                    }
                }
                if (in_array('id', $columns)) {
                    $id = $row['id'];
                    echo "<td class='actions'>";
                    echo "<a href='../actions/edit_record.php?table=" . urlencode($current_table) . "&id=$id' class='btn-edit'>‚úèÔ∏è –ò–∑–º</a> ";
                    echo "<a href='../actions/delete_record.php?table=" . urlencode($current_table) . "&id=$id' class='btn-delete' onclick='return confirm(\"–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?\")'>üóëÔ∏è –£–¥</a>";
                    echo "</td>";
                }
                echo "</tr>";
            }
            echo "</table>";
        } catch (PDOException $e) {
            echo "<div style='color: #ff6b6b; padding: 10px; background: rgba(200, 50, 50, 0.3); border-radius: 6px;'>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ —Ç–∞–±–ª–∏—Ü–µ: " . htmlspecialchars($e->getMessage()) . "</div>";
        }
        ?>
    </div>
</div>

<script>
function toggleTablesMenu() {
    const list = document.getElementById('tablesList');
    const arrow = document.getElementById('tablesArrow');
    if (list.style.display === 'block') {
        list.style.display = 'none';
        arrow.textContent = '‚ñº';
    } else {
        list.style.display = 'block';
        arrow.textContent = '‚ñ≤';
    }
}

function toggleUserMenu() {
    const menu = document.getElementById('userMenu');
    if (menu.style.display === 'block') {
        menu.style.display = 'none';
    } else {
        menu.style.display = 'block';
    }
}

document.addEventListener('click', function(event) {
    const menu = document.getElementById('userMenu');
    const button = document.querySelector('.topbar button');
    if (!button.contains(event.target) && !menu.contains(event.target)) {
        menu.style.display = 'none';
    }
});
</script>

<?php include '../footer.php'; ?>
</body>
</html>
pages/view_incidents.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
function getUserName($pdo, $user_id) {
    if (!$user_id) return '‚Äî';
    $stmt = $pdo->prepare("SELECT username FROM users WHERE id = ?");
    $stmt->execute([$user_id]);
    $user = $stmt->fetch(PDO::FETCH_ASSOC);
    return $user ? htmlspecialchars($user['username']) : "ID: $user_id";
}

if ($_SESSION['role'] !== 'engineer') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã
    $stmt = $pdo->query("SELECT * FROM incidents ORDER BY created_at DESC");
    $incidents = $stmt->fetchAll(PDO::FETCH_ASSOC);

} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage()));
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–í—Å–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/view_incidents.css">
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-panel">
        <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
        <div class="user-info">
            <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ò–Ω–∂–µ–Ω–µ—Ä') ?></strong><br>
            <span class="role">–†–æ–ª—å: <?= htmlspecialchars($_SESSION['role'] ?? 'user') ?></span>
        </div>
        <div class="user-menu">
            <a href="engineer_dashboard.php">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="view_incidents.php">–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã</a>
            <a href="view_servers.php">–°–µ—Ä–≤–µ—Ä—ã</a>
            <a href="view_network.php">–°–µ—Ç—å</a>
            <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="../logout.php">–í—ã—Ö–æ–¥</a>
        </div>
    </div>

    <div class="content-wrapper">
        <h1 style="text-align: center; color: #c7b8ff;">–í—Å–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã</h1>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ó–∞–≥–æ–ª–æ–≤–æ–∫</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ù–∞–∑–Ω–∞—á–µ–Ω</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    <?php foreach ($incidents as $i): ?>
                        <tr>
                            <td><?= (int)$i['id'] ?></td>
                            <td><?= htmlspecialchars($i['title']) ?></td>
                            <td>
                                <span class="incident-status <?= htmlspecialchars($i['status']) ?>">
                                    <?= htmlspecialchars($i['status']) ?>
                                </span>
                            </td>
                            <td><?= getUserName($pdo, $i['assigned_to']) ?></td>
                            <td><?= date('d.m.Y H:i', strtotime($i['created_at'])) ?></td>
                            <td class="actions">
                                <a href="update_incident.php?id=<?= (int)$i['id'] ?>" class="btn-edit">–û–±–Ω–æ–≤–∏—Ç—å</a>
                            </td>
                        </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
pages/view_logs.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

// –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞
if ($_SESSION['role'] !== 'admin') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';
try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ü–æ–ª—É—á–∞–µ–º –ª–æ–≥–∏
    $stmt = $pdo->query("
        SELECT id, event_type, message, ip_address, user_agent, created_at, source
        FROM logs
        ORDER BY created_at DESC
        LIMIT 50
    ");
    $logs = $stmt->fetchAll(PDO::FETCH_ASSOC);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–∞–±–ª–∏—Ü–∞ system_metrics
    $stmt_check = $pdo->query("SHOW TABLES LIKE 'system_metrics'");
    $use_real_data = $stmt_check->rowCount() > 0;

} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage()));
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã</title>
    <link rel="stylesheet" href="../css/view_db.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .metrics-section {
            max-width: 1000px;
            margin: 30px auto;
            padding: 20px;
            background: rgba(30, 25, 45, 0.8);
            border-radius: 12px;
            border: 1px solid rgba(100, 60, 180, 0.3);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }
        .metrics-header {
            color: #c7b8ff;
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }
        .chart-container {
            height: 200px;
            position: relative;
        }
        .data-source {
            text-align: center;
            font-size: 0.9rem;
            color: #a090cc;
            margin-top: 10px;
        }
        .log-item {
            background: rgba(40, 30, 60, 0.9);
            border: 1px solid rgba(100, 60, 180, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .log-message {
            margin-top: 8px;
            color: #d0d0d0;
            line-height: 1.5;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>

<!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
<div class="topbar">
    <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
    <div class="user-info">
        <strong><?= htmlspecialchars($_SESSION['username']) ?></strong><br>
        <span class="role">–†–æ–ª—å: <?= htmlspecialchars($_SESSION['role']) ?></span>
    </div>
    <button onclick="toggleUserMenu()" style="background: none; border: none; color: #c7b8ff; font-size: 16px; cursor: pointer;">‚ñº</button>
</div>
<div id="userMenu" class="dropdown-content" style="display: none;">
    <div style="padding: 8px 12px; color: #c7b8ff; font-weight: bold; cursor: pointer; display: flex; justify-content: space-between; align-items: center;"
         onclick="toggleTablesMenu()">
        üìã –¢–∞–±–ª–∏—Ü—ã
        <span id="tablesArrow" style="font-size: 14px;">‚ñº</span>
    </div>
    <div id="tablesList" style="display: none; margin-top: 8px;">
        <?php
        $stmt = $pdo->query("SHOW TABLES");
        while ($row = $stmt->fetch(PDO::FETCH_NUM)) {
            $table = $row[0];
            echo "<a href='view_db.php?table=" . urlencode($table) . "'>$table</a>";
        }
        ?>
    </div>
    <hr>
    <a href="edit_profile.php">üñºÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
    <a href="../actions/create_table_form.php">‚ûï –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É</a>
    <a href="../actions/backup.php">üíæ –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø</a>
    <a href="sql_console.php">üíª SQL-–∫–æ–Ω—Å–æ–ª—å</a>
    <hr>
    <a href="../logout.php">üö™ –í—ã–π—Ç–∏</a>
</div>

<div class="content-wrapper">

    <!-- –ì—Ä–∞—Ñ–∏–∫ —Å–∏—Å—Ç–µ–º–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="metrics-section">
        <h2 class="metrics-header">–°–∏—Å—Ç–µ–º–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫)</h2>
        <div class="chart-container">
            <canvas id="systemChart"></canvas>
        </div>
        <div class="data-source" id="dataSource">
            <?= $use_real_data ? '–î–∞–Ω–Ω—ã–µ: —Ä–µ–∞–ª—å–Ω—ã–µ (–∏–∑ —Ç–∞–±–ª–∏—Ü—ã system_metrics)' : '–î–∞–Ω–Ω—ã–µ: —Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ (—Ñ–∞–ª—å—à–∏–≤—ã–µ)' ?>
        </div>
    </div>

    <!-- –õ–æ–≥–∏ –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫ -->
    <h1 style="text-align: center; color: #c7b8ff;">–õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã</h1>
    <div class="logs-container">
        <?php if (empty($logs)): ?>
            <div class="empty-logs" style="text-align: center; color: #aaa; font-size: 1.2rem; margin: 60px 0;">–ù–µ—Ç –ª–æ–≥–æ–≤.</div>
        <?php else: ?>
            <?php foreach ($logs as $log): ?>
                <div class="log-item">
                    <span style="color: <?= 
                        strtolower($log['event_type']) === 'error' ? '#ffaaaa' : 
                        (strtolower($log['event_type']) === 'critical' ? '#ff6b6b' : 
                        (strtolower($log['event_type']) === 'warning' ? '#ffcc66' : '#aaffaa')) 
                    ?>; font-weight: bold;">
                        <?= htmlspecialchars($log['event_type']) ?>
                    </span>
                    <span style="color: #d0d0d0; margin-left: 8px;">
                        –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <?= htmlspecialchars($log['source']) ?>
                    </span>
                    <span style="color: #a090cc; margin-left: 8px;">
                        IP: <?= htmlspecialchars($log['ip_address']) ?>
                    </span>
                    <span style="color: #a090cc; margin-left: 8px;">
                        <?= htmlspecialchars(date('d.m.Y H:i:s', strtotime($log['created_at']))) ?>
                    </span>
                    <div class="log-message">
                        <?= nl2br(htmlspecialchars($log['message'])) ?>
                    </div>
                </div>
            <?php endforeach; ?>
        <?php endif; ?>
    </div>
</div>

<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
const ctx = document.getElementById('systemChart').getContext('2d');
let systemChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: [],
        datasets: [
            {
                label: 'CPU (%)',
                data: [],
                borderColor: '#ff6b6b',
                backgroundColor: 'rgba(255, 107, 107, 0.1)',
                borderWidth: 2,
                fill: false,
                tension: 0.3
            },
            {
                label: '–ü–∞–º—è—Ç—å (%)',
                data: [],
                borderColor: '#6ab7ff',
                backgroundColor: 'rgba(106, 183, 255, 0.1)',
                borderWidth: 2,
                fill: false,
                tension: 0.3
            },
            {
                label: '–î–∏—Å–∫ (%)',
                data: [],
                borderColor: '#aaffaa',
                backgroundColor: 'rgba(170, 255, 170, 0.1)',
                borderWidth: 2,
                fill: false,
                tension: 0.3
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                labels: { color: '#e0e0e0' }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                max: 100,
                ticks: { color: '#a090cc' },
                grid: { color: 'rgba(100, 80, 130, 0.2)' }
            },
            x: {
                ticks: { color: '#a090cc' },
                grid: { display: false }
            }
        }
    }
});

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
async function updateChartData() {
    try {
        const response = await fetch('../api/get_system_metrics.php');
        const data = await response.json();
        systemChart.data.labels = data.labels;
        systemChart.data.datasets[0].data = data.cpu;
        systemChart.data.datasets[1].data = data.memory;
        systemChart.data.datasets[2].data = data.disk;
        systemChart.update();
        document.getElementById('dataSource').textContent = data.source;
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞:', error);
    }
}

// –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
updateChartData();
setInterval(updateChartData, 5000);
</script>

<script>
function toggleUserMenu() {
    const menu = document.getElementById('userMenu');
    if (menu.style.display === 'block') {
        menu.style.display = 'none';
    } else {
        menu.style.display = 'block';
    }
}

function toggleTablesMenu() {
    const list = document.getElementById('tablesList');
    const arrow = document.getElementById('tablesArrow');
    if (list.style.display === 'block') {
        list.style.display = 'none';
        arrow.textContent = '‚ñº';
    } else {
        list.style.display = 'block';
        arrow.textContent = '‚ñ≤';
    }
}

document.addEventListener('click', function(event) {
    const menu = document.getElementById('userMenu');
    const button = document.querySelector('.topbar button');
    if (!button.contains(event.target) && !menu.contains(event.target)) {
        menu.style.display = 'none';
    }
});
</script>

<?php include '../footer.php'; ?>

</body>
</html>
pages/view_network.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

if ($_SESSION['role'] !== 'engineer') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–µ—Ç–µ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    $stmt = $pdo->prepare("SELECT * FROM `network_devices` ORDER BY `name`");
    $stmt->execute();
    $devices = $stmt->fetchAll(PDO::FETCH_ASSOC);

} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage()));
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–µ—Ç–µ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/view_network.css">
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-panel">
        <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
        <div class="user-info">
            <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ò–Ω–∂–µ–Ω–µ—Ä') ?></strong><br>
            <span class="role">–†–æ–ª—å: <?= htmlspecialchars($_SESSION['role'] ?? 'user') ?></span>
        </div>
        <div class="user-menu">
            <a href="engineer_dashboard.php">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="view_incidents.php">–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã</a>
            <a href="view_servers.php">–°–µ—Ä–≤–µ—Ä—ã</a>
            <a href="view_network.php">–°–µ—Ç—å</a>
            <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="../logout.php">–í—ã—Ö–æ–¥</a>
        </div>
    </div>

    <div class="content-wrapper">
        <h1 style="text-align: center; color: #c7b8ff;">–°–µ—Ç–µ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h1>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>IP-–∞–¥—Ä–µ—Å</th>
                        <th>–¢–∏–ø</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    <?php foreach ($devices as $device): ?>
                        <tr>
                            <td><?= (int)$device['id'] ?></td>
                            <td><?= htmlspecialchars($device['name']) ?></td>
                            <td><?= htmlspecialchars($device['ip_address']) ?></td>
                            <td><?= htmlspecialchars($device['device_type']) ?></td>
                            <td>
                                <span class="status-<?= strtolower(htmlspecialchars($device['status'])) ?>">
                                    <?= htmlspecialchars($device['status']) ?>
                                </span>
                            </td>
                            <td><?= date('d.m.Y H:i', strtotime($device['last_checked'])) ?></td>
                            <td class="actions">
                                <a href="update_device.php?id=<?= (int)$device['id'] ?>" class="btn-edit">‚úèÔ∏è –û–±–Ω–æ–≤–∏—Ç—å</a>
                            </td>
                        </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
pages/view_servers.php
<?php
session_start();
require_once '../auth.php';
requireAuth();

// –¢–æ–ª—å–∫–æ –¥–ª—è –∏–Ω–∂–µ–Ω–µ—Ä–∞
if ($_SESSION['role'] !== 'engineer') {
    $_SESSION['message'] = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.";
    header("Location: ../index.php");
    exit;
}

require_once '../config.php';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–µ—Ä–≤–µ—Ä—ã
    $stmt = $pdo->prepare("SELECT * FROM servers ORDER BY name");
    $stmt->execute();
    $servers = $stmt->fetchAll(PDO::FETCH_ASSOC);

} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage()));
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–µ—Ä–≤–µ—Ä—ã</title>
    <link rel="stylesheet" href="../css/guest.css">
    <link rel="stylesheet" href="../css/userbar.css">
    <link rel="stylesheet" href="../css/view_servers.css">
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-panel">
        <img src="<?= htmlspecialchars($_SESSION['avatar'] ?? '../imang/default.png') ?>" alt="–ê–≤–∞—Ç–∞—Ä–∫–∞">
        <div class="user-info">
            <strong><?= htmlspecialchars($_SESSION['username'] ?? '–ò–Ω–∂–µ–Ω–µ—Ä') ?></strong><br>
            <span class="role">–†–æ–ª—å: <?= htmlspecialchars($_SESSION['role'] ?? 'user') ?></span>
        </div>
        <div class="user-menu">
            <a href="engineer_dashboard.php">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="view_incidents.php">–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã</a>
            <a href="view_servers.php">–°–µ—Ä–≤–µ—Ä—ã</a>
            <a href="view_network.php">–°–µ—Ç—å</a>
            <a href="edit_profile.php">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="../logout.php">–í—ã—Ö–æ–¥</a>
        </div>
    </div>

    <div class="content-wrapper">
        <h1 style="text-align: center; color: #c7b8ff;">–°–µ—Ä–≤–µ—Ä—ã</h1>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>IP-–∞–¥—Ä–µ—Å</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    <?php foreach ($servers as $server): ?>
                        <tr>
                            <td><?= (int)$server['id'] ?></td>
                            <td><?= htmlspecialchars($server['name']) ?></td>
                            <td><?= htmlspecialchars($server['ip_address']) ?></td>
                            <td>
                                <span class="status-<?= strtolower(htmlspecialchars($server['status'])) ?>">
                                    <?= htmlspecialchars($server['status']) ?>
                                </span>
                            </td>
                            <td><?= htmlspecialchars($server['description'] ?? '') ?></td>
                            <td class="actions">
                                <a href="update_server.php?id=<?= (int)$server['id'] ?>" class="btn-edit">‚úèÔ∏è –û–±–Ω–æ–≤–∏—Ç—å</a>
                            </td>
                        </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
vendor/...

auth.php
<?php

function requireAuth() {
    if (!isset($_SESSION['user_id'])) {
        $_SESSION['message'] = "‚ùå –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É.";
        header("Location: login.php");
        exit;
    }

    if (!isset($_SESSION['role'])) {
        require_once 'config.php';
        try {
            $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
            $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
            $stmt = $pdo->prepare("SELECT role, avatar FROM users WHERE id = ?");
            $stmt->execute([$_SESSION['user_id']]);
            $user = $stmt->fetch(PDO::FETCH_ASSOC);
            if ($user) {
                $_SESSION['role'] = $user['role'] ?? 'user';
                $_SESSION['avatar'] = $user['avatar'] ?? 'imang/default.png';
            } else {
                session_destroy();
                header("Location: login.php");
                exit;
            }
        } catch (PDOException $e) {
            session_destroy();
            header("Location: login.php");
            exit;
        }
    }
}

function logout() {
    session_destroy();
    header("Location: index.php");
    exit;
}
?>
composer.json
{
    "require": {
        "phpmailer/phpmailer": "^7.0",
        "tecnickcom/tcpdf": "^6.10",
        "phpoffice/phpspreadsheet": "^5.2"
    }
}

composer.lock
{
    "_readme": [
        "This file locks the dependencies of your project to a known state",
        "Read more about it at https://getcomposer.org/doc/01-basic-usage.md#installing-dependencies",
        "This file is @generated automatically"
    ],
    "content-hash": "a944418dbbef69a5fd18adf46ef50f4d",
    "packages": [
        {
            "name": "composer/pcre",
            "version": "3.3.2",
            "source": {
                "type": "git",
                "url": "https://github.com/composer/pcre.git",
                "reference": "b2bed4734f0cc156ee1fe9c0da2550420d99a21e"
            },
            "dist": {
                "type": "zip",
                "url": "https://api.github.com/repos/composer/pcre/zipball/b2bed4734f0cc156ee1fe9c0da2550420d99a21e",
                "reference": "b2bed4734f0cc156ee1fe9c0da2550420d99a21e",
                "shasum": ""
            },
            "require": {
                "php": "^7.4 || ^8.0"
            },
            "conflict": {
                "phpstan/phpstan": "<1.11.10"
            },
            "require-dev": {
                "phpstan/phpstan": "^1.12 || ^2",
                "phpstan/phpstan-strict-rules": "^1 || ^2",
                "phpunit/phpunit": "^8 || ^9"
            },
            "type": "library",
            "extra": {
                "phpstan": {
                    "includes": [
                        "extension.neon"
                    ]
                },
                "branch-alias": {
                    "dev-main": "3.x-dev"
                }
            },
            "autoload": {
                "psr-4": {
                    "Composer\\Pcre\\": "src"
                }
            },
            "notification-url": "https://packagist.org/downloads/",
            "license": [
                "MIT"
            ],
            "authors": [
                {
                    "name": "Jordi Boggiano",
                    "email": "j.boggiano@seld.be",
                    "homepage": "http://seld.be"
                }
            ],
            "description": "PCRE wrapping library that offers type-safe preg_* replacements.",
            "keywords": [
                "PCRE",
                "preg",
                "regex",
                "regular expression"
            ],
            "support": {
                "issues": "https://github.com/composer/pcre/issues",
                "source": "https://github.com/composer/pcre/tree/3.3.2"
            },
            "funding": [
                {
                    "url": "https://packagist.com",
                    "type": "custom"
                },
                {
                    "url": "https://github.com/composer",
                    "type": "github"
                },
                {
                    "url": "https://tidelift.com/funding/github/packagist/composer/composer",
                    "type": "tidelift"
                }
            ],
            "time": "2024-11-12T16:29:46+00:00"
        },
        {
            "name": "maennchen/zipstream-php",
            "version": "3.1.2",
            "source": {
                "type": "git",
                "url": "https://github.com/maennchen/ZipStream-PHP.git",
                "reference": "aeadcf5c412332eb426c0f9b4485f6accba2a99f"
            },
            "dist": {
                "type": "zip",
                "url": "https://api.github.com/repos/maennchen/ZipStream-PHP/zipball/aeadcf5c412332eb426c0f9b4485f6accba2a99f",
                "reference": "aeadcf5c412332eb426c0f9b4485f6accba2a99f",
                "shasum": ""
            },
            "require": {
                "ext-mbstring": "*",
                "ext-zlib": "*",
                "php-64bit": "^8.2"
            },
            "require-dev": {
                "brianium/paratest": "^7.7",
                "ext-zip": "*",
                "friendsofphp/php-cs-fixer": "^3.16",
                "guzzlehttp/guzzle": "^7.5",
                "mikey179/vfsstream": "^1.6",
                "php-coveralls/php-coveralls": "^2.5",
                "phpunit/phpunit": "^11.0",
                "vimeo/psalm": "^6.0"
            },
            "suggest": {
                "guzzlehttp/psr7": "^2.4",
                "psr/http-message": "^2.0"
            },
            "type": "library",
            "autoload": {
                "psr-4": {
                    "ZipStream\\": "src/"
                }
            },
            "notification-url": "https://packagist.org/downloads/",
            "license": [
                "MIT"
            ],
            "authors": [
                {
                    "name": "Paul Duncan",
                    "email": "pabs@pablotron.org"
                },
                {
                    "name": "Jonatan M√§nnchen",
                    "email": "jonatan@maennchen.ch"
                },
                {
                    "name": "Jesse Donat",
                    "email": "donatj@gmail.com"
                },
                {
                    "name": "Andr√°s Koles√°r",
                    "email": "kolesar@kolesar.hu"
                }
            ],
            "description": "ZipStream is a library for dynamically streaming dynamic zip files from PHP without writing to the disk at all on the server.",
            "keywords": [
                "stream",
                "zip"
            ],
            "support": {
                "issues": "https://github.com/maennchen/ZipStream-PHP/issues",
                "source": "https://github.com/maennchen/ZipStream-PHP/tree/3.1.2"
            },
            "funding": [
                {
                    "url": "https://github.com/maennchen",
                    "type": "github"
                }
            ],
            "time": "2025-01-27T12:07:53+00:00"
        },
        {
            "name": "markbaker/complex",
            "version": "3.0.2",
            "source": {
                "type": "git",
                "url": "https://github.com/MarkBaker/PHPComplex.git",
                "reference": "95c56caa1cf5c766ad6d65b6344b807c1e8405b9"
            },
            "dist": {
                "type": "zip",
                "url": "https://api.github.com/repos/MarkBaker/PHPComplex/zipball/95c56caa1cf5c766ad6d65b6344b807c1e8405b9",
                "reference": "95c56caa1cf5c766ad6d65b6344b807c1e8405b9",
                "shasum": ""
            },
            "require": {
                "php": "^7.2 || ^8.0"
            },
            "require-dev": {
                "dealerdirect/phpcodesniffer-composer-installer": "dev-master",
                "phpcompatibility/php-compatibility": "^9.3",
                "phpunit/phpunit": "^7.0 || ^8.0 || ^9.0",
                "squizlabs/php_codesniffer": "^3.7"
            },
            "type": "library",
            "autoload": {
                "psr-4": {
                    "Complex\\": "classes/src/"
                }
            },
            "notification-url": "https://packagist.org/downloads/",
            "license": [
                "MIT"
            ],
            "authors": [
                {
                    "name": "Mark Baker",
                    "email": "mark@lange.demon.co.uk"
                }
            ],
            "description": "PHP Class for working with complex numbers",
            "homepage": "https://github.com/MarkBaker/PHPComplex",
            "keywords": [
                "complex",
                "mathematics"
            ],
            "support": {
                "issues": "https://github.com/MarkBaker/PHPComplex/issues",
                "source": "https://github.com/MarkBaker/PHPComplex/tree/3.0.2"
            },
            "time": "2022-12-06T16:21:08+00:00"
        },
        {
            "name": "markbaker/matrix",
            "version": "3.0.1",
            "source": {
                "type": "git",
                "url": "https://github.com/MarkBaker/PHPMatrix.git",
                "reference": "728434227fe21be27ff6d86621a1b13107a2562c"
            },
            "dist": {
                "type": "zip",
                "url": "https://api.github.com/repos/MarkBaker/PHPMatrix/zipball/728434227fe21be27ff6d86621a1b13107a2562c",
                "reference": "728434227fe21be27ff6d86621a1b13107a2562c",
                "shasum": ""
            },
            "require": {
                "php": "^7.1 || ^8.0"
            },
            "require-dev": {
                "dealerdirect/phpcodesniffer-composer-installer": "dev-master",
                "phpcompatibility/php-compatibility": "^9.3",
                "phpdocumentor/phpdocumentor": "2.*",
                "phploc/phploc": "^4.0",
                "phpmd/phpmd": "2.*",
                "phpunit/phpunit": "^7.0 || ^8.0 || ^9.0",
                "sebastian/phpcpd": "^4.0",
                "squizlabs/php_codesniffer": "^3.7"
            },
            "type": "library",
            "autoload": {
                "psr-4": {
                    "Matrix\\": "classes/src/"
                }
            },
            "notification-url": "https://packagist.org/downloads/",
            "license": [
                "MIT"
            ],
            "authors": [
                {
                    "name": "Mark Baker",
                    "email": "mark@demon-angel.eu"
                }
            ],
            "description": "PHP Class for working with matrices",
            "homepage": "https://github.com/MarkBaker/PHPMatrix",
            "keywords": [
                "mathematics",
                "matrix",
                "vector"
            ],
            "support": {
                "issues": "https://github.com/MarkBaker/PHPMatrix/issues",
                "source": "https://github.com/MarkBaker/PHPMatrix/tree/3.0.1"
            },
            "time": "2022-12-02T22:17:43+00:00"
        },
        {
            "name": "phpmailer/phpmailer",
            "version": "v7.0.0",
            "source": {
                "type": "git",
                "url": "https://github.com/PHPMailer/PHPMailer.git",
                "reference": "c7111310c6116ba508a6a170a89eaaed2129bd42"
            },
            "dist": {
                "type": "zip",
                "url": "https://api.github.com/repos/PHPMailer/PHPMailer/zipball/c7111310c6116ba508a6a170a89eaaed2129bd42",
                "reference": "c7111310c6116ba508a6a170a89eaaed2129bd42",
                "shasum": ""
            },
            "require": {
                "ext-ctype": "*",
                "ext-filter": "*",
                "ext-hash": "*",
                "php": ">=5.5.0"
            },
            "require-dev": {
                "dealerdirect/phpcodesniffer-composer-installer": "^1.0",
                "doctrine/annotations": "^1.2.6 || ^1.13.3",
                "php-parallel-lint/php-console-highlighter": "^1.0.0",
                "php-parallel-lint/php-parallel-lint": "^1.3.2",
                "phpcompatibility/php-compatibility": "^9.3.5",
                "roave/security-advisories": "dev-latest",
                "squizlabs/php_codesniffer": "^3.7.2",
                "yoast/phpunit-polyfills": "^1.0.4"
            },
            "suggest": {
                "decomplexity/SendOauth2": "Adapter for using XOAUTH2 authentication",
                "ext-imap": "Needed to support advanced email address parsing according to RFC822",
                "ext-mbstring": "Needed to send email in multibyte encoding charset or decode encoded addresses",
                "ext-openssl": "Needed for secure SMTP sending and DKIM signing",
                "greew/oauth2-azure-provider": "Needed for Microsoft Azure XOAUTH2 authentication",
                "hayageek/oauth2-yahoo": "Needed for Yahoo XOAUTH2 authentication",
                "league/oauth2-google": "Needed for Google XOAUTH2 authentication",
                "psr/log": "For optional PSR-3 debug logging",
                "symfony/polyfill-mbstring": "To support UTF-8 if the Mbstring PHP extension is not enabled (^1.2)",
                "thenetworg/oauth2-azure": "Needed for Microsoft XOAUTH2 authentication"
            },
            "type": "library",
            "autoload": {
                "psr-4": {
                    "PHPMailer\\PHPMailer\\": "src/"
                }
            },
            "notification-url": "https://packagist.org/downloads/",
            "license": [
                "LGPL-2.1-only"
            ],
            "authors": [
                {
                    "name": "Marcus Bointon",
                    "email": "phpmailer@synchromedia.co.uk"
                },
                {
                    "name": "Jim Jagielski",
                    "email": "jimjag@gmail.com"
                },
                {
                    "name": "Andy Prevost",
                    "email": "codeworxtech@users.sourceforge.net"
                },
                {
                    "name": "Brent R. Matzelle"
                }
            ],
            "description": "PHPMailer is a full-featured email creation and transfer class for PHP",
            "support": {
                "issues": "https://github.com/PHPMailer/PHPMailer/issues",
                "source": "https://github.com/PHPMailer/PHPMailer/tree/v7.0.0"
            },
            "funding": [
                {
                    "url": "https://github.com/Synchro",
                    "type": "github"
                }
            ],
            "time": "2025-10-15T16:40:02+00:00"
        },
        {
            "name": "phpoffice/phpspreadsheet",
            "version": "5.2.0",
            "source": {
                "type": "git",
                "url": "https://github.com/PHPOffice/PhpSpreadsheet.git",
                "reference": "3b8994b3aac4b61018bc04fc8c441f4fd68c18eb"
            },
            "dist": {
                "type": "zip",
                "url": "https://api.github.com/repos/PHPOffice/PhpSpreadsheet/zipball/3b8994b3aac4b61018bc04fc8c441f4fd68c18eb",
                "reference": "3b8994b3aac4b61018bc04fc8c441f4fd68c18eb",
                "shasum": ""
            },
            "require": {
                "composer/pcre": "^1||^2||^3",
                "ext-ctype": "*",
                "ext-dom": "*",
                "ext-fileinfo": "*",
                "ext-gd": "*",
                "ext-iconv": "*",
                "ext-libxml": "*",
                "ext-mbstring": "*",
                "ext-simplexml": "*",
                "ext-xml": "*",
                "ext-xmlreader": "*",
                "ext-xmlwriter": "*",
                "ext-zip": "*",
                "ext-zlib": "*",
                "maennchen/zipstream-php": "^2.1 || ^3.0",
                "markbaker/complex": "^3.0",
                "markbaker/matrix": "^3.0",
                "php": "^8.1",
                "psr/http-client": "^1.0",
                "psr/http-factory": "^1.0",
                "psr/simple-cache": "^1.0 || ^2.0 || ^3.0"
            },
            "require-dev": {
                "dealerdirect/phpcodesniffer-composer-installer": "dev-main",
                "dompdf/dompdf": "^2.0 || ^3.0",
                "friendsofphp/php-cs-fixer": "^3.2",
                "mitoteam/jpgraph": "^10.5",
                "mpdf/mpdf": "^8.1.1",
                "phpcompatibility/php-compatibility": "^9.3",
                "phpstan/phpstan": "^1.1 || ^2.0",
                "phpstan/phpstan-deprecation-rules": "^1.0 || ^2.0",
                "phpstan/phpstan-phpunit": "^1.0 || ^2.0",
                "phpunit/phpunit": "^10.5",
                "squizlabs/php_codesniffer": "^3.7",
                "tecnickcom/tcpdf": "^6.5"
            },
            "suggest": {
                "dompdf/dompdf": "Option for rendering PDF with PDF Writer",
                "ext-intl": "PHP Internationalization Functions, regquired for NumberFormat Wizard",
                "mitoteam/jpgraph": "Option for rendering charts, or including charts with PDF or HTML Writers",
                "mpdf/mpdf": "Option for rendering PDF with PDF Writer",
                "tecnickcom/tcpdf": "Option for rendering PDF with PDF Writer"
            },
            "type": "library",
            "autoload": {
                "psr-4": {
                    "PhpOffice\\PhpSpreadsheet\\": "src/PhpSpreadsheet"
                }
            },
            "notification-url": "https://packagist.org/downloads/",
            "license": [
                "MIT"
            ],
            "authors": [
                {
                    "name": "Maarten Balliauw",
                    "homepage": "https://blog.maartenballiauw.be"
                },
                {
                    "name": "Mark Baker",
                    "homepage": "https://markbakeruk.net"
                },
                {
                    "name": "Franck Lefevre",
                    "homepage": "https://rootslabs.net"
                },
                {
                    "name": "Erik Tilt"
                },
                {
                    "name": "Adrien Crivelli"
                }
            ],
            "description": "PHPSpreadsheet - Read, Create and Write Spreadsheet documents in PHP - Spreadsheet engine",
            "homepage": "https://github.com/PHPOffice/PhpSpreadsheet",
            "keywords": [
                "OpenXML",
                "excel",
                "gnumeric",
                "ods",
                "php",
                "spreadsheet",
                "xls",
                "xlsx"
            ],
            "support": {
                "issues": "https://github.com/PHPOffice/PhpSpreadsheet/issues",
                "source": "https://github.com/PHPOffice/PhpSpreadsheet/tree/5.2.0"
            },
            "time": "2025-10-26T15:54:22+00:00"
        },
        {
            "name": "psr/http-client",
            "version": "1.0.3",
            "source": {
                "type": "git",
                "url": "https://github.com/php-fig/http-client.git",
                "reference": "bb5906edc1c324c9a05aa0873d40117941e5fa90"
            },
            "dist": {
                "type": "zip",
                "url": "https://api.github.com/repos/php-fig/http-client/zipball/bb5906edc1c324c9a05aa0873d40117941e5fa90",
                "reference": "bb5906edc1c324c9a05aa0873d40117941e5fa90",
                "shasum": ""
            },
            "require": {
                "php": "^7.0 || ^8.0",
                "psr/http-message": "^1.0 || ^2.0"
            },
            "type": "library",
            "extra": {
                "branch-alias": {
                    "dev-master": "1.0.x-dev"
                }
            },
            "autoload": {
                "psr-4": {
                    "Psr\\Http\\Client\\": "src/"
                }
            },
            "notification-url": "https://packagist.org/downloads/",
            "license": [
                "MIT"
            ],
            "authors": [
                {
                    "name": "PHP-FIG",
                    "homepage": "https://www.php-fig.org/"
                }
            ],
            "description": "Common interface for HTTP clients",
            "homepage": "https://github.com/php-fig/http-client",
            "keywords": [
                "http",
                "http-client",
                "psr",
                "psr-18"
            ],
            "support": {
                "source": "https://github.com/php-fig/http-client"
            },
            "time": "2023-09-23T14:17:50+00:00"
        },
        {
            "name": "psr/http-factory",
            "version": "1.1.0",
            "source": {
                "type": "git",
                "url": "https://github.com/php-fig/http-factory.git",
                "reference": "2b4765fddfe3b508ac62f829e852b1501d3f6e8a"
            },
            "dist": {
                "type": "zip",
                "url": "https://api.github.com/repos/php-fig/http-factory/zipball/2b4765fddfe3b508ac62f829e852b1501d3f6e8a",
                "reference": "2b4765fddfe3b508ac62f829e852b1501d3f6e8a",
                "shasum": ""
            },
            "require": {
                "php": ">=7.1",
                "psr/http-message": "^1.0 || ^2.0"
            },
            "type": "library",
            "extra": {
                "branch-alias": {
                    "dev-master": "1.0.x-dev"
                }
            },
            "autoload": {
                "psr-4": {
                    "Psr\\Http\\Message\\": "src/"
                }
            },
            "notification-url": "https://packagist.org/downloads/",
            "license": [
                "MIT"
            ],
            "authors": [
                {
                    "name": "PHP-FIG",
                    "homepage": "https://www.php-fig.org/"
                }
            ],
            "description": "PSR-17: Common interfaces for PSR-7 HTTP message factories",
            "keywords": [
                "factory",
                "http",
                "message",
                "psr",
                "psr-17",
                "psr-7",
                "request",
                "response"
            ],
            "support": {
                "source": "https://github.com/php-fig/http-factory"
            },
            "time": "2024-04-15T12:06:14+00:00"
        },
        {
            "name": "psr/http-message",
            "version": "2.0",
            "source": {
                "type": "git",
                "url": "https://github.com/php-fig/http-message.git",
                "reference": "402d35bcb92c70c026d1a6a9883f06b2ead23d71"
            },
            "dist": {
                "type": "zip",
                "url": "https://api.github.com/repos/php-fig/http-message/zipball/402d35bcb92c70c026d1a6a9883f06b2ead23d71",
                "reference": "402d35bcb92c70c026d1a6a9883f06b2ead23d71",
                "shasum": ""
            },
            "require": {
                "php": "^7.2 || ^8.0"
            },
            "type": "library",
            "extra": {
                "branch-alias": {
                    "dev-master": "2.0.x-dev"
                }
            },
            "autoload": {
                "psr-4": {
                    "Psr\\Http\\Message\\": "src/"
                }
            },
            "notification-url": "https://packagist.org/downloads/",
            "license": [
                "MIT"
            ],
            "authors": [
                {
                    "name": "PHP-FIG",
                    "homepage": "https://www.php-fig.org/"
                }
            ],
            "description": "Common interface for HTTP messages",
            "homepage": "https://github.com/php-fig/http-message",
            "keywords": [
                "http",
                "http-message",
                "psr",
                "psr-7",
                "request",
                "response"
            ],
            "support": {
                "source": "https://github.com/php-fig/http-message/tree/2.0"
            },
            "time": "2023-04-04T09:54:51+00:00"
        },
        {
            "name": "psr/simple-cache",
            "version": "3.0.0",
            "source": {
                "type": "git",
                "url": "https://github.com/php-fig/simple-cache.git",
                "reference": "764e0b3939f5ca87cb904f570ef9be2d78a07865"
            },
            "dist": {
                "type": "zip",
                "url": "https://api.github.com/repos/php-fig/simple-cache/zipball/764e0b3939f5ca87cb904f570ef9be2d78a07865",
                "reference": "764e0b3939f5ca87cb904f570ef9be2d78a07865",
                "shasum": ""
            },
            "require": {
                "php": ">=8.0.0"
            },
            "type": "library",
            "extra": {
                "branch-alias": {
                    "dev-master": "3.0.x-dev"
                }
            },
            "autoload": {
                "psr-4": {
                    "Psr\\SimpleCache\\": "src/"
                }
            },
            "notification-url": "https://packagist.org/downloads/",
            "license": [
                "MIT"
            ],
            "authors": [
                {
                    "name": "PHP-FIG",
                    "homepage": "https://www.php-fig.org/"
                }
            ],
            "description": "Common interfaces for simple caching",
            "keywords": [
                "cache",
                "caching",
                "psr",
                "psr-16",
                "simple-cache"
            ],
            "support": {
                "source": "https://github.com/php-fig/simple-cache/tree/3.0.0"
            },
            "time": "2021-10-29T13:26:27+00:00"
        },
        {
            "name": "tecnickcom/tcpdf",
            "version": "6.10.0",
            "source": {
                "type": "git",
                "url": "https://github.com/tecnickcom/TCPDF.git",
                "reference": "ca5b6de294512145db96bcbc94e61696599c391d"
            },
            "dist": {
                "type": "zip",
                "url": "https://api.github.com/repos/tecnickcom/TCPDF/zipball/ca5b6de294512145db96bcbc94e61696599c391d",
                "reference": "ca5b6de294512145db96bcbc94e61696599c391d",
                "shasum": ""
            },
            "require": {
                "ext-curl": "*",
                "php": ">=7.1.0"
            },
            "type": "library",
            "autoload": {
                "classmap": [
                    "config",
                    "include",
                    "tcpdf.php",
                    "tcpdf_barcodes_1d.php",
                    "tcpdf_barcodes_2d.php",
                    "include/tcpdf_colors.php",
                    "include/tcpdf_filters.php",
                    "include/tcpdf_font_data.php",
                    "include/tcpdf_fonts.php",
                    "include/tcpdf_images.php",
                    "include/tcpdf_static.php",
                    "include/barcodes/datamatrix.php",
                    "include/barcodes/pdf417.php",
                    "include/barcodes/qrcode.php"
                ]
            },
            "notification-url": "https://packagist.org/downloads/",
            "license": [
                "LGPL-3.0-or-later"
            ],
            "authors": [
                {
                    "name": "Nicola Asuni",
                    "email": "info@tecnick.com",
                    "role": "lead"
                }
            ],
            "description": "TCPDF is a PHP class for generating PDF documents and barcodes.",
            "homepage": "http://www.tcpdf.org/",
            "keywords": [
                "PDFD32000-2008",
                "TCPDF",
                "barcodes",
                "datamatrix",
                "pdf",
                "pdf417",
                "qrcode"
            ],
            "support": {
                "issues": "https://github.com/tecnickcom/TCPDF/issues",
                "source": "https://github.com/tecnickcom/TCPDF/tree/6.10.0"
            },
            "funding": [
                {
                    "url": "https://www.paypal.com/donate/?hosted_button_id=NZUEC5XS8MFBJ",
                    "type": "custom"
                }
            ],
            "time": "2025-05-27T18:02:28+00:00"
        }
    ],
    "packages-dev": [],
    "aliases": [],
    "minimum-stability": "stable",
    "stability-flags": {},
    "prefer-stable": false,
    "prefer-lowest": false,
    "platform": {},
    "platform-dev": {},
    "plugin-api-version": "2.6.0"
}

config.php
<?php
// –†¬§–†¬∞–†‚Ññ–†¬ª –†—î–†—ï–†–Ö–°‚Äû–†—ë–†—ñ–°—ì–°–Ç–†¬∞–°‚Ä†–†—ë–†—ë –†—ó–†—ï–†“ë–†—î–†¬ª–°–ã–°‚Ä°–†¬µ–†–Ö–†—ë–°–è –†—î –†¬±–†¬∞–†¬∑–†¬µ –†“ë–†¬∞–†–Ö–†–Ö–°‚Äπ–°‚Ä¶

$host = 'localhost';
$dbname = 'local';
$username = 'root';
$password = '';

footer.php 
<?php ?>
<footer style="background: rgba(20, 15, 35, 0.95); padding: 20px; text-align: center; border-top: 1px solid rgba(100, 60, 180, 0.2); margin-top: 40px;">
    <p style="color: #c7b8ff; font-size: 0.9rem; margin: 0;">
        &copy; <?= date('Y') ?> –ò–¢-–°–µ—Ä–≤–∏—Å. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
    </p>
    <p style="color: #a090cc; font-size: 0.85rem; margin: 5px 0 0;">
        –†–∞–∑—Ä–∞–±–æ—Ç–∞–ª –¢–∫–∞—á–µ–Ω–∫–æ –ï–≥–æ—Ä –ò–≤–∞–Ω–æ–≤–∏—á
    </p>
</footer>
index.php 
<?php
session_start();
if (isset($_SESSION['user_id'])) {
    switch ($_SESSION['role']) {
        case 'user':
            header("Location: pages/user_dashboard.php");
            break;
        case 'engineer':
            header("Location: pages/engineer_dashboard.php");
            break;
        case 'manager':
            header("Location: pages/manager_dashboard.php"); // ‚Üê –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
            break;
        case 'db_admin':
            header("Location: pages/db_admin_dashboard.php");
            break;
        case 'admin':
            header("Location: pages/view_db.php");
            break;
        default:
            header("Location: index.php");
    }
    exit;
}

// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
require_once 'config.php'; // ‚Üê config.php –≤ –∫–æ—Ä–Ω–µ
try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î.");
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —É—Å–ª—É–≥ —Å id 9, 10, 11, 12
$stmt = $pdo->query("SELECT * FROM services WHERE id IN (9, 10, 11, 12)");
$services = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ò–¢-–°–µ—Ä–≤–∏—Å ‚Äî –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</title>
    <link rel="stylesheet" href="css/index.css">
</head>
<body>
    <div class="header">
        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ò–¢-–°–µ—Ä–≤–∏—Å</h1>
        <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7</p>
    </div>

    <div class="services-grid">
        <?php foreach ($services as $service): ?>
            <div class="service-card">
                <h3><?= htmlspecialchars($service['name']) ?></h3>
                <p><?= htmlspecialchars($service['description']) ?></p>
            </div>
        <?php endforeach; ?>
        <!-- 5-—è –∫–∞—Ä—Ç–æ—á–∫–∞ ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Å–µ—Ö —É—Å–ª—É–≥ -->
        <div class="service-card">
            <h3>–í—Å–µ —É—Å–ª—É–≥–∏</h3>
            <p>–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –Ω–∞—à–∏—Ö —É—Å–ª—É–≥.</p>
            <a href="/login.php" style="background: linear-gradient(to right, #00c853, #64dd17); color: white; text-decoration: none; margin-top: 10px; display: inline-block; padding: 10px 20px; border-radius: 6px;">–ü–µ—Ä–µ–π—Ç–∏</a>
        </div>
    </div>

    <div class="support-section">
        <h2>üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
        <p>–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –ú—ã –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏!</p>
        <div class="support-info">
            <div class="contact-item">
                <span class="icon">üìß</span>
                <span class="text">support@it-service.com</span>
            </div>
            <div class="contact-item">
                <span class="icon">üìû</span>
                <span class="text">+7 (999) 123-45-67</span>
            </div>
            <div class="contact-item">
                <span class="icon">üïñ</span>
                <span class="text">–†–∞–±–æ—Ç–∞–µ–º 24/7</span>
            </div>
        </div>
    </div>

    <div class="actions">
        <a href="login.php" class="btn btn-login">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</a>
        <a href="register.php" class="btn btn-register">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
    </div>

    <?php include 'footer.php'; ?>
</body>
</html>
log_action.php 
<?php
// log_action.php ‚Äî –µ–¥–∏–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

/**
 * –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ —Ç–∞–±–ª–∏—Ü—É logs
 *
 * @param PDO $pdo –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
 * @param int $userId ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 * @param string $username –õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 * @param string $eventType –¢–∏–ø —Å–æ–±—ã—Ç–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'login', 'delete_record')
 * @param string $message –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
 */
function logAction($pdo, $userId, $username, $eventType, $message = '') {
    $ip = $_SERVER['REMOTE_ADDR'] ?? 'unknown';
    $userAgent = $_SERVER['HTTP_USER_AGENT'] ?? '';

    $stmt = $pdo->prepare("
        INSERT INTO logs (user_id, username, event_type, message, ip_address, user_agent, timestamp)
        VALUES (?, ?, ?, ?, ?, ?, NOW())
    ");
    $stmt->execute([$userId, $username, $eventType, $message, $ip, $userAgent]);
}
?>
login.php 
<?php
session_start();

// –ï—Å–ª–∏ —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Äî —Ä–µ–¥–∏—Ä–µ–∫—Ç
if (isset($_SESSION['user_id'])) {
    header("Location: pages/view_db.php");
    exit;
}

$error = '';
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    require_once 'config.php'; // ‚Üê config.php –≤ –∫–æ—Ä–Ω–µ

    $input_username = trim($_POST['username'] ?? '');
    $input_password = $_POST['password'] ?? '';

    if (empty($input_username) || empty($input_password)) {
        $error = "–õ–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.";
    } else {
        try {
            $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
            $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è
            $password_fields = ['password', 'PASSWORD_HASH', 'password_hash', 'pass', 'passwd'];
            $columns = $pdo->query("DESCRIBE users")->fetchAll(PDO::FETCH_COLUMN);
            $password_col = 'password';
            foreach ($password_fields as $field) {
                if (in_array($field, $columns)) {
                    $password_col = $field;
                    break;
                }
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            $stmt = $pdo->prepare("SELECT id, username, `$password_col`, role, avatar FROM users WHERE username = ?");
            $stmt->execute([$input_username]);
            $user = $stmt->fetch(PDO::FETCH_ASSOC);

            if ($user && password_verify($input_password, $user[$password_col])) {
                $_SESSION['user_id'] = $user['id'];
                $_SESSION['username'] = $user['username'];
                $_SESSION['role'] = $user['role'] ?? 'user';
                $_SESSION['avatar'] = $user['avatar'] ?? 'imang/default.png';

                unset($_SESSION['captcha_order']); // –æ—á–∏—Å—Ç–∫–∞ –∫–∞–ø—á–∏

                header("Location: pages/view_db.php");
                exit;
            } else {
                $error = "–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å.";
            }
        } catch (PDOException $e) {
            $error = "–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.";
        }
    }
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</title>
    <link rel="stylesheet" href="css/auth.css">
    <style>
        .captcha-container {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(30, 25, 45, 0.95);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
            z-index: 9999;
            width: 400px;
        }
        .captcha-header {
            color: #c7b8ff;
            text-align: center;
            margin-top: 0;
            margin-bottom: 10px;
        }
        .captcha-instructions {
            color: #a090cc;
            text-align: center;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        .captcha-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        .captcha-piece {
            width: 100px;
            height: 100px;
            cursor: grab;
            border: 1px solid #5a1a8f;
            background: rgba(40, 30, 60, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .captcha-piece img {
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
        }
        .captcha-piece.dragging {
            opacity: 0.7;
        }
        .captcha-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .btn-confirm {
            background: linear-gradient(to right, #3a0d6a, #5a1a8f);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-cancel {
            background: linear-gradient(to right, #ff3b3b, #ff6b6b);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="auth-box">
        <h2>–í—Ö–æ–¥</h2>
        <?php if ($error): ?>
            <div class="message error"><?= htmlspecialchars($error) ?></div>
        <?php endif; ?>
        <form id="loginForm" method="POST">
            <input type="text" name="username" placeholder="–õ–æ–≥–∏–Ω" value="<?= htmlspecialchars($_POST['username'] ?? '') ?>" required>
            <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
            <button type="button" onclick="showCaptcha()" style="background: linear-gradient(to right, #3a0d6a, #5a1a8f); color: white; padding: 10px 24px; border: none; border-radius: 6px; cursor: pointer;">–í–æ–π—Ç–∏</button>
        </form>
        <div class="auth-links">
            –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="register.php">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
        </div>
        <div style="margin-top: 15px; text-align: center;">
            <a href="index.php" style="color: #6ab7ff; text-decoration: none; font-size: 0.9rem;">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞–ø—á–∏ -->
    <div id="captchaModal" class="captcha-container">
        <h3 class="captcha-header">–°–æ–±–µ—Ä–∏—Ç–µ –ø–∞–∑–ª</h3>
        <p class="captcha-instructions">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ</p>
        <div class="captcha-grid" id="captchaGrid"></div>
        <div class="captcha-buttons">
            <button type="button" onclick="submitCaptcha()" class="btn-confirm">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            <button type="button" onclick="closeCaptcha()" class="btn-cancel">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        let correctOrder = [4, 3, 2, 1]; // fragment4.jpg, fragment3.jpg –∏ —Ç.–¥.

        function showCaptcha() {
            const captchaGrid = document.getElementById('captchaGrid');
            captchaGrid.innerHTML = '';
            let currentOrder = [...correctOrder];
            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º
            for (let i = currentOrder.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [currentOrder[i], currentOrder[j]] = [currentOrder[j], currentOrder[i]];
            }

            currentOrder.forEach(id => {
                const piece = document.createElement('div');
                piece.className = 'captcha-piece';
                piece.dataset.id = id;
                piece.draggable = true;

                const img = document.createElement('img');
                img.src = `imang/Capcha/fragment${id}.jpg`;
                img.alt = `–§—Ä–∞–≥–º–µ–Ω—Ç ${id}`;
                piece.appendChild(img);

                piece.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', id);
                    piece.classList.add('dragging');
                });
                piece.addEventListener('dragover', (e) => e.preventDefault());
                piece.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const draggedId = e.dataTransfer.getData('text/plain');
                    const dragged = Array.from(captchaGrid.children).find(p => p.dataset.id == draggedId);
                    if (dragged && dragged !== piece) {
                        // –ú–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏
                        const img1 = piece.querySelector('img').src;
                        const img2 = dragged.querySelector('img').src;
                        piece.querySelector('img').src = img2;
                        dragged.querySelector('img').src = img1;

                        [piece.dataset.id, dragged.dataset.id] = [dragged.dataset.id, piece.dataset.id];
                    }
                });
                piece.addEventListener('dragend', () => piece.classList.remove('dragging'));

                captchaGrid.appendChild(piece);
            });

            document.getElementById('captchaModal').style.display = 'block';
        }

        function closeCaptcha() {
            document.getElementById('captchaModal').style.display = 'none';
        }

        function submitCaptcha() {
            const order = Array.from(document.querySelectorAll('.captcha-piece')).map(p => parseInt(p.dataset.id));
            if (JSON.stringify(order) === JSON.stringify(correctOrder)) {
                document.getElementById('loginForm').submit();
            } else {
                alert('–ü–∞–∑–ª —Å–æ–±—Ä–∞–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.');
            }
        }
    </script>
</body>
</html>
logout.php 
<?php
session_start();
session_destroy();
header("Location: index.php");
exit;


register.php
<?php
error_reporting(E_ALL);
ini_set('display_errors', 1);
session_start();
require_once 'log_action.php'; // ‚Üê log_action.php –≤ –∫–æ—Ä–Ω–µ

if (isset($_SESSION['user_id'])) {
    header("Location: pages/view_db.php"); // ‚Üê –£–ë–†–ê–ù–û pages/pages/
    exit;
}

$error = '';
$success = '';

if ($_POST) {
    // –ü–æ–¥–∫–ª—é—á–∞–µ–º config.php ‚Äî –ø–æ–ª—É—á–∞–µ–º $host, $dbname, $username, $password
    require_once 'config.php'; // ‚Üê config.php –≤ –∫–æ—Ä–Ω–µ

    $form_username = trim($_POST['username'] ?? '');
    $form_password = $_POST['password'] ?? '';
    $form_confirm = $_POST['confirm_password'] ?? '';
    $form_email = $_POST['email'] ?? '';

    if (empty($form_username) || empty($form_password)) {
        $error = "–õ–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.";
    } elseif ($form_password !== $form_confirm) {
        $error = "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç.";
    } elseif (strlen($form_password) < 6) {
        $error = "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 6 —Å–∏–º–≤–æ–ª–æ–≤.";
    } else {
        try {
            $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
            $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

            $stmt = $pdo->prepare("SELECT id FROM users WHERE username = ?");
            $stmt->execute([$form_username]);
            if ($stmt->fetch()) {
                $error = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.";
            } else {
                $columns = $pdo->query("DESCRIBE users")->fetchAll(PDO::FETCH_COLUMN);
                $password_col = null;
                foreach (['password_hash', 'PASSWORD_HASH', 'password', 'pass', 'passwd'] as $field) {
                    if (in_array($field, $columns)) {
                        $password_col = $field;
                        break;
                    }
                }

                if (!$password_col) {
                    $error = "–í —Ç–∞–±–ª–∏—Ü–µ users –Ω–µ—Ç –ø–æ–ª—è –¥–ª—è –ø–∞—Ä–æ–ª—è.";
                } else {
                    $hashed = password_hash($form_password, PASSWORD_DEFAULT);
                    $role = 'user';
                    $email = $form_email ?: 'no-email@example.com';

                    $stmt = $pdo->prepare("
                        INSERT INTO users (username, `$password_col`, email, role, created_at, password_created_at)
                        VALUES (?, ?, ?, ?, NOW(), NOW())
                    ");
                    if ($stmt->execute([$form_username, $hashed, $email, $role])) {
    $userId = $pdo->lastInsertId(); // ‚Üê –ü–æ–ª—É—á–∞–µ–º ID –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    $success = "‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏.";

    // –õ–æ–≥–∏—Ä—É–µ–º —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º user_id
    logAction($pdo, $userId, $form_username, 'REGISTER_SUCCESS', "Email: $email");
} else {
    $error = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏.";
}
                }
            }
        } catch (PDOException $e) {
            $error = "‚ùå –û—à–∏–±–∫–∞ –ë–î: " . htmlspecialchars($e->getMessage());
        }
    }
}
?>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
    <link rel="stylesheet" href="css/auth.css">
</head>
<body>
    <div class="auth-box">
        <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>

        <?php if ($error): ?>
            <div class="message error"><?= htmlspecialchars($error) ?></div>
        <?php endif; ?>

        <?php if ($success): ?>
            <div class="message success"><?= htmlspecialchars($success) ?></div>
        <?php endif; ?>

        <?php if (!$success): ?>
            <form method="POST">
                <input type="text" name="username" placeholder="–õ–æ–≥–∏–Ω" value="<?= htmlspecialchars($_POST['username'] ?? '') ?>" required>
                <input type="email" name="email" placeholder="Email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" value="<?= htmlspecialchars($_POST['email'] ?? '') ?>">
                <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å (–º–∏–Ω. 6 —Å–∏–º–≤–æ–ª–æ–≤)" required>
                <input type="password" name="confirm_password" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                <button type="submit" class="register-button">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </form>
        <?php endif; ?>

        <div class="auth-links">
            –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="login.php">–í–æ–π—Ç–∏</a>
        </div>
    </div>
</body>
</html>